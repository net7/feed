angular.module("templates-main",["src/Annomatic/AnnomaticPanel.dir.tmpl.html","src/Annomatic/AnnomaticPopover.tmpl.html","src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html","src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html","src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html","src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html","src/Annotators/TextFragmentIcon.dir.tmpl.html","src/ContextualMenu/dropdown.tmpl.html","src/Core/confirm.modal.tmpl.html","src/Core/login.modal.tmpl.html","src/Dashboard/ClientDashboard.tmpl.html","src/Dashboard/Dashboard.dir.tmpl.html","src/Dashboard/DashboardPanel.dir.tmpl.html","src/Dashboard/pndTabs.dir.tmpl.html","src/Item/Item.dir.tmpl.html","src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html","src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html","src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html","src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html","src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html","src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html","src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html","src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html","src/Lists/itemList.tmpl.html","src/Lists/itemsContainer.tmpl.html","src/Notebook/Notebook.dir.tmpl.html","src/Preview/ClientDashboardPreview.tmpl.html","src/Preview/DashboardPreview.dir.tmpl.html","src/Preview/ItemPreview.dir.tmpl.html","src/Preview/NotebookPreview.dir.tmpl.html","src/ResourcePanel/datepicker.tmpl.html","src/ResourcePanel/popoverCalendar.tmpl.html","src/ResourcePanel/popoverLiteralText.tmpl.html","src/ResourcePanel/popoverResourcePanel.tmpl.html","src/Toolbar/ClientToolbar.tmpl.html","src/Toolbar/Toolbar.dir.tmpl.html","src/Toolbar/myNotebooksDropdown.tmpl.html","src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html","src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html","src/Tools/TripleComposer/ClientTripleComposer.tmpl.html","src/Tools/TripleComposer/Statement.dir.tmpl.html","src/Tools/TripleComposer/TripleComposer.dir.tmpl.html"]),angular.module("src/Annomatic/AnnomaticPanel.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/AnnomaticPanel.dir.tmpl.html",'<div ng-controller="AnnomaticPanelCtrl">\n    <div>\n\n        <button ng-disabled="targets.length == 0" class="btn btn-success pnd-button-suggestion" ng-click="getSuggestions()">\n            Scan Page <span class="pnd-icon pnd-icon-file-text"></span>\n        </button>\n\n        <button class="btn btn-success pnd-button-select-area" ng-click="selectAreaMode()">\n            Select area <span class="pnd-icon pnd-icon-edit"></span>\n        </button>\n\n        <div ng-show="Annomatic.annotationNumber > 0">\n            <button class="btn btn-danger pnd-button-start-review" ng-click="startReview()">\n                Review ({{Annomatic.currAnn}}/{{Annomatic.annotationNumber}})\n            </button>\n\n            <button\n                class="btn btn-default pnd-button-filter-suggestion"\n                ng-model="filteredTypes"\n                placeholder="Filter by suggestion type"\n                data-html="1"\n                data-multiple="1"\n                data-animation="am-flip-x"\n                ng-options="type.value as type.label for type in Annomatic.ann.typesOptions"\n                bs-select>\n            </button>\n        </div>\n    </div>\n    <div>\n'+"        Accepted: {{Annomatic.ann.byState['accepted'].join(', ')}}\n    </div>\n    <div>\n        Removed: {{Annomatic.ann.byState['removed'].join(', ')}}\n    </div>\n    <div>\n        filteredTypes: {{Annomatic.filteredTypes}}\n    </div>\n</div>")}]),angular.module("src/Annomatic/AnnomaticPopover.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/AnnomaticPopover.tmpl.html",'<div class="pnd-annomatic-popover popover" ng-controller="AnnomaticPopoverCtrl">\n    <div class="arrow"></div>\n\n    <h4 class="popover-title" ng-click="showDetails = !showDetails">\n\n        <!--\n        TODO: decide if we want the caret or not\n        <span ng-show="!showDetails" class="pnd-icon pnd-icon-caret-right"></span>\n        <span ng-show="showDetails" class="pnd-icon pnd-icon-caret-down"></span>\n        -->\n\n        <span\n            style="opacity: {{ann.byNum[num].confidence}}"\n            title="Confidence {{ann.byNum[num].confidence}}"\n            class="pnd-icon pnd-icon-th-large pnd-confidence"></span>\n\n        {{ann.byNum[num].title}}\n\n        <span class="pull-right pnd-icon pnd-icon-times" ng-click="hide()"></span>\n    </h4>\n\n    <div class="popover-content">\n\n        <div ng-show="showDetails" class="pnd-preview clearfix">\n            <item-preview uri="{{ann.byNum[num].uri}}"></item-preview>\n        </div>\n\n        <div class="btn-group">\n\n            <button class="btn btn-warning pnd-button-go-prev" ng-click="goPrev()">\n                <span class="pnd-icon pnd-icon-arrow-left"></span>\n            </button>\n\n            <button class="btn btn-success pnd-button-set-ok" ng-click="setOk()">\n                <span class="pnd-icon pnd-icon-check"></span>\n            </button>\n\n            <button class="btn btn-danger pnd-button-set-ko" ng-click="setKo()">\n                <span class="pnd-icon pnd-icon-trash-o"></span>\n            </button>\n\n            <button\n                ng-show="instances > 1"\n                class="btn btn-info"\n                ng-click="acceptAll()"\n                ng-mouseover="toggleSimilar()"\n                ng-mouseout="toggleSimilar(content)">accept all {{instances}}</button>\n\n            <button class="btn btn-warning" ng-click="goNext()">\n                <span class="pnd-icon pnd-icon-arrow-right"></span>\n            </button>\n\n        </div>\n\n    </div>\n</div>')}]),angular.module("src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",'<span\n    ng-mouseover="mouseoverHandler()"\n    ng-mouseout="mouseoutHandler()"\n    ng-click="clickHandler($event)"\n    class="{{textFragmentIconClass}} {{iconClass}}">\n</span>')}]),angular.module("src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",'<div \n    class="pnd-annotation-details" \n    ng-mouseover="mouseoverHandler()"\n    ng-mouseout="mouseoutHandler()">\n    <div class="pnd-annotation-details-header pnd-annotation-details-top" \n        ng-click="toggleAnnotation()"\n        ng-class="{\'pnd-annotation-details-broken\': annotation.broken}">\n        <div class="{{annotation.mainItem.class}}">\n		        <div class="pnd-annotation-item-header-text">\n                        <span ng-show="annotation.broken" class="pnd-icon-exclamation-circle"></span>\n		                <span class="{{annotation.mainItem.icon}}"></span>\n		                <span>{{annotation.mainItem.label}}</span>\n		        </div>    \n                <button type="button" class="btn  pull-right">\n                    <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[annotation.expanded]"></span>\n                </button>\n        </div>\n    </div>\n\n    <div class="pnd-annotation-details-container" ng-if="annotation.expanded">\n\n        <div class="pnd-annotation-details-menu">\n            <div class="{{annotation.mainItem.class}}">\n                <button type="button" class="btn btn-primary" ng-click="metaInfo = !metaInfo">\n                    <span class="pnd-icon-exclamation-circle"></span>\n                    Meta\n                </button><button type="button" class="btn btn-primary">\n                    <span class="pnd-icon-mail-forward"></span>\n                    Reply\n                </button><button type="button" class="btn btn-primary">\n                    <span class="pnd-icon-share-square-o"></span>\n                    Share\n                </button>\n            </div>\n        </div>\n\n        <div class="pnd-annotation-details-info" ng-show="metaInfo">\n            <div class="pnd-annotation-details-info-author">\n                <strong>Author:</strong> {{annotation.creatorName}}\n            </div>\n            <div class="pnd-annotation-details-info-date">\n                <strong>Date:</strong> {{annotation.created | date : \'MMM d, y H:mm a\'}}\n            </div>       \n            <div class="pnd-annotation-details-info-notebook">\n                <strong>Notebook:</strong> <a href="{{askLink}}{{annotation.notebookId}}" target="_blank">\n                    {{notebookName}}\n                </a>\n            </div>       \n        </div>\n        \n        <div class="pnd-annotation-details-content">\n            <div class="pnd-annotation-detains-item" ng-repeat="item in annotation.itemsArray">\n            <!-- subject -->\n                <div \n                    class="pnd-annotation-details-subject" \n                    ng-init="subInfo = false">\n                        <div \n                            class="pnd-annotation-details-item-header" \n                            ng-click="subInfo = !subInfo"\n                            ng-class="{\'pnd-annotation-details-sub-open\': subInfo}">\n                            <!-- <span class="{{item.subject.icon}}"></span> -->\n                            <div class="pnd-annotation-item-header-text">\n	                            <span class="pnd-icon pnd-icon-certificate"></span>\n	                            <span ng-bind-html="item.subject.label">{{item.subject.label}}</span>\n                            </div>\n                            <button type="button" class="btn btn-link pull-right">\n                                <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[subInfo]"></span>\n                            </button>\n                        </div>\n\n                        <div ng-show="subInfo" class="pnd-sub-info">\n                            <item-preview uri="{{item.subject.uri}}"></item-preview>\n                        </div>\n                </div>\n             <!-- // end subject -->\n             <!-- predicate -->\n                <div \n                    class="pnd-annotation-details-predicate" \n                    ng-init="preInfo = false">\n                        <div \n                            class="pnd-annotation-details-item-header" \n                            ng-click="preInfo = !preInfo"\n                            ng-class="{\'pnd-annotation-details-sub-open\': preInfo}">\n                        	<div class="pnd-annotation-item-header-text">\n    	                    	<span class="pnd-icon pnd-icon-certificate"></span>\n    	                    	<span ng-bind-html="item.predicate.label">{{item.predicate.label}}</span>\n                        	</div>\n                            <button type="button" class="btn  btn-link pull-right">\n                                <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[preInfo]"></span>\n                            </button>\n                        </div>\n\n                        <div ng-show="preInfo"  class="pnd-sub-info">\n                            <item-preview uri="{{item.predicate.uri}}"></item-preview>\n                        </div>\n                </div>\n             <!-- // end predicate -->\n             <!-- // object -->\n                <div ng-repeat="object in item.objects">\n                    <div \n                        class="pnd-annotation-details-object"                         \n                        ng-init="objInfo = false">\n                            <div \n                                class="pnd-annotation-details-item-header" \n                                ng-click="objInfo = toggleObjectInfo(object.typeClass, objInfo)"\n                                ng-class="{\'pnd-annotation-details-sub-open\': objInfo}">\n                                <!-- <span class="{{object.icon}}"></span> -->\n                                <div class="pnd-annotation-item-header-text">\n	                                <span class="pnd-icon pnd-icon-certificate"></span>\n	                                <span ng-bind-html="object.label">{{object.label}}</span>\n                                </div>\n                                <button type="button" class="btn  btn-link pull-right" ng-if="object.typeClass==\'uri\'">\n                                        <span ng-class="{true:\'pnd-icon-caret-up\', false:\'pnd-icon-sort-down\'}[objInfo]"></span>\n                                </button>\n                            </div>\n                            <div ng-show="objInfo" class="pnd-sub-info">\n                                <item-preview class="pnd-preview clearfix" uri="{{object.uri}}"></item-preview>\n                            </div>\n                    </div>\n                </div>\n             <!-- // end object -->\n            </div>    \n        </div>\n        <!-- footer -->\n        <div class="pnd-annotation-details-footer" ng-show="isUserToolShowed()">\n            <button type="button" class="btn btn-xs btn-success">Edit</button>\n            <button type="button" class="btn btn-xs btn-danger">Delete</button>\n        </div>\n        <!-- // end footer -->\n    </div>\n</div>')}]),angular.module("src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",'<div class="pnd-annotation-sidebar-container pnd-ignore">\n    <div class="pnd-annotation-sidebar-content" ng-show="isAnnotationSidebarExpanded">\n\n        <div class="pnd-annotation-sidebar-modes-buttons">\n            <button type="button"\n                    ng-click="activateSuggestionsPanel()"\n                    ng-class="{\'pnd-active\': isSuggestionsPanelActive()}"\n                    class="btn pnd-btn-sidebar">\n                Suggestions\n            </button><button type="button"\n                    ng-click="activateAnnotationsPanel()"\n                    ng-class="{\'pnd-active\': isAnnotationsPanelActive()}"\n                    class="btn pnd-btn-sidebar">\n                Annotations ({{annotations.length}}/{{allAnnotations.length}})\n            </button>\n        </div>\n\n        <div class="pnd-annotation-sidebar-filter-content" ng-show="isAnnotationsPanelActive()">\n\n            <div ng-class="{\'pnd-btn-sidebar-full\': !annotationSidebar.needToFilter()}">\n                <button\n                    ng-click="annotationSidebar.toggleFiltersContent()"\n                    ng-show="!isFiltersShowed"\n                    class="btn btn-link pnd-annotation-sidebar-btn-show-filter">\n                        <span class="pnd-icon pnd-icon-filter"></span> Show Filters\n                </button><button ng-show="annotationSidebar.needToFilter() && !isFiltersShowed"\n                    class="btn btn-link pnd-annotation-sidebar-btn-remove-filters" ng-click="annotationSidebar.resetFilters()">\n                       <span class="pnd-icon pnd-icon-times"></span> Remove all filters\n                </button>\n            </div>\n\n            <div class="pnd-annotation-sidebar-filters-list" ng-show="isFiltersShowed">\n            <!-- buttons -->\n            <!-- // end buttons -->\n                \n\n                <!-- Free text -->\n                <div class="pnd-annotation-sidebar-filter">\n                    <div class="pnd-panel" ng-click="toggleFilterList($event)">Contains</div>\n                    <div \n                        ng-show="isFilterLabelShowed(annotationSidebar.filters.freeText.expression)"\n                        class="pnd-annotation-sidebar-filter-label">\n                        <span class="pnd-icon pnd-icon-check"></span>\n                        {{annotationSidebar.filters.freeText.expression}}\n                    </div>\n                    <div class="pnd-annotation-sidebar-filter-input">\n                    	<span \n                            class="pnd-icon" \n                            ng-class="setSearchIcon(annotationSidebar.filters.freeText.expression)" \n                            ng-click="annotationSidebar.filters.freeText.expression = \'\'"></span>\n                        <input class="form-control" ng-model="annotationSidebar.filters.freeText.expression" placeholder="Search">\n                    </div>\n                </div>\n\n                <!-- Authors -->\n                <div class="pnd-annotation-sidebar-filter">\n                    <div class="pnd-panel" ng-click = "toggleFilterList($event); searchAuthors=\'\'">\n                        Annotation author\n                    </div>\n                    <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                    	<span \n                            class="pnd-icon pnd-icon-filter" \n                            ng-class="setSearchIcon(searchAuthors.label)" \n                            ng-click="searchAuthors.label = \'\'"></span>\n                        <input class="form-control" ng-model="searchAuthors.label" placeholder="Filter">\n                    </div>\n                    <div class="pnd-sidebar-filter-scroll">\n	                    <div \n	                        ng-repeat="elem in filters.authors | orderObjectBy:\'count\':\'dsc\' | filter:searchAuthors" \n	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active}"\n	                        class="pnd-annotation-sidebar-filter-element">\n	                            <div \n	                                class="pnd-annotation-sidebar-filter-element-label"\n	                                ng-click="toggleFilter(\'authors\', elem.uri)">\n	                                    <span class="pnd-icon pnd-icon-check"\n	                                        ng-show="elem.active"></span>\n	                                    {{elem.label}} ({{elem.count}})\n	                            </div>\n	                    </div>\n                    </div>\n                </div>\n\n                <!-- Notebooks -->\n                <div class="pnd-annotation-sidebar-filter">\n                    <div class="pnd-panel" ng-click = "toggleFilterList($event); searchNotebooks=\'\'">\n                        Notebooks\n                    </div>\n                    <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        <span \n                            class="pnd-icon pnd-icon-filter" \n                            ng-class="setSearchIcon(searchNotebooks.label)" \n                            ng-click="searchNotebooks.label = \'\'"></span>\n                        <input class="form-control" ng-model="searchNotebooks.label" placeholder="Filter">\n                    </div>\n                    <div class="pnd-sidebar-filter-scroll">\n                        <div \n                            ng-repeat="elem in filters.notebooks | orderObjectBy:\'count\':\'dsc\' | filter:searchNotebooks" \n                            ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active}"\n                            class="pnd-annotation-sidebar-filter-element">\n                                <div \n                                    class="pnd-annotation-sidebar-filter-element-label"\n                                    ng-click="toggleFilter(\'notebooks\', elem.uri)">\n                                        <span class="pnd-icon pnd-icon-check"\n                                            ng-show="elem.active"></span>\n                                        {{elem.label}} ({{elem.count}})\n                                </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Types -->\n                <div class="pnd-annotation-sidebar-filter">\n                    <div class="pnd-panel" ng-click = "toggleFilterList($event); searchTypes=\'\'">\n                        Types\n                    </div>\n                    <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                        <span \n                            class="pnd-icon pnd-icon-filter" \n                            ng-class="setSearchIcon(searchTypes.label)" \n                            ng-click="searchTypes.label = \'\'"></span>\n                        <input class="form-control" ng-model="searchTypes.label" placeholder="Filter">\n                    </div>\n                    <div class="pnd-sidebar-filter-scroll">\n	                    <div ng-repeat="elem in filters.types | orderObjectBy:\'count\':\'dsc\' | filter:searchTypes" \n	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active}"\n	                        class="pnd-annotation-sidebar-filter-element">\n	                            <div \n	                                class="pnd-annotation-sidebar-filter-element-label"\n	                                ng-click="toggleFilter(\'types\', elem.uri)">\n	                                    <span class="pnd-icon pnd-icon-check"\n	                                          ng-show="elem.active"></span>\n	                                {{elem.label}} ({{elem.count}})\n	                            </div>\n	                    </div>\n                    </div>\n                </div>\n\n                <!-- Used predicate -->\n                <div class="pnd-annotation-sidebar-filter">\n                    <div class="pnd-panel" \n                        ng-click = "toggleFilterList($event); searchPredicates=\'\'">\n                        Used predicate\n                    </div>\n                    <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                    	<span \n                            class="pnd-icon pnd-icon-filter" \n                            ng-class="setSearchIcon(searchPredicates.label)" \n                            ng-click="searchPredicates.label = \'\'"></span>\n                        <input class="form-control" ng-model="searchPredicates.label" placeholder="Filter">\n                    </div>\n                    <div \n                        ng-repeat="elem in filters.predicates | orderObjectBy:\'count\':\'dsc\' | filter:searchPredicates" \n                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active}"\n                        class="pnd-annotation-sidebar-filter-element">\n                            <div \n                                class="pnd-annotation-sidebar-filter-element-label"\n                                ng-click="toggleFilter(\'predicates\', elem.uri)">\n                                    <span class="pnd-icon pnd-icon-check"\n                                          ng-show="elem.active"></span>\n                                {{elem.label}} ({{elem.count}})\n                            </div>\n                    </div>\n                </div>\n\n                <!-- Entities -->\n                <div class="pnd-annotation-sidebar-filter">\n                    <div class="pnd-panel" ng-click = "toggleFilterList($event); searchEntities=\'\'">\n                        Entities\n                    </div>\n                    <div class="pnd-annotation-sidebar-filter-input pnd-annotation-sidebar-filter-search">\n                    	<span \n                            class="pnd-icon pnd-icon-filter" \n                            ng-class="setSearchIcon(searchEntities.label)" \n                            ng-click="searchEntities.label = \'\'"></span>\n                        <input class="form-control" ng-model="searchEntities.label" placeholder="Filter">\n                    </div>\n                    <div class="pnd-sidebar-filter-scroll">\n	                    <div \n	                        ng-repeat="elem in filters.entities | orderObjectBy:\'count\':\'dsc\' | filter:searchEntities" \n	                        ng-class="{\'pnd-annotation-sidebar-current-filter-active\': elem.active}"\n	                        class="pnd-annotation-sidebar-filter-element">\n	                            <div \n	                                class="pnd-annotation-sidebar-filter-element-label"\n	                                ng-click="toggleFilter(\'entities\', elem.uri)">\n	                                    <span class="pnd-icon pnd-icon-check"\n	                                          ng-show="elem.active"></span>\n	                                {{elem.label}} ({{elem.count}})\n	                            </div>\n	                    </div>\n                    </div>\n                </div>\n\n                <!-- Date -->\n                <div class="pnd-annotation-sidebar-filter">\n                    <div class="pnd-panel" ng-click = "toggleFilterList($event)">Date</div>\n                    <span \n                        ng-show="isFilterLabelShowed(annotationSidebar.filters.fromDate.expression)"\n                        class="pnd-annotation-sidebar-filter-label">\n                            From: {{annotationSidebar.filters.fromDate.expression}}\n                    </span>\n                    <span \n                        ng-show="isFilterLabelShowed(annotationSidebar.filters.toDate.expression)"\n                        class="pnd-annotation-sidebar-filter-label">\n                            To: {{annotationSidebar.filters.toDate.expression}}\n                    </span>\n\n                    <div class="pnd-annotation-sidebar-filter-input">\n                        <!-- From Date -->\n                        <input \n                            type="text" \n                            class="form-control" \n                            ng-model="annotationSidebar.filters.fromDate.expression" \n                            data-min-date="{{fromMinDate}}" \n                            data-max-date="{{fromMaxDate}}" \n                            placeholder="From" \n                            data-autoclose="1" \n                            data-date-type="string" \n                            data-date-format="yyyy-MM-dd" \n                            bs-datepicker\n                        >\n\n                        <!-- To Date -->\n                        <input \n                            type="text" \n                            class="form-control" \n                            ng-model="annotationSidebar.filters.toDate.expression" \n                            data-min-date="{{toMinDate}}" \n                            data-max-date="{{toMaxDate}}" \n                            placeholder="To" \n                            data-autoclose="1" \n                            data-date-type="string" \n                            data-date-format="yyyy-MM-dd" \n                            bs-datepicker\n                        >\n                        </div>\n                </div>\n                <!-- buttons -->\n                <div class="pnd-annotation-footer-sidebar-filter">\n	                <button type="button" class="btn btn-xs btn-success pnd-annotation-sidebar-btn-close-filters" ng-click="annotationSidebar.toggleFiltersContent()">Hide filters</button>\n	                <button type="button" class="btn btn-xs btn-success pnd-annotation-sidebar-btn-remove-filters" ng-click="annotationSidebar.resetFilters()">Remove all filters</button>\n                </div>\n                <!-- // end buttons -->\n            </div>\n        </div>\n\n        <div class="pnd-annotation-details-opacity" ng-show="isFiltersShowed">\n        </div>\n\n        <!-- Suggestions panel -->\n        <div class="pnd-annotation-sidebar-annotations" ng-show="isSuggestionsPanelActive()">\n            TODO! :)\n        </div>\n\n        <!-- List of annotations -->\n        <div \n            class="pnd-annotation-sidebar-annotations" \n            ng-show="isAnnotationsPanelActive()">\n\n            <!-- Loading -->\n            <div ng-show="isLoading" class="pnd-saving-content">\n            	<span class="pnd-icon pnd-icon-refresh pnd-icon-spin pnd-icon-2x"></span>\n                <span class="pnd-message">Loading</span>\n            </div>\n\n            <div ng-repeat="ann in filtered = (annotations)">\n                <!-- <annotation-details id="{{ann.id}}"></annotation-details> -->\n                <annotation-details id="{{ann.id}}" style="position: absolute; top: {{annotationSidebar.annotationPositionReal[ann.id].top}}px"></annotation-details>\n            </div>  \n        </div>\n    </div>\n</div>')}]),angular.module("src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html","<annotation-sidebar></annotation-sidebar>")}]),angular.module("src/Annotators/TextFragmentIcon.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Annotators/TextFragmentIcon.dir.tmpl.html",'<span\n    ng-mouseover="mouseoverHandler()"\n    ng-mouseout="mouseoutHandler()"\n    ng-click="clickHandler($event)"\n    class="{{textFragmentIconClass}} {{iconClass}}">\n</span>')}]),angular.module("src/ContextualMenu/dropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ContextualMenu/dropdown.tmpl.html",'<ul class="dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-notebook\': item.currentNotebook, divider: item.divider, \'disabled\': item.disable, \'dropdown-submenu\': item.submenu, active: item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text"></span>\n        <a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && item.href" ng-bind="item.text"></a>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="item.submenu" ng-mouseover="$eval(item.hover);" ng-mouseleave="$eval(item.leave);" ng-bind="item.text"></a>\n    </li>\n</ul>')}]),angular.module("src/Core/confirm.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/confirm.modal.tmpl.html",'<div class="modal pnd-login-modal-container" tabindex="-1" role="dialog">\n\n    <div class="modal-dialog">\n\n        <div class="modal-content">\n\n            <div class="modal-header">\n                <h4 class="modal-title"> {{titleMessage}} </h4>\n            </div>\n\n            <div class="modal-body pnd-login-modal-body">\n                {{notifyMessage}}\n            </div>\n\n            <div class="modal-footer pnd-login-modal-footer">\n                <button type="button" class="btn btn-default pnd-login-modal-cancel" ng-click="cancel()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-login-modal-openPopUp" ng-click="confirm()">Confirm</button>\n            </div> <!-- end modal-footer -->\n\n        </div> <!-- end modal content-->\n\n    </div> <!-- end modal dialog-->\n\n</div> <!-- end modal -->')}]),angular.module("src/Core/login.modal.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Core/login.modal.tmpl.html",'<div class="modal pnd-login-modal-container" tabindex="-1" role="dialog" ng-controller="LoginModalCtrl">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title"> Login </h4>\n            </div>\n            <div class="modal-body pnd-login-modal-body">\n                {{notifyMessage}}\n            </div>\n            <div class="modal-footer pnd-login-modal-footer">\n                <button type="button" class="btn btn-default pnd-login-modal-close" ng-show="isUserLogged()" ng-click="closeModal()">Close</button>\n                <button type="button" class="btn btn-default pnd-login-modal-cancel" ng-show="!isUserLogged()" ng-click="cancelModal()">Cancel</button>\n                <button type="button" class="btn btn-default pnd-login-modal-openPopUp" ng-show="!isUserLogged()" ng-click="loginPopUp()">Open the login window</button>\n            </div> <!-- end modal-footer -->\n        </div> <!-- end modal content-->\n    </div> <!-- end modal dialog-->\n</div> <!-- end modal -->\n\n\n')
}]),angular.module("src/Dashboard/ClientDashboard.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/ClientDashboard.tmpl.html","<dashboard></dashboard>")}]),angular.module("src/Dashboard/Dashboard.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/Dashboard.dir.tmpl.html",'<div class="pnd-ignore">\n\n    <div class="pnd-dashboard-container" ng-show="isDashboardVisible">\n\n        <!--footer-->\n        <div class="pnd-dashboard-footer" ng-mousedown="footerMouseDownHandler($event)"></div>\n\n    </div>\n\n</div>')}]),angular.module("src/Dashboard/DashboardPanel.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/DashboardPanel.dir.tmpl.html",'<div class="pnd-dashboard-panel" ng-class="{\'pnd-dashboard-panel-last\': isLast}"\n     style="width: {{width}}px; left: {{left}}px; bottom: {{bottom}}px;">\n\n    <div class="pnd-dashboard-panel-expanded" ng-hide="isCollapsed">\n        <!--<div class="pnd-dashboard-panel-nav"></div>-->\n        <div class="pnd-dashboard-panel-content" pnd-tabs="tabs">\n            <!-- the content comes from outside-->\n        </div>\n        <button type="button" class="btn btn-xs btn-default pnd-btn-dashboard" ng-click="toggleCollapse()"><span class="pnd-icon pnd-icon-times"></span></button>\n    </div>\n\n    <div class="pnd-dashboard-panel-collapsed" ng-show="isCollapsed" style="width: {{collapsedWidth}}px;">\n        <div class="pnd-dashboard-panel-collapsed-content"></div>\n        <button type="button" class="btn btn-xs btn-default  pnd-btn-dashboard" ng-click="toggleCollapse()"><span class="pnd-icon pnd-icon-expand"></span></button>\n    </div>\n\n    <div class="pnd-dashboard-panel-separator"\n         ng-mousedown="mouseDownHandler($event)"\n         ng-show="!isLast"></div>\n\n</div>')}]),angular.module("src/Dashboard/pndTabs.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Dashboard/pndTabs.dir.tmpl.html",'<ul class="nav nav-tabs pnd-tab-header" ng-class="{\'pnd-hidden-tabs\': hiddenTabsToShow()}">\n    <li ng-repeat="pane in panes" ng-class="{active: $index == active}" ng-show="pane.isVisible">\n        <a data-toggle="tab" ng-click="setActive($index, $event)" data-index="{{$index}}" ng-bind-html="pane.title"></a>\n    </li>\n    <li class="pull-right show-tabs" ng-class="{active: hiddenTabIsActive}" placement="bottom-right" template="{{hiddenTabsDropdownTemplate}}" bs-dropdown="hiddenTabs" ng-show="hiddenTabsToShow()">\n        <a><span class="pnd-icon  pnd-icon-bars"></span></a>\n    </li>\n</ul>\n<div class="tab-content pnd-tab-content">\n    <div ng-repeat="pane in panes" class="tab-pane" ng-class="[$index == active ? \'active\' : \'\']" ng-include="pane.template" ng-show="$index == active"></div>\n</div>')}]),angular.module("src/Item/Item.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Item/Item.dir.tmpl.html",'<div class="pnd-item" ng-class="{\'pnd-sticky-item\': isSticky()}" ng-mouseover="onItemMouseOver()" ng-mouseleave="onItemMouseLeave()">\n\n    <div class="pnd-item-buttons">\n        <button type="button" ng-click="onClickMenu($event)" class="btn btn-xs btn-link"><span class="pnd-icon pnd-icon-bars"></span></button>\n        <button type="button" ng-click="onClickSticky($event)" class="btn btn-xs btn-link"><span class="pnd-icon pnd-icon-thumb-tack"></span></button>\n    </div>\n\n    <div class="pnd-item-text">\n    	<span ng-show="item.type.length > 0" class="pnd-item-typeLabel">{{itemTypeLabel}}</span>\n        <span class="pnd-item-label">{{item.label}}</span>\n        \n    </div>\n\n</div>')}]),angular.module("src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html","<my-items-container></my-items-container>")}]),angular.module("src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link my-items-btn-delete" ng-click="onClickDeleteAllMyItems()"><span class="pnd-icon pnd-icon-times"></span></button>\n        <button type="button" class="btn btn-xs btn-link my-items-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering"><span class="pnd-icon pnd-icon-bars"></span></button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html","<my-notebooks-container></my-notebooks-container>")}]),angular.module("src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <!-- HEADER -->\n\n    <div class="pnd-panel-tab-content-header pnd-panel-tab-content-header-no-border">\n        <div class="left-inner-icon">\n            <span class="pnd-icon {{search.icon}}" ng-click="search.term = \'\'"></span>\n            <input type="text" ng-model="search.term" placeholder="search items" class="form-control">\n        </div>\n    </div> <!-- end pnd-panel-tab-content-header -->\n\n    <!-- CONTENT -->\n\n    <div class="pnd-panel-tab-content-content pnd-inner">\n        <ul class="list-group" ng-if="!message.flag">\n            <li class="list-group-item" ng-repeat="notebook in displayedNotebook | orderBy:getOrderProperty:reverse">\n                <notebook nid="{{notebook.id}}" menu-type="{{notebookMenuType}}"></notebook>\n            </li>\n        </ul>\n<div class="pnd-dashboard-welcome" ng-if="message.flag">{{message.text}}</div>\n    </div> <!-- end pnd-panel-tab-content-content -->\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link my-notebooks-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering"><span class="pnd-icon pnd-icon-bars"></span></button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html","<page-items-container></page-items-container>")}]),angular.module("src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link page-items-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering"><span class="pnd-icon pnd-icon-bars"></span></button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html","<vocabularies-container></vocabularies-container>")}]),angular.module("src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",'<div class="pnd-panel-tab-content">\n\n    <ng-include src="\'src/Lists/itemsContainer.tmpl.html\'"></ng-include>\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n        <button type="button" class="btn btn-xs btn-link vocab-items-btn-order" template="{{dropdownTemplate}}"\n                placement="top-left"\n                bs-dropdown="dropdownOrdering"><span class="pnd-icon pnd-icon-bars"></span></button>\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Lists/itemList.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/itemList.tmpl.html",'<ul class="list-group" ng-if="!message.flag">\n    <li class="list-group-item" ng-repeat="pndItem in displayedItems | orderBy:getOrderProperty:reverse">\n        <item uri="{{pndItem.uri}}" menu-type="{{itemMenuType}}"></item>\n    </li>\n</ul>\n<div class="pnd-dashboard-welcome" ng-if="message.flag">{{message.text}}</li>')}]),angular.module("src/Lists/itemsContainer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Lists/itemsContainer.tmpl.html",'<!-- HEADER -->\n\n<div class="pnd-panel-tab-content-header pnd-panel-tab-content-header-no-border">\n    <div class="left-inner-icon">\n        <span class="pnd-icon {{search.icon}}" ng-click="search.term = \'\'"></span>\n        <input type="text" ng-model="search.term" placeholder="search items" class="form-control">\n    </div>\n</div> <!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n\n<div class="pnd-panel-tab-content-content pnd-inner">\n    <div ng-model="tabs.activeTab" pnd-tabs="tabs"></div>\n</div> <!-- end pnd-panel-tab-content-content -->')}]),angular.module("src/Notebook/Notebook.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Notebook/Notebook.dir.tmpl.html",'<div class="pnd-item" ng-class="{\'pnd-sticky-item\': isSticky()}" ng-mouseover="onItemMouseOver()" ng-mouseleave="onItemMouseLeave()">\n\n    <div class="pnd-item-buttons">\n        <button type="button" ng-click="onClickMenu($event)" class="btn btn-xs btn-link"><span class="pnd-icon pnd-icon-bars"></span></button>\n        <button type="button" ng-click="onClickSticky($event)" class="btn btn-xs btn-link"><span class="pnd-icon pnd-icon-thumb-tack"></span></button>\n    </div>\n\n    <div class="pnd-item-text">\n        <!-- <span class="pnd-item-typeLabel">{{notebook.visibility}}</span> -->\n        <span ng-if="!notebook.isPublic()" class="pnd-icon pnd-icon-lock"></span>\n        <span ng-if="notebook.isPublic()" class="pnd-icon pnd-icon-group"></span> \n        <span ng-if="notebook.isCurrent()" class="pnd-icon pnd-icon-pencil-square"></span>   \n        <span class="pnd-item-label">{{notebook.label}}</span>\n    </div>\n\n</div>')}]),angular.module("src/Preview/ClientDashboardPreview.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/ClientDashboardPreview.tmpl.html","<preview></preview>")}]),angular.module("src/Preview/DashboardPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/DashboardPreview.dir.tmpl.html",'<div class="pnd-panel-tab-content pnd-preview {{getItemClass()}}">\n\n    <!-- HEADER -->\n\n    <div class="pnd-panel-tab-content-header">\n        <span ng-if="!isItemEmpty()" class="{{getItemIcon()}}"></span>\n        <span class="pnd-dashboard-preview-panel-heading" ng-if="isItemEmpty()">{{getWelcomeHeaderMessage()}}</span>\n        <span class="pnd-dashboard-preview-panel-label" ng-if="!isItemEmpty()">{{itemDashboardPreview.label}}</span>\n    </div> <!-- end pnd-panel-tab-content-header -->\n\n    <!-- CONTENT -->\n\n    <!-- show welcome content when preview is empty -->\n    <div class="pnd-panel-tab-content-content pnd-inner-scrollable">\n        <span class="pnd-dashboard-welcome" ng-if="isItemEmpty()">{{getWelcomeBodyMessage()}}</span>\n\n        <item-preview ng-if="!isItemEmpty() && !isNotebook()" uri="{{itemDashboardPreview.uri}}"></item-preview>\n        <notebook-preview ng-if="!isItemEmpty() && isNotebook()" id="{{itemDashboardPreview.id}}"></notebook-preview>\n\n    </div> <!-- end pnd-panel-tab-content-content -->\n\n    <!-- FOOTER -->\n\n    <div class="pnd-panel-tab-content-footer">\n\n        <!-- More info -->\n        <button class="btn btn-success btn-xs pnd-dashboard-preview-more-info-button" ng-if="!itemIsAnImage && !isNotebook()" ng-click="openUrl(itemDashboardPreview.uri)" ng-class="{disabled: !isStickyItem()}">More info</button>\n        <button class="btn btn-success btn-xs pnd-dashboard-preview-more-info-button" ng-if="!itemIsAnImage && isNotebook()" ng-click="openNotebookUrl(itemDashboardPreview.id)" ng-class="{disabled: !isStickyItem()}">More info</button>\n        <!-- Clear Sticky Icon -->\n        <button class="btn btn-success btn-xs pnd-dashboard-preview-clear-sticky-button" ng-click="clearSticky()" ng-class="{disabled: !isStickyItem()}">Clear Sticky</button>\n        <!-- Open image -->\n        <button class="btn btn-link btn-xs pnd-dashboard-preview-external-modal-button" ng-class="{disabled: !isStickyItem()}" ng-if="itemIsAnImage"><span class="pnd-icon pnd-icon-external-link"></span></button>\n\n    </div> <!-- end pnd-panel-tab-content-footer -->\n\n</div>')}]),angular.module("src/Preview/ItemPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/ItemPreview.dir.tmpl.html",'<div class="pnd-preview-item-types">\n    <ul class="pnd-preview-item-types-ul">\n        <li class="pnd-preview-single-type" ng-class="{\'pnd-is-sticky\': isSticky}" ng-repeat="type in item.type">{{getTypeLabel(type)}}</li>\n    </ul>\n    <div ng-show="typeHiddenPresent" ng-class="{\'pnd-icon-caret-down\': typeHidden, \'pnd-icon-caret-up\': !typeHidden}" class="pnd-icon" ng-click="showAlltypes()"></div>\n</div>\n\n<div ng-if="item.image" class="pnd-preview-item-image">\n    <img ng-src="{{item.image}}" />\n</div>\n\n<div class="pnd-preview-item-description">\n    <p>{{item.description}}</p>\n</div>\n')}]),angular.module("src/Preview/NotebookPreview.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Preview/NotebookPreview.dir.tmpl.html",'<div class="pnd-dashboard-welcome">\n	<div class="pnd-preview-notebook-visibility">\n	    <span><strong>Visibility:</strong> </span> <span>{{notebook.visibility}}</span>\n	</div>\n	<div class="pnd-preview-notebook-annotations">\n	    <span><strong>Annotations:</strong>  </span> <span>{{notebook.includes.length}}</span>\n	</div>\n	<div class="pnd-preview-notebook-creator">\n	    <span><strong>Creator:</strong>  </span> <span>{{notebook.creatorName}}</span>\n	</div>\n	\n	<div class="pnd-preview-notebook-date">\n	    <span><strong>Creation date:</strong>  </span> <span>{{notebook.created}}</span>\n	</div>\n	<div class="pnd-preview-notebook-current" ng-show="isCurrent">\n	    <p>current notebook</p>\n	</div>\n</div>')}]),angular.module("src/ResourcePanel/datepicker.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/datepicker.tmpl.html",'<div class="dropdown-menu datepicker pnd-date-picker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px; position: static;">\n<table style="table-layout: fixed; height: 100%; width: 100%;">\n  <thead>\n    <tr class="text-center">\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)">\n          <i class="glyphicon glyphicon-chevron-left"></i>\n        </button>\n      </th>\n      <th colspan="{{ rows[0].length - 2 }}">\n        <button tabindex="-1" type="button" class="btn btn-default btn-block text-strong"  ng-click="$toggleMode()">\n          <strong style="text-transform: capitalize;" ng-bind="title"></strong>\n        </button>\n      </th>\n      <th>\n        <button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)">\n          <i class="glyphicon glyphicon-chevron-right"></i>\n        </button>\n      </th>\n    </tr>\n    <tr ng-show="showLabels" ng-bind-html="labels"></tr>\n  </thead>\n  <tbody>\n    <tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%">\n      <td class="text-center" ng-repeat="(j, el) in row">\n        <button tabindex="-1" type="button" class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected}" ng-click="$select(el.date)" ng-disabled="el.disabled">\n          <span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span>\n        </button>\n      </td>\n    </tr>\n  </tbody>\n</table>\n<button class="btn btn-sm btn-success"  ng-click="save()">Save</button>\n<button class="btn btn-sm btn-success" ng-click="cancel()">Cancel</button>\n</div>\n')}]),angular.module("src/ResourcePanel/popoverCalendar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverCalendar.tmpl.html",'<div class="popover popover-datepicker pnd-popover-calendar">\n    <div class="arrow"></div>\n    <h3 class="popover-title">Calendar</h3>\n\n    <div class="popover-content">\n        <div class="form-group">\n            <label class="control-label"><i class="fa fa-calendar"></i> Date </label>\n            <input type="text" ng-model="selectedDate"\n                   class="form-control pnd-input-calendar"\n                   trigger="click" data-date-format="dd/MM/yyyy" template="src/ResourcePanel/datepicker.tmpl.html" bs-datepicker>\n        </div>\n        <!--<button class="btn btn-sm btn-success"  ng-click="save()">Save</button>\n        <button class="btn btn-sm btn-success" ng-click="cancel()">Cancel</button>-->\n    </div>\n</div>')}]),angular.module("src/ResourcePanel/popoverLiteralText.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverLiteralText.tmpl.html",'<div class="popover pnd-popover-literal">\n    <div class="arrow"></div>\n    <h3 class="popover-title">Choose your...</h3>\n    <div class="popover-content">\n	    <div class="form-group">\n		    <textarea class="form-control pnd-popover-literal-textarea" rows="6" ng-model="literalText"></textarea>\n		</div>\n		    <button class="btn btn-sm btn-success" ng-class="{disabled: literalText == \'\'}" ng-click="save()">Save</button>\n		    <button class="btn btn-sm btn-success" ng-click="cancel()">Cancel</button>\n    </div>\n</div>')}]),angular.module("src/ResourcePanel/popoverResourcePanel.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/ResourcePanel/popoverResourcePanel.tmpl.html",'<div class="popover pnd-resource-panel-popover" ng-controller="ResourcePanelCtrl">\n    <div class="arrow"></div>\n\n    <h3 class="popover-title pnd-resource-panel-popover-title">Choose your...<span style="float:right" class="pnd-icon-times" ng-click="cancel()"></span></h3>\n    <div class="popover-content pnd-resource-panel-popover-content panel-group" id="accordion">\n\n	    <div ng-show = "type != \'pr\' && myItems.length>0 && userLoggedIn"> My items ({{myItems.length}})\n            <span class="pull-left"><i ng-class="{\'pnd-icon-caret-down\': caretMyItems, \'pnd-icon-caret-right\': !caretMyItems}"ng-click="toggleMyItems()"></i></span>\n            <ul class="list-group panel-collapse collapse in" ng-class="{\'in\': userLoggedIn}" id="collapseMyItems">\n                <li class="list-group-item" ng-repeat="mi in myItems | orderBy:getOrderProperty">\n                    <item uri="{{mi.uri}}" ng-click="save(mi)"></item>\n                </li>\n            </ul>\n	    </div>\n\n	    <div ng-show = "type != \'pr\' && pageItems.length>0" class="pnd-page-items-header"> Page Items ({{pageItems.length}})\n            <span class="pull-left"><i ng-class="{\'pnd-icon-caret-down\': caretPageItems, \'pnd-icon-caret-right\': !caretPageItems}"ng-click="togglePageItems()"></i></span>\n            <ul class="list-group panel-collapse collapse" ng-class="{\'in\': !userLoggedIn}" id ="collapsePageItems">\n                <li class="list-group-item" ng-repeat="pi in pageItems | orderBy:getOrderProperty">\n                    <item uri="{{pi.uri}}" ng-click="save(pi)"></item>\n                </li>\n            </ul>\n	    </div>\n\n        <div ng-show="type == \'obj\' && vocabObjStatus == \'loading\'">Searching...</div>\n        <div ng-repeat="s in selectors" ng-show="type == \'obj\' && vocabObjStatus == \'done\' && vocabObjRes[s].length>0"> {{s}} ({{vocabObjRes[s].length}})\n            <span class="pull-left pnd-vocab-{{s}} "><i class="pnd-icon-caret-right" ng-click="toggleObjVocab(s)"></i></span>\n            <ul class="list-group panel-collapse collapse" id ="obj-{{s}}">\n                <li class="list-group-item" ng-repeat = "item in vocabObjRes[s] | orderBy:getOrderProperty">\n                    <item uri="{{item.uri}}" ng-click="save(item)"></item>\n                </li>\n            </ul>\n        </div>\n\n        <div ng-show="type == \'sub\' && vocabSubStatus == \'loading\'">Searching...</div>\n        <div ng-repeat="ss in selectors" ng-show="type == \'sub\' && vocabSubStatus == \'done\' && vocabSubRes[ss].length>0"> {{ss}} ({{vocabSubRes[ss].length}})\n            <span class="pull-left pnd-sub-vocab-{{ss}} "><i class="pnd-icon-caret-right" ng-click="toggleSubVocab(ss)"></i></span>\n            <ul class="list-group panel-collapse collapse" id ="sub-{{ss}}">\n                <li class="list-group-item" ng-repeat = "subItem in vocabSubRes[ss]">\n                    <item uri="{{subItem.uri}}" ng-click="save(subItem)"></item>\n                </li>\n            </ul>\n        </div>\n\n        <div ng-show = "type == \'pr\' && properties.length>0"> Properties ({{properties.length}})\n            <!--<span class="pull-left"><i ng-class="{\'pnd-icon-caret-down\': caretProperties, \'pnd-icon-caret-right\': !caretProperties}"ng-click="toggleProperties()"></i></span>-->\n            <ul class="list-group" id ="collapseProperties">\n                <li class="list-group-item" ng-repeat="pr in properties | orderBy:getOrderProperty">\n                    <item uri="{{pr.uri}}" ng-click="save(pr)"></item>\n                </li>\n            </ul>\n        </div>\n\n        <div ng-show = "type == \'pr\' && properties.length == 0"> No properties match </div>\n        <div ng-show = "type == \'obj\' && vocabObjResEmpty && pageItems.length == 0 && myItems.length == 0 && vocabObjStatus == \'done\'"> No object match </div>\n        <div ng-show = "type == \'sub\' && vocabSubResEmpty && pageItems.length == 0 && myItems.length == 0 && vocabSubStatus == \'done\'"> No subject match </div>\n\n    </div>\n\n\n\n</div>')}]),angular.module("src/Toolbar/ClientToolbar.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/ClientToolbar.tmpl.html","<toolbar></toolbar>")}]),angular.module("src/Toolbar/Toolbar.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/Toolbar.dir.tmpl.html",'<nav class="navbar navbar-inverse navbar-fixed-top pnd-toolbar-navbar pnd-ignore" role="navigation"\n     ng-controller="ToolbarCtrl">\n    <div class="container-fluid pnd-toolbar-navbar-container">\n    \n        <div class="pnd-toolbar-navbar-collapse">\n            <ul class="nav navbar-nav pnd-toolbar-navbar-left">\n                \n                <!-- Error button -->\n                <li ng-show="showStatusButtonError()" class="pnd-toolbar-error-button">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="errorMessageDropdown"><span class="pnd-icon pnd-icon-exclamation-circle"></span></a>\n                </li>\n                \n                <!-- OK button -->\n                <li ng-show="showStatusButtonOk()" class="pnd-toolbar-status-button-ok">\n                    <a href="javascript:void(0)"><span class="pnd-icon pnd-icon-check"></span></a>\n                </li>\n\n                <!-- Loading button -->\n                <li ng-show="showStatusButtonLoading()" class="pnd-toolbar-loading-button">\n                    <a href="javascript:void(0)">\n                        <span></span>\n                    </a>\n                </li>\n\n                <!-- Login button -->\n                <li ng-show="showLogin()" class="pnd-toolbar-login-button pnd-toolbar-button-active">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="userNotLoggedDropdown"><span>Login</span></a>\n                </li>\n                \n                <!-- User button -->\n                <li ng-show="showUserButton()" class="pnd-toolbar-user-button  pnd-toolbar-button-active">\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="userLoggedInDropdown"><span>{{userData.fullName}}</span></a>\n                </li>\n                \n                <!-- Ask the Pundit button-->\n                <li ng-class="{true: \'pnd-toolbar-ask-button-active\', false: \'pnd-toolbar-ask-button-not-active\'}[isAskActive()]" class="pnd-toolbar-ask-button">\n                    <a href="{{getAskLink()}}" target="_blank">Ask the Pundit</a>\n                </li>\n                \n                <!-- Dashboard button -->\n                <li class="pnd-toolbar-dashboard-button">\n                    <a href="javascript:void(0)" ng-click="dashboardClickHandler()">\n                        <span ng-class="{true: \'pnd-toolbar-active-element\', false: \'pnd-toolbar-not-active-element\'}[isDashboardActive()] ">Dashboard</span>\n                    </a>\n                </li>\n\n            </ul> <!-- pnd-navbar-left -->\n\n            <ul class="nav navbar-nav navbar-right pnd-toolbar-navbar-right">\n                \n                <!-- Template mode button -->\n                <li class="pnd-toolbar-template-mode-button" ng-show="isTemplateModeActive()">\n                    <a href="javascript:void(0)">\n                        <span class="pnd-toolbar-active-element pnd-icon pnd-icon-pencil"></span>\n                    </a>\n                </li>\n                \n                <!-- Template menu -->\n                <li class="pnd-toolbar-template-menu-button" ng-show="isTemplateMenuActive()" >\n                    <a href="javascript:void(0)" template="{{dropdownTemplate}}" bs-dropdown="userTemplateDropdown"><span class="pnd-toolbar-active-element">Current template</span></a>\n                </li>\n                \n                <!-- Notebooks menu -->\n                <li class="pnd-toolbar-notebook-menu-button">\n                    <a ng-if="isNotebookMenuActive()" href="javascript:void(0)" placement="bottom-right" template="{{dropdownTemplateMyNotebook}}" bs-dropdown="userNotebooksDropdown"><span class="pnd-toolbar-active-element" ng-click="showMyNotebooks()">My Notebooks</span></a>\n                    <a ng-show="!isNotebookMenuActive()" href="javascript:void(0)" placement="bottom-right" template="{{dropdownTemplate}}" bs-dropdown="userNotLoggedDropdown"><span class="pnd-toolbar-not-active-element">My Notebooks</span></a>\n                </li>\n                \n                <!-- Annotations menu -->\n                <li class="pnd-toolbar-annotations-button">\n                    <a href="javascript:void(0)" ng-click="annotationsClickHandler()">\n                        <span class="pnd-toolbar-active-element">Annotations Sidebar</span>\n                    </a>\n                </li>\n\n            </ul> <!-- pnd-toolbar-navbar-right -->\n    \n        </div><!-- pnd-toolbar-navbar-collapse -->\n    </div><!-- pnd-toolbar-navbar-container -->\n</nav>\n\n\n\n              \n')}]),angular.module("src/Toolbar/myNotebooksDropdown.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Toolbar/myNotebooksDropdown.tmpl.html",'<ul class="dropdown-menu pnd-ignore" role="menu">\n    <li role="presentation" ng-class="{\'current-notebook\': item.currentNotebook, divider: item.divider, \'disabled\': item.disable, \'dropdown-submenu\': item.submenu, active: item.isActive, \'dropdown-header\': item.header}" ng-repeat="item in content">\n        <span ng-if="item.header" ng-bind="item.text">dksad</span>\n        <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()">\n        <span ng-if="item.visibility == \'private\'" class="pnd-icon pnd-icon-lock"></span>\n        <span ng-if="item.visibility == \'public\'" class="pnd-icon pnd-icon-group"></span>\n        <span ng-if="item.currentNotebook" class="pnd-icon pnd-icon-pencil-square"></span>\n        {{item.text}}</a>\n    </li>\n</ul>')}]),angular.module("src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html","<notebook-composer></notebook-composer>")}]),angular.module("src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",'<!-- HEADER -->\n\n<div class="pnd-panel-tab-content-header">\n    {{notebookComposerHeader}}\n</div> <!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n\n<div class="pnd-panel-tab-content-content">\n\n    <div class="form-group pnd-notebook-composer-container" ng-hide="saving">\n    	<p>\n        <input type="text" class="form-control" placeholder="Enter notebook name" ng-model="notebook.name">\n    	</p>\n        <div class="checkbox" ng-class="{\'pnd-notebook-composer-element-active\': notebook.current}">\n        <label>\n            <input type="checkbox" ng-model="notebook.current" ng-disabled="editMode && isCurrentNotebook">\n            <span class="pnd-icon pnd-icon-pencil-square"></span> Set as current\n        </label>\n        </div>\n        <div class="radio" ng-class="{\'pnd-notebook-composer-element-active\': notebook.visibility == \'public\'}">\n            <label>\n                <input type="radio" name="visibility" value="public" ng-model="notebook.visibility">\n                <span class="pnd-icon pnd-icon-group"></span> Public\n            </label>\n        </div>\n        <div class="radio" ng-class="{\'pnd-notebook-composer-element-active\': notebook.visibility == \'private\'}">\n            <label>\n                <input type="radio" name="visibility" value="private" ng-model="notebook.visibility">\n                <span class="pnd-icon pnd-icon-lock"></span> Private\n            </label>\n        </div>\n    </div>\n\n    <!-- message-->\n    <div class="pnd-notebook-saving-content" ng-if="saving">\n        <span class="pnd-icon {{savingIcon}} pnd-icon-2x"></span>\n        <span class="{{shortMessageClass}}">{{shortMessagge}}</span>\n        {{textMessage}}\n    </div>\n    <!-- // end message-->\n\n</div> <!-- end pnd-panel-tab-content-content -->\n\n<!-- FOOTER -->\n\n<div class="pnd-panel-tab-content-footer">\n\n    <button class="pnd-notebookcomposer-add-blank btn btn-success btn-xs" ng-if="!editMode" ng-class="{disabled: notebook.name == \'\'}" ng-click="save()">Save</button>\n    <button class="pnd-notebookcomposer-add-blank btn btn-success btn-xs" ng-if="editMode" ng-class="{disabled: notebook.name == \'\'}" ng-click="edit()">Save</button>\n    <button class="pnd-notebookcomposer-save btn btn-success btn-xs" ng-class="{disabled: notebook.name == \'\'}" ng-click="clear()">Clear</button>\n\n</div> <!-- end pnd-panel-tab-content-footer -->')}]),angular.module("src/Tools/TripleComposer/ClientTripleComposer.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/ClientTripleComposer.tmpl.html","<triple-composer></triple-composer>")}]),angular.module("src/Tools/TripleComposer/Statement.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/Statement.dir.tmpl.html",'<div class="pnd-statement-row clearfix">\n<div class="pnd-statement-widget">\n\n    <!-- Subject -->\n    <div class="pnd-statement-subject">\n\n        <!-- Incomplete Subject -->\n        <div ng-if="!subjectFound">\n\n            <!-- Subject Input div -->\n            <div class="left-inner-icon">\n                <span class="pnd-icon {{subjectIcon}}" ng-click="clearSubjectSearch()"></span>\n                <input type="text" class="input-sm form-control" placeholder="search a subject" ng-model="$parent.subjectSearch" ng-click="onClickSubject($event)" ng-keyup="onKeyUpSubject($event)">\n            </div>\n\n            <!-- Subject Buttons div -->\n            <div class="pnd-row-button-subject">\n                <!--Korbo Icon-->\n                <button type="button" class="btn btn-xs btn-link" title="add"><span class="pnd-icon pnd-icon-plus"></span></button>\n            </div>\n\n        </div>\n\n        <!-- Complete Subject -->\n        <div ng-if="subjectFound" ng-mouseover="subjectOver=true" ng-mouseleave="subjectOver=false">\n            <div class="pnd-statement-label">{{subjectLabel}}</div>\n            <!-- Subject buttons -->\n            <div class="pnd-row-button-subject">\n		            <button type="button" class="btn btn-xs btn-link" title="delete" ng-click="wipeSubject()"><span class="pnd-icon pnd-icon-trash-o"></span></button> {{subjectTypeLabel}}\n            </div>\n            <!-- // end Subject buttons -->\n        </div>\n\n    </div>\n\n    <!-- Predicate -->\n    <div class="pnd-statement-predicate">\n\n        <!-- Incomplete Predicate -->\n        <div ng-if="!predicateFound">\n\n            <!-- Predicate Input div -->\n            <div class="left-inner-icon">\n                <span class="pnd-icon {{predicateIcon}}" ng-click="clearPredicateSearch()"></span>\n                <input type="text" class="input-sm form-control" placeholder="search a predicate" ng-model="$parent.predicateSearch" ng-click="onClickPredicate($event)" ng-keyup="onKeyUpPredicate($event)">\n            </div>\n\n            <!-- Predicate Buttons div-->\n            <div class="pnd-row-button-predicate"></div>\n\n        </div>\n\n        <!-- Complete Predicate -->\n        <div ng-if="predicateFound" ng-mouseover="subjectOver=true" ng-mouseleave="subjectOver=false">\n	        <div class="pnd-statement-label">{{predicateLabel}}</div>\n	        <!-- Predicate buttons -->\n	        <div class="pnd-row-button-predicate">\n	            <button type="button" class="btn btn-xs btn-link" title="delete"  ng-click="wipePredicate()"><span class="pnd-icon pnd-icon-trash-o"></span></button>\n            </div>\n            <!-- // end Predicate buttons -->            \n        </div>\n\n    </div>\n\n    <!-- Object -->\n    <div class="pnd-statement-object">\n\n        <!-- Incomplete Object -->\n        <div ng-if="!objectFound">\n\n            <!-- Object Input div -->\n            <div class="left-inner-icon">\n                <span class="pnd-icon {{objectIcon}}" ng-click="clearObjectSearch()"></span>\n                <input type="text" class="input-sm form-control" placeholder="search an object" ng-model="$parent.objectSearch" ng-click="onClickObject($event)" ng-keyup="onKeyUpObject($event)">\n            </div>\n\n            <!-- Object Buttons div -->\n            <div class="pnd-row-button-object">\n                <!--Korbo Icon-->\n                <button type="button" class="btn btn-xs btn-link" title="add"><span class="pnd-icon pnd-icon-plus"></span></button>\n                <!--Calendar Icon-->\n                <button type="button" class="btn btn-xs btn-link" ng-if="canBeObjectDate" ng-click="onClickObjectCalendar($event)"  title="calendar"><span class="pnd-icon pnd-icon-table"></span></button>\n                <!--Pen Icon-->\n                <button type="button" class="btn btn-xs btn-link" ng-if="canBeObjectLiteral" ng-click="onClickObjectLiteral($event)"  title="text"><span class="pnd-icon pnd-icon-pencil"></span></button>\n            </div>\n\n        </div>\n\n        <!-- Complete Object -->\n        <div ng-if="objectFound" ng-mouseover="objectOver=true" ng-mouseleave="objectOver=false">\n	        <div class="pnd-statement-label">{{objectLabel}}</div>\n	        \n	        <!-- Object buttons -->\n            <div class="pnd-row-button-object">\n		            <button type="button" class="btn btn-xs btn-link" title="delete" ng-click="wipeObject()"><span class="pnd-icon pnd-icon-trash-o"></span></button>\n                    <!--Calendar Icon-->\n                    <button type="button" class="btn btn-xs btn-link" ng-if="objectDate" ng-click="onClickObjectCalendar($event)"  title="calendar"><span class="pnd-icon pnd-icon-table"></span></button>\n                    <!--Pen Icon-->\n                    <button type="button" class="btn btn-xs btn-link" ng-if="objectLiteral" ng-click="onClickObjectLiteral($event)"  title="text"><span class="pnd-icon pnd-icon-pencil"></span></button> {{objectTypeLabel}}\n            </div>\n            <!-- // end Object buttons -->\n	        \n        </div>\n\n    </div>\n</div><!-- // end widget -->\n\n    <!-- Right buttons -->\n    <div class="pnd-statement-buttons">\n        <!-- close icon -->\n        <button type="button" class="btn btn-xs btn-danger pnd-btn-statement" ng-click="remove()"  title="delete"><span class="pnd-icon pnd-icon-trash-o"></span></button>\n        <!-- copy icon -->\n        <button type="button" class="btn btn-xs btn-success pnd-btn-statement" ng-click="duplicate()"  title="copy"><span class="pnd-icon pnd-icon-copy"></span></button>\n    </div>\n\n</div>')
}]),angular.module("src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",[]).run(["$templateCache",function(a){a.put("src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",'<!-- HEADER -->\n\n<div class="pnd-panel-tab-content-header">\n    Triple Composer Header\n</div> <!-- end pnd-panel-tab-content-header -->\n\n<!-- CONTENT -->\n\n<div class="pnd-panel-tab-content-content">\n\n    <div class="pnd-triplecomposer-statements-container pnd-inner-scrollable" ng-hide="saving">\n        <statement ng-repeat="s in statements" id="{{s.id}}" duplicated="s.scope.duplicated"></statement>\n    </div>\n    <!-- message-->\n    <div class="pnd-triplecomposer-saving-content" ng-if="saving">\n        <span class="pnd-icon {{savingIcon}} pnd-icon-3x"></span>\n        <span class="{{shortMessageClass}}">{{shortMessagge}}</span>\n        {{textMessage}}\n    </div>\n    <!-- // end message-->\n</div> <!-- end pnd-panel-tab-content-content -->\n\n<!-- FOOTER -->\n\n<div class="pnd-panel-tab-content-footer">\n    \n    <button class="pnd-triplecomposer-add-blank btn btn-success btn-xs" ng-click="onClickAddStatement()">Add blank Statement</button>\n    \n    <button class="pnd-triplecomposer-save btn btn-success btn-xs disabled" ng-click="saveAnnotation()">Save all Statements to Server</button>\n    \n</div> <!-- end pnd-panel-tab-content-footer -->')}]),angular.module("Pundit2",["ngResource","ngSanitize","ngAnimate","mgcrea.ngStrap","templates-main","Pundit2.Core","Pundit2.Annomatic","Pundit2.AnnotationSidebar","Pundit2.Dashboard","Pundit2.Toolbar","Pundit2.Communication","Pundit2.Annotators","Pundit2.ContextualMenu","Pundit2.Preview","Pundit2.Client","Pundit2.PageItemsContainer","Pundit2.Item","Pundit2.MyItemsContainer","Pundit2.ResourcePanel","Pundit2.Vocabularies","Pundit2.TripleComposer","Pundit2.NotebookComposer","Pundit2.MyNotebooksContainer","Pundit2.Notebook"]),angular.module("Pundit2.Client",[]),angular.module("Pundit2.Client").run(["Config","Client",function(a,b){a.isModuleActive("Client")&&b.boot()}]).constant("CLIENTDEFAULTS",{debug:!1,relationsContainer:"usableRelations",bootModules:["Toolbar","Dashboard","AnnotationSidebar","Preview","SelectorsManager","PageItemsContainer","MyNotebooksContainer","MyItemsContainer","NotebookComposer","TripleComposer"],basicRelations:[{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"has comment (free text)",description:"Any comment related to the selected fragment of text or image",domain:["http://purl.org/pundit/ont/ao#fragment-image","http://purl.org/pundit/ont/ao#fragment-text","http://xmlns.com/foaf/0.1/Image"],range:["http://www.w3.org/2000/01/rdf-schema#Literal"],uri:"http://schema.org/comment"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"depicts",description:"An image or part of an image depicts something",domain:["http://xmlns.com/foaf/0.1/Image","http://purl.org/pundit/ont/ao#fragment-image"],range:[],uri:"http://xmlns.com/foaf/0.1/depicts"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is similar to",description:"The selected fragment (text or image fragment) is similar to another fragment (of the same or of different types)",domain:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],range:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],uri:"http://purl.org/pundit/vocab#similarTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"has creator",description:"The selected text fragment has been created by a specific Person",domain:["http://purl.org/pundit/ont/ao#fragment-text","http://purl.org/pundit/ont/ao#fragment-image","http://xmlns.com/foaf/0.1/Image"],range:["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person"],uri:"http://purl.org/dc/terms/creator"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"cites",description:"The selected text fragment cites another text fragment, or a Work or a Person",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://purl.org/pundit/ont/ao#fragment-text","http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],uri:"http://purl.org/spar/cito/cites"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"quotes",description:"The selected text fragment is a sentence from a Person or a Work, usually enclosed by quotations (eg: '')",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/people/person","http://xmlns.com/foaf/0.1/Person","http://dbpedia.org/ontology/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],uri:"http://purl.org/spar/cito/includesQuotationFrom"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"talks about",description:"The selected text fragment talks about some other text, Entity, Person or any other kind of concept",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:[],uri:"http://purl.org/pundit/ont/oa#talksAbout"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is related to",description:"The selected text fragment is someway related to another text, Entity, Person or any other kind of concept",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:[],uri:"http://purl.org/pundit/ont/oa#isRelatedTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"identifies",description:"The selected text fragment is a Person, a Work, a Place or a well defined Entity",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/location/location","http://dbpedia.org/ontology/Place","http://schema.org/Place","http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing","http://www.freebase.com/schema/people/person","http://dbpedia.org/ontology/Person","http://xmlns.com/foaf/0.1/Person","http://www.freebase.com/schema/book/written_work","http://www.freebase.com/schema/book/book"],uri:"http://purl.org/pundit/ont/oa#identifies"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is date",description:"The selected text fragment corresponds to the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],uri:"http://purl.org/pundit/ont/oa#isDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"period of dates starts at",description:"The selected text fragment corresponds to the specified date period which starts at the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],uri:"http://purl.org/pundit/ont/oa#periodStartDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"period of dates ends at",description:"The selected text fragment corresponds to the specified date period which ends at the specified Date",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2001/XMLSchema#dateTime"],uri:"http://purl.org/pundit/ont/oa#periodEndDate"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"translates to",description:"The selected text fragment translation is given as free text",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.w3.org/2000/01/rdf-schema#Literal"],uri:"http://purl.org/pundit/ont/oa#translatesTo"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is translation of",description:"The selected text fragment is the translation of another text fragment",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://purl.org/pundit/ont/ao#fragment-text"],uri:"http://purl.org/pundit/ont/oa#isTranslationOf"},{type:["http://www.w3.org/1999/02/22-rdf-syntax-ns#Property"],label:"is written in",description:"The selected text fragment is written in the specified language (french, german, english etc)",domain:["http://purl.org/pundit/ont/ao#fragment-text"],range:["http://www.freebase.com/schema/language/human_language"],uri:"http://purl.org/pundit/ont/oa#isWrittenIn"}]}).service("Client",["CLIENTDEFAULTS","BaseComponent","Config","MyPundit","ImageFragmentAnnotator","TextFragmentAnnotator","AnnotationsCommunication","AnnotationsExchange","Item","ItemsExchange","MyItems","TextFragmentHandler","Toolbar","Annomatic","NotebookCommunication","NotebookExchange","SelectorsManager","FreebaseSelector","MurucaSelector","KorboBasketSelector","$injector","$templateCache","$rootScope",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){var x,y=new b("Client",a),z=function(){x=angular.element("[data-ng-app='Pundit2']"),x.hasClass("pnd-wrp")||x.addClass("pnd-wrp")},A=function(){for(var a=0,b=y.options.bootModules.length;b>a;a++){var d=y.options.bootModules[a];if(c.isModuleActive(d)){var e,f=u.get(d);"clientDomTemplate"in f.options?(e=v.get(f.options.clientDomTemplate),"undefined"==typeof e?y.err("Can not bootstrap module "+f.name+", template not found: "+f.options.clientDomTemplate):(x.append(e),y.log("Appending to DOM "+f.name,e))):"clientDashboardTemplate"in f.options&&"clientDashboardPanel"in f.options&&"clientDashboardTabTitle"in f.options&&c.isModuleActive("Dashboard")?(e=v.get(f.options.clientDashboardTemplate),"undefined"==typeof e?y.err("Can not bootstrap module "+f.name+", template not found: "+f.options.clientDashboardTemplate):(u.get("Dashboard").addContent(f.options.clientDashboardPanel,f.options.clientDashboardTabTitle,f.options.clientDashboardTemplate),y.log("Adding to Dashboard: "+f.name+" to panel "+f.options.clientDashboardPanel))):y.err("Did not bootstrap module "+d+": .options parameters missing.")}else y.log("Not bootstrapping "+d+": not active.")}},B=function(){var a=0,b=y.options.basicRelations;for(var c in b){var d=new i(b[c].uri,b[c]);j.addItemToContainer(d,y.options.relationsContainer)}y.log("Loaded "+a+" basic relations")};y.boot=function(){z(),c.useBasicRelations&&B(),d.checkLoggedIn().then(function(a){a===!0&&(k.getAllItems(),o.getMyNotebooks().then(function(){o.getCurrent()})),g.getAnnotations(),w.$watch(function(){return d.isUserLogged()},function(a,b){a!==b&&(a===!0?(y.log("User just logged in"),C()):(y.log("User just logged out"),D()))})}),q.init(),A(),y.log("Boot is completed, emitting pundit-boot-done event"),w.$emit("pundit-boot-done")};var C=function(){p.wipe(),j.wipe(),h.wipe(),o.getMyNotebooks().then(function(){o.getCurrent()}),g.getAnnotations(),k.getAllItems(),B()},D=function(){p.wipe(),j.wipe(),h.wipe(),g.getAnnotations(),B()};return y.log("Component up and running"),y}]),angular.module("Pundit2.Core",[]),angular.module("Pundit2.Core").service("Utils",function(){var a={};return a.deepExtend=function(a,b){for(var c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},arguments.callee(a[c],b[c])):a[c]=angular.copy(b[c]);return a},a.getLabelFromURI=function(a){var b;return a.match("http://www.freebase.com/schema/")?b=a.substring(31).replace(/\//g,": ").replace(/_/g," "):a.match("http://dbpedia.org/ontology/")?b=a.substring(28).replace(/([A-Z])/g," $1").replace(/^./,function(a){return a.toUpperCase()}):(b=a.substring(a.lastIndexOf("/")+1),-1!==b.indexOf("#")&&(b=b.substring(b.lastIndexOf("#")+1)),b)},a}),angular.module("Pundit2.Core").constant("BASECOMPONENTDEFAULTS",{debug:!1}).service("BaseComponent",["$log","Utils","BASECOMPONENTDEFAULTS","$window","Config",function(a,b,c,d,e){var f=function(a,f){this.name=a,this.options=angular.copy(c),"undefined"!=typeof f&&b.deepExtend(this.options,f),"undefined"==typeof d.PUNDIT&&(d.PUNDIT={config:e},this.log("Created PUNDIT global object")),"undefined"!=typeof e.modules[this.name]&&(b.deepExtend(this.options,e.modules[this.name]),this.log("BaseComponent extending with Config.modules conf")),e.modules[this.name]=this.options};return f.prototype.err=function(){var b=function(){try{throw Error("")}catch(a){return a}},c=b(),d=c.stack.split("\n")[5],e=Array.prototype.slice.call(arguments);e.unshift("#PUNDIT "+this.name+"#"),e.push(d),a.error.apply(null,e)},f.prototype.log=function(){if(e.debugAllModules===!0||this.options.debug===!0){var b=Array.prototype.slice.call(arguments);b.unshift("#"+this.name+"#"),a.log.apply(null,b)}},f}]),angular.module("Pundit2.Core").service("NameSpace",["BaseComponent","Config","$interpolate","$window",function(a,b,c,d){var e=new a("NameSpace"),f="http://www.w3.org/1999/02/22-rdf-syntax-ns#",g="http://www.w3.org/2000/01/rdf-schema#",h="http://purl.org/dc/elements/1.1/",i="http://purl.org/dc/terms/",j="http://purl.org/pundit/ont/ao#",k="http://www.w3.org/2004/02/skos/core#";return d.PUNDIT.ns=e,e.punditOntologyBaseURL=j,e.rdf={},e.rdf.type=f+"type",e.rdf.value=f+"value",e.rdf.property=f+"Property",e.rdfs={},e.rdfs.label=g+"label",e.rdfs.comment=g+"comment",e.rdfs.resource=g+"Resource",e.rdfs.literal=g+"Literal",e.rdfs.seeAlso=g+"seeAlso",e.dateTime="http://www.w3.org/2001/XMLSchema#dateTime",e.item={label:e.rdfs.label,altLabel:k+"altLabel",description:h+"description",image:"http://xmlns.com/foaf/0.1/depiction",type:e.rdf.type,pageContext:j+"hasPageContext",isPartOf:i+"isPartOf",selector:"http://www.w3.org/ns/openannotation/core/hasSelector",parentItemXP:j+"parentItemXP"},e.notebook={label:e.rdfs.label,visibility:"http://open.vocab.org/terms/visibility",created:i+"created",creator:i+"creator",creatorName:h+"creator",id:j+"id",includes:j+"includes",type:e.rdf.type},e.annotation={creatorName:h+"creator",created:i+"created",creator:i+"creator",modified:i+"modified",pageContext:j+"hasPageContext",target:"http://www.openannotation.org/ns/hasTarget",isIncludedIn:j+"isIncludedIn"},e.fragments={imagePart:j+"fragment-image",text:j+"fragment-text"},e.types={page:"http://schema.org/WebPage",image:"http://xmlns.com/foaf/0.1/Image",named:j+"named-content"},e.typesLabels={},e.typesLabels[e.fragments.imagePart]="Image fragment",e.typesLabels[e.fragments.text]="Text fragment",e.typesLabels[e.types.page]="Web page",e.typesLabels[e.types.image]="Image",e.typesLabels[e.types.named]="Named content",e.selectors={baseURI:"http://purl.org/pundit/selector/",polygonType:"http://purl.org/pundit/ont/ao#selector-polygon",rectangleType:"http://purl.org/pundit/ont/ao#selector-rectangle"},e.as=b.annotationServerBaseURL,e.asUsers=e.as+"api/users/",e.asUsersCurrent=e.as+"api/users/current",e.asUsersLogout=e.as+"api/users/logout",e.asNB=e.as+"api/notebooks",e.asNBEditMeta=e.as+"api/notebooks/{{id}}",e.asNBOwned=e.as+"api/notebooks/owned",e.asNBCurrent=e.as+"api/notebooks/current",e.asNBPrivate=e.as+"api/notebooks/private/{{id}}",e.asNBPublic=e.as+"api/notebooks/public/{{id}}",e.asNBMeta=e.as+"api/notebooks/{{id}}/metadata",e.asOpenNBMeta=e.as+"api/open/notebooks/{{id}}/metadata",e.asOpenNBAnnMeta=e.as+"api/open/notebooks/{{id}}/annotations/metadata",e.asAnnMetaSearch=e.as+"api/annotations/metadata/search",e.asOpenAnnMetaSearch=e.as+"api/open/metadata/search",e.asAnn=e.as+"api/annotations/{{id}}",e.asOpenAnn=e.as+"api/open/annotations/{{id}}",e.asPref=e.as+"api/services/preferences/{{key}}",e.get=function(a,b){if("string"!=typeof e[a])return void e.err("get() cant find key "+a);"undefined"==typeof b&&(b={});var d,f=e[a],g=f.match(/{{([a-zA-Z0-9]*)}}/g);if(null!==g&&g.length>0){var h=0;for(d in b)h++;if(g.length>h)return void e.err("Context variables mismatch! Expecting "+g.join(", ")+" instead got "+JSON.stringify(b))}return c(f)(b)},e.log("NameSpace up and running"),e}]),angular.module("Pundit2.Core").factory("Config",["PUNDITDEFAULTCONF","$window","Utils",function(a,b,c){var d={};return c.deepExtend(d,a),"undefined"!=typeof b.punditConfig&&angular.isObject(b.punditConfig)&&c.deepExtend(d,b.punditConfig),d.isModuleActive=function(a){return angular.isObject(d.modules[a])&&d.modules[a].active===!0},"undefined"==typeof b.PUNDIT&&(b.PUNDIT={config:d}),d}]),angular.module("Pundit2.Core").constant("PUNDITDEFAULTCONF",{annotationServerBaseURL:"http://demo-cloud.as.thepund.it:8080/annotationserver/",debugAllModules:!1,vocabularies:[],useBasicRelations:!0,modules:{Client:{active:!1},Dashboard:{active:!0},Toolbar:{active:!0},AnnotationSidebar:{active:!0},Preview:{active:!0},PageItemsContainer:{active:!0},MyNotebooksContainer:{active:!0},MyItemsContainer:{active:!0},SelectorsManager:{active:!0},TripleComposer:{active:!0},NotebookComposer:{active:!0}}}),angular.module("Pundit2.Core").constant("MYPUNDITDEFAULTS",{loginPollTimerMS:1e3,loginModalCloseTimer:1e3}).service("MyPundit",["BaseComponent","MYPUNDITDEFAULTS","NameSpace","$http","$q","$timeout","$modal","$window",function(a,b,c,d,e,f,g,h){var i,j,k=new a("MyPundit",b),l=!1,m={};k.getLoginStatus=function(){return j},k.isUserLogged=function(){return l},k.getUserData=function(){return""!==m&&"undefined"!=typeof m?m:void 0},k.checkLoggedIn=function(){var a,b=e.defer();return a=d({headers:{Accept:"application/json"},method:"GET",url:c.get("asUsersCurrent"),withCredentials:!0}).success(function(a){0===a.loginStatus?(l=!1,i=a.loginServer,b.resolve(!1)):(l=!0,j="loggedIn",m=a,b.resolve(!0))}).error(function(){k.err("Server error"),b.reject("check logged in promise error")}),b.promise};var n;k.login=function(){return n=e.defer(),k.checkLoggedIn().then(function(a){a===!1?(j="loggedOff",q()):n.resolve(!0)}),n.promise};var o;k.openLoginPopUp=function(){if("undefined"==typeof n)return void k.err("Login promise not defined, you should call login() first");j="waitingForLogIn",h.open(i,"loginpopup","left=260,top=120,width=480,height=360");var a=function(){var b=k.checkLoggedIn();b.then(function(a){a&&(f.cancel(o),n.resolve(!0),f(k.closeLoginModal,k.options.loginModalCloseTimer))},function(){n.reject("login error")}),o=f(a,k.options.loginPollTimerMS)};a()},k.logout=function(){var a,b=e.defer();return a=d({headers:{Accept:"application/json"},method:"GET",url:c.get("asUsersLogout"),withCredentials:!0}).success(function(){l=!1,m={},b.resolve(!0)}).error(function(){b.reject("logout promise error")}),b.promise};var p=g({container:"[data-ng-app='Pundit2']",template:"src/Core/login.modal.tmpl.html",show:!1,backdrop:"static"}),q=function(){p.$promise.then(p.show)};return k.closeLoginModal=function(){p.hide(),f.cancel(o)},k.cancelLoginModal=function(){p.hide(),n.resolve(!1),f.cancel(o)},k}]),angular.module("Pundit2.Core").constant("ANALYTICSDEFAULTS",{trackingCode:"UA-50437894-1",globalTracker:"__gaPndtTracker",maxHits:20,bufferDelay:1e3,doTracking:!0,debug:!1}).service("Analytics",["BaseComponent","$window","$document","$interval","$timeout","ANALYTICSDEFAULTS",function(a,b,c,d,e,f){var g,h=new a("Analytics",f),i={events:[]},j=0,k=!1,l=!1,m=h.options.maxHits;!function(a,c,d,e,f,g,i){a.GoogleAnalyticsObject=f,a[f]=a[f]||function(){(a[f].q=a[f].q||[]).push(arguments)},a[f].l=1*new Date,g=c.createElement(d),i=c.getElementsByTagName(d)[0],g.async=1,g.src=e,g.onload=function(){h.log("GA async script loaded"),n=b[h.options.globalTracker]},i.parentNode.insertBefore(g,i)}(b,c[0],"script","http://www.google-analytics.com/analytics.js",h.options.globalTracker);var n=b[h.options.globalTracker];n("create",h.options.trackingCode,{storage:"none",cookieDomain:"none"}),n("set","checkProtocolTask",function(){});var o=function(){return m>=h.options.maxHits?(l=!1,void h.log(h.options.maxHits+" hits available again")):void(g=e(function(){m=Math.min(m+2,h.options.maxHits),o(),p()},h.options.bufferDelay))},p=function(){if(0===i.events.length)return void(k=!1);if(m>0){j++;var a=i.events.shift();n("send",{hitType:"event",eventCategory:a.eventCategory,eventAction:a.eventAction,eventLabel:a.eventLabel,eventValue:a.eventValue}),m--,l||(l=!0,o()),h.log("Tracked ("+j+" sent / "+m+" available) event "+a.eventCategory+" ("+a.eventAction+": "+a.eventLabel+")"),p()}};return h.getHits=function(){return m},h.track=function(a,b,c,d){if(h.options.doTracking){if(!angular.isDefined(a)||!angular.isDefined(b))return void h.err("Category and Action are required");i.events.push({eventCategory:a,eventAction:b,eventLabel:c,eventValue:d}),k||(k=!0,p())}},h.log("Component running"),h}]),angular.module("Pundit2.Core").constant("ITEMDEFAULTS",{iconDefault:"pnd-icon pnd-icon-eye",iconImage:"pnd-icon pnd-icon-camera",iconText:"pnd-icon pnd-icon-align-center",iconWebPage:"pnd-icon-file-text",iconEntity:"pnd-icon pnd-icon-code-fork",classDefault:"pnd-item-default",classImage:"pnd-item-image",classText:"pnd-item-text",classWebPage:"pnd-item-web-page",classEntity:"pnd-item-entity"}).factory("Item",["BaseComponent","NameSpace","Utils","ItemsExchange","ITEMDEFAULTS",function(a,b,c,d,e){var f=new a("Item",e),g=function(a,b){return"undefined"==typeof a?void f.err("Can't create an item without an URI"):(this.uri=a,this.type=[],this.label="default item label",angular.isObject(b)&&(f.log("Extending new Item with values "+this.uri,b),c.deepExtend(this,b)),void d.addItem(this))};return g.prototype.isProperty=function(){return-1!==this.type.indexOf(b.rdf.property)},g.prototype.isTextFragment=function(){return-1!==this.type.indexOf(b.fragments.text)},g.prototype.isImage=function(){return-1!==this.type.indexOf(b.types.image)},g.prototype.isImageFragment=function(){return-1!==this.type.indexOf(b.fragments.imagePart)},g.prototype.isWebPage=function(){return-1!==this.type.indexOf(b.types.page)},g.prototype.isEntity=function(){return!(this.isImage()||this.isProperty()||this.isTextFragment()||this.isImage()||this.isImageFragment()||this.isWebPage())},g.prototype.fromAnnotationRdf=function(a){var c=b.item,d=a[this.uri];if("undefined"==typeof d)return void f.log("Error? No RDF for this item? ",this.uri);for(var e in c){var g=c[e];g in d&&(this[e]=d[g][0].value)}var h=d[b.rdf.type];if(angular.isArray(h)&&h.length>0){this.type=[];for(var i in h)this.type.push(h[i].value)}if(-1!==this.type.indexOf(b.fragments.imagePart)){if(this.selector=[],b.item.selector in d){var j=d[b.item.selector];for(var k in j){var l=j[k].value;if(l in a){var m=a[l];m[b.rdf.type][0].value===b.selectors.polygonType&&this.selector.push(JSON.parse(m[b.rdf.value][0].value))}}}"undefined"!=typeof this.selector&&this.selector in a&&(this.selector=a[this.selector][b.rdf.value][0].value)}f.log("Created new item from annotation RDF: "+this.label)},g.prototype.toRdf=function(){var a={};return a[b.item.label]=[{type:"literal",value:this.label}],a[b.item.type]=[],this.type.forEach(function(c){a[b.item.type].push({type:"uri",value:c})}),"undefined"!=typeof this.altLabel&&(a[b.item.altLabel]=[{type:"literal",value:this.altLabel}]),"undefined"!=typeof this.description&&(a[b.item.description]=[{type:"literal",value:this.description}]),"undefined"!=typeof this.image&&(a[b.item.image]=[{type:"literal",value:this.image}]),"undefined"!=typeof this.pageContext&&(a[b.item.pageContext]=[{type:"uri",value:this.pageContext}]),"undefined"!=typeof this.isPartOf&&(a[b.item.isPartOf]=[{type:"uri",value:this.isPartOf}]),a},g.prototype.toJsonLD=function(){},g.prototype.getIcon=function(){return this.isImage()||this.isImageFragment()?f.options.iconImage:this.isTextFragment()?f.options.iconText:this.isWebPage()?f.options.iconWebPage:this.isEntity()?f.options.iconEntity:f.options.iconDefault},g.prototype.getClass=function(){return this.isImage()||this.isImageFragment()?f.options.classImage:this.isTextFragment()?f.options.classText:this.isWebPage()?f.options.classWebPage:this.isEntity()?f.options.classEntity:f.options.classDefault},f.log("Component up and running"),g}]),angular.module("Pundit2.Core").service("TypesHelper",["BaseComponent","NameSpace","Utils",function(a,b,c){var d=new a("TypesHelper"),e={};return d.addFromAnnotationRdf=function(a,d){a in e||(e[a]={},a in d?(b.item.label in d[a]&&(e[a].label=d[a][b.item.label][0].value),b.item.description in d[a]&&(e[a].description=d[a][b.item.description][0].value)):e[a].label=c.getLabelFromURI(a))},d.add=function(a,b,c){a in e||(e[a]={}),e[a].label=b,"undefined"!=typeof c&&(e[a].description=c)},d.getLabel=function(a){if("undefined"==typeof e[a]){var d;d=a.match(b.punditOntologyBaseURL)&&a in b.typesLabels?b.typesLabels[a]:c.getLabelFromURI(a),e[a]={label:d}}return e[a].label},d.log("Component up and running"),d}]),angular.module("Pundit2.Core").constant("CONSOLIDATIONDEFAULTS",{}).service("Consolidation",["$rootScope","CONSOLIDATIONDEFAULTS","BaseComponent","NameSpace","Config","Item","ItemsExchange",function(a,b,c,d,e,f,g){var h=new c("Consolidation",b),i={};h.wipe=function(){i.itemListByType={},i.typeUriMap={},i.uriTypeMap={},i.itemListByURI={};for(var a in i.annotators)i.annotators[a].wipe();h.log("Wiped up!")},h.wipe(),i.annotableTypes=[],i.annotators={},h.getItems=function(){return i.itemListByURI};var j=function(a){angular.isArray(a)||(a=[a]);for(var b=a.length;b--;){var c=a[b],d=h.isConsolidable(c);d!==!1?c.uri in i.itemListByURI?h.log("Item already present: "+c.label):(d in i.itemListByType?(i.itemListByType[d][c.uri]=c,i.typeUriMap[d].push(c.uri)):(i.typeUriMap[d]=[],i.itemListByType[d]={},i.itemListByType[d][c.uri]=c),i.itemListByURI[c.uri]=c,i.uriTypeMap[c.uri]=d,h.log("Added item: "+c.label+" ("+d+")")):h.log("Not adding, item is not consolidable: "+c.label)}};return h.consolidateAll=function(){var b=g.getItemsByContainer(e.modules.PageItemsContainer.container),c=g.getItemsByContainer(e.modules.MyItems.container),d=b.concat(c);h.log("Consolidating ALL items"),h.consolidate(d),a.$emit("consolidation-completed")},h.consolidate=function(a){h.log("Will try to consolidate "+a.length+" items"),h.wipe(),j(a);for(var b in i.annotators)b in i.itemListByType?(h.log("Consolidating annotator type "+b+", "+i.typeUriMap[b].length+" items"),i.annotators[b].consolidate(i.itemListByType[b])):h.log("Skipping annotator type "+b+": no item to consolidate.")},h.addAnnotator=function(a){h.log("Adding annotable type ",a.label),i.annotableTypes.push(a.label),i.annotators[a.label]=a},h.isConsolidable=function(a){for(var b in i.annotators)if(i.annotators[b].isConsolidable(a))return b;return!1},h.isConsolidated=function(a){return a instanceof f?a.uri in i.itemListByURI:!1},h.getAvailableTargets=function(){var a=[];for(var b in i.annotators)a=a.concat(i.annotators[b].getAvailableTargets());return a},h}]),angular.module("Pundit2.Annotators",[]),angular.module("Pundit2.Annotators").constant("XPOINTERSHELPERDEFAULTS",{wrapNodeName:"span",wrapNodeClass:"pnd-cons",textFragmentIconClass:"pnd-text-fragment-icon",consolidationClasses:[],namedContentClasses:["pundit-content"]}).config(["$locationProvider",function(a){a.html5Mode(!0)}]).service("XpointersHelper",["XPOINTERSHELPERDEFAULTS","NameSpace","BaseComponent","$document","$location","$window",function(a,b,c,d,e,f){var g=new c("XpointersHelper",a);g.getXPathsFromXPointers=function(a){for(var b=[],c={},d=a.length-1;d>=0;d--){var e=a[d],f=g.xPointerToXPath(e);g.isValidXpointer(e)?(c[e]=f,b.push(e)):g.err("Invalid xpointer passed to getXPathsFromXPointers: THIS SHOULD NOT HAPPEN!",e)}return c},g.isValidXpointerURI=function(a){return null===a.match(/#xpointer\(start-point\(string-range\(/)||null===a.match(/range-to\(string-range\(/)?!1:!0},g.isValidXpointer=function(a){if(!g.isValidXpointerURI(a))return!1;var b=g.xPointerToXPath(a);return g.isValidRange(b.startNode,b.startOffset,b.endNode,b.endOffset)},g.xPointerToXPath=function(a){var b,c,d={};return g.isValidXpointerURI(a)?(b=a.split("#xpointer(start-point(string-range(")[1].split("))/range-to(string-range("),c=b[0].split(",'',"),d.startXpath=c[0],d.startOffset=c[1],c=b[1].substr(0,b[1].length-3).split(",'',"),d.endXpath=c[0],d.endOffset=c[1],d.startNode=g.getNodeFromXpath(d.startXpath),d.endNode=g.getNodeFromXpath(d.endXpath),d):(g.log("xPointerToXPath() Invalid xpointer! ",a),{startNode:null,startOffset:null,endNode:null,endOffset:null,valid:!1})},g.getNodeFromXpath=function(a){var b;return b=d[0].evaluate(a,d[0],null,XPathResult.FIRST_ORDERED_NODE_TYPE,null),b.singleNodeValue},g.isValidRange=function(a,b,c,e){try{var f=d[0].createRange();return f.setStart(a,b),f.setEnd(c,e),!0}catch(g){return!1}},g.splitAndSortXPaths=function(a){var b=g.getNodeFromXpath("//body"),c=[],e=[];for(var f in a){var h=d[0].createRange(),i=g.getNodeFromXpath(a[f].startXpath);h.setStart(b,0),h.setEnd(i,a[f].startOffset),c.push({xpointer:f,xpath:a[f].startXpath,offset:a[f].startOffset,range:h});var j=d[0].createRange();i=g.getNodeFromXpath(a[f].endXpath),j.setStart(b,0),j.setEnd(i,a[f].endOffset),c.push({xpointer:f,xpath:a[f].endXpath,offset:a[f].endOffset,range:j})}c.sort(function(a,b){return a.range.compareBoundaryPoints(Range.END_TO_END,b.range)}),e[0]=c[0];for(var k=1,l=0,m=c.length;m>k;k++)(c[k].xpath!=e[l].xpath||c[k].offset!=e[l].offset)&&(e[++l]=c[k]);return e},g.getClassesForXpaths=function(a,b,c,d){for(var e=[],f=[],j=0;j<b.length-1;j++){var k=b[j],l=(b[j+1],g.getStartingXPs(a,c,k.xpath,k.offset)),m=g.getEndingXPs(a,c,k.xpath,k.offset);e=h(e,l),e=i(e,m);for(var n=[],o=e.length-1;o>=0;o--)for(var p=e[o],q=d[p].length-1;q>=0;q--)n.push(d[p][q]);f[j+1]=n}return f};var h=function(a,b){return a.concat(b)},i=function(a,b){for(var c=[],d=a.length-1;d>=0;d--)-1===b.indexOf(a[d])&&c.push(a[d]);return c};return g.getStartingXPs=function(a,b,c,d){for(var e=[],f=a.length-1;f>=0;f--){var g=a[f];b[g].startXpath===c&&b[g].startOffset===d&&e.push(g)}return e},g.getEndingXPs=function(a,b,c,d){for(var e=[],f=a.length-1;f>=0;f--){var g=a[f];b[g].endXpath===c&&b[g].endOffset===d&&e.push(g)}return e},g.updateDOM=function(a,b,c){for(var d=a.length-1;d>0;d--){var e=a[d-1],f=a[d];c[d].length>0&&(g.log("## Updating DOM, xpath "+d+": "+c[d].join(" ")),g.wrapXPaths(e,f,g.options.wrapNodeName,b,c[d]))}g.log("Dom successfully updated!")},g.wrapXPaths=function(a,b,c,e,f){var h=c||g.options.wrapNodeName,i=e||g.options.wrapNodeClass,j=f||[],k=d[0].createRange(),l=g.getNodeFromXpath(a.xpath),m=g.getNodeFromXpath(b.xpath);a.xpath.match(/\[[0-9]+\]$/)||b.xpath.match(/\[[0-9]+\]$/)?(g.isElementNode(l)?k.setStart(l,a.offset):k.setStart(l,a.offset),g.isElementNode(m)?k.setEndAfter(m):k.setEnd(m,b.offset)):k.selectNode(l.childNodes[a.offset]),g.wrapElement(k.commonAncestorContainer,k,h,i,j)},g.wrapElement=function(a,b,c,d,e){if(a.childNodes&&a.childNodes.length>0)for(var f=a.childNodes.length-1;f>=0&&a.childNodes[f];f--)g.wrapElement(a.childNodes[f],b,c,d,e);else g.isTextNodeInsideRange(a,b)?g.wrapNode(a,b,c,d,e):g.isImageNodeInsideRange(a,b)&&g.wrapNode(a,b,c,d,e)},g.isTextNodeInsideRange=function(a,b){var c;return a.nodeType!==Node.TEXT_NODE?!1:(c=a.textContent.replace(/ /g,"").replace(/\n/,""),a.data&&""!==c&&" "!==c?g.isNodeInsideRange(a,b):!1)},g.isImageNodeInsideRange=function(a,b){return a.nodeType!==Node.ELEMENT_NODE?!1:"img"!==a.tagName.toLowerCase()?!1:g.isNodeInsideRange(a,b)},g.isNodeInsideRange=function(a,b){var c=d[0].createRange();try{c.selectNode(a)}catch(e){c.selectNodeContents(a)}return-1!=b.compareBoundaryPoints(Range.END_TO_START||3,c)||1!=b.compareBoundaryPoints(Range.START_TO_END||1,c)?!1:!0},g.wrapNode=function(a,b,c,e,f){var h=d[0].createRange();a===b.startContainer||a===b.endContainer?(h.setStart(a,a===b.startContainer?b.startOffset:0),h.setEnd(a,a===b.endContainer?b.endOffset:a.length)):h.selectNode(a),h.surroundContents(g.createWrapNode(c,e,f))},g.createWrapNode=function(a,b,c){var e=d[0].createElement(a);return angular.element(e).addClass(b),angular.element(e).attr("text-fragment-bit",""),angular.element(e).attr("fragments",c.join(",")),angular.element(e).addClass(c.join(" ")),e},g.mergeTextNodes=function(a){if(a&&"undefined"!=typeof a.childNodes&&a.childNodes.length>0)for(var b,c,d=a.childNodes.length-1;b=a.childNodes[d--];)g.isTextNode(b)&&(c=a.childNodes[d])&&g.isTextNode(c)?(c.nodeValue=c.nodeValue+b.nodeValue,a.removeChild(b)):g.isElementNode(b)&&g.mergeTextNodes(b)},g.isTextNode=function(a){return a.nodeType===Node.TEXT_NODE},g.isElementNode=function(a){return a.nodeType===Node.ELEMENT_NODE
},g.isWrapNode=function(a){return g.isElementNode(a)?a.nodeName.toUpperCase()!==g.options.wrapNodeName.toUpperCase()?!1:angular.element(a).hasClass(g.options.wrapNodeClass)?!0:!1:!1},g.isConsolidationNode=function(a){if(!g.isElementNode(a))return!1;var b=[g.options.textFragmentIconClass,g.options.wrapNodeClass];b=b.concat(g.options.consolidationClasses);for(var c=b.length;c--;)if(angular.element(a).hasClass(b[c]))return!0;return!1},g.isWrappedTextNode=function(a){return g.isWrapNode(a)&&g.isTextNode(a.firstChild)?!0:!1},g.isWrappedElementNode=function(a){return g.isWrapNode(a)&&g.isElementNode(a.firstChild)?!0:!1},g.isNamedContentNode=function(a){if(!g.isElementNode(a))return!1;for(var b=g.options.namedContentClasses,c=b.length;c--;)if(angular.element(a).hasClass(b[c]))return!0;return!1},g.isUIButton=function(a){return g.isElementNode(a)&&angular.element(a).hasClass(g.options.textFragmentIconClass)?!0:!1},g.getSafePageContext=function(){var a,b,c,d=f.location.href;if(-1!==d.indexOf("#")&&(a=d.substring(d.indexOf("#")+1,d.length),d=d.substring(0,d.indexOf("#"))),-1!==d.indexOf("?")){b=d.substring(d.indexOf("?")+1,d.length),d=d.substring(0,d.indexOf("?")),c=e.search(),delete c["pundit-show"];var g=[];for(var h in c)g.push(h+"="+c[h]);b=g.join("&")}return b&&(d+="?"+b),a&&(d+="#"+a),d},g.log("Component up and running"),g}]),angular.module("Pundit2.Annotators").constant("TEXTFRAGMENTANNOTATORDEFAULTS",{cMenuType:"annotatedTextFragment",initContextualMenu:!0,annotationIconClass:"pnd-icon-tag",myItemsIconClass:"pnd-icon-bookmark",suggestionIconClass:"pnd-icon-pencil"}).service("TextFragmentAnnotator",["TEXTFRAGMENTANNOTATORDEFAULTS","NameSpace","BaseComponent","Consolidation","XpointersHelper","ContextualMenu","ItemsExchange","Config","TripleComposer","Dashboard","$compile","$rootScope","$location",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=new c("TextFragmentAnnotator",a);n.label="text",n.type=b.fragments[n.label],d.addAnnotator(n);var o=function(){f.addAction({type:[n.options.cMenuType,h.modules.TextFragmentHandler.cMenuType,h.modules.PageItemsContainer.cMenuType,h.modules.MyItemsContainer.cMenuType],name:"addToSubject",label:"Annotate this text fragment",showIf:function(a){return a.isTextFragment()},priority:20,action:function(a){j.isDashboardVisible()||j.toggle(),l.$emit("pnd-dashboard-show-tab",i.options.clientDashboardTabTitle),i.addToSubject(a)}})};l.$on("pundit-boot-done",function(){n.options.initContextualMenu&&o()}),n.isConsolidable=function(a){return angular.isArray(a.type)?0===a.type.length?(n.log("Item not valid: types len 0"),!1):-1===a.type.indexOf(n.type)?(n.log("Item not valid: not a "+n.type),!1):e.isValidXpointerURI(a.uri)?e.isValidXpointer(a.uri)?(n.log("Item not valid: not recognized as a consolidable "+n.label),!0):(n.log("Item not valid: not consolidable on this page: "+a.uri),!1):(n.log("Item not valid: not a valid xpointer uri: "+a.uri),!1):(n.log("Item not valid: malformed"),!1)},n.getAvailableTargets=function(a){var b=[],c=e.options.namedContentClasses;("undefined"==typeof a||a!==!0)&&b.push(m.absUrl());for(var d=c.length;d--;)for(var f=c[d],g=angular.element("."+f),h=g.length;h--;){var i=angular.element(g[h]).attr("about");i&&b.push(i)}return b};var p={},q={};n.consolidate=function(a){n.log("Consolidating!");var b=[],c=0;p={},q={};for(var d in a)b.push(d),p[d]=["fr-"+c],q["fr-"+c]={uri:d,bits:[],item:a[d]},c++;var f=e.getXPathsFromXPointers(b),g=e.splitAndSortXPaths(f),h=e.getClassesForXpaths(b,g,f,p);e.updateDOM(g,e.options.wrapNodeClass,h),s(),n.log(n.label+" consolidation: done!")};var r=function(){var a=0;amContainer=h.modules.Annomatic.container;for(var b in p){var c=p[b],d=angular.element("."+c).last(),e="text-fragment-icon";g.isItemInContainer(q[c].item,amContainer)&&(e="suggestion-fragment-icon"),n.log("Placing fragment icon "+a++,c,d.attr("fragments")),d.after("<"+e+' fragment="'+c+'"></'+e+">")}},s=function(){r();var a=angular.element(".pnd-cons");k(a)(l);var b=angular.element("text-fragment-icon, suggestion-fragment-icon");k(b)(l),l.$$phase||l.$digest()};return n.wipe=function(){p={},q={},angular.element("."+e.options.textFragmentIconClass).remove();var a=angular.element("."+e.options.wrapNodeClass);angular.forEach(a,function(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);angular.element(a).remove()}),e.mergeTextNodes(angular.element("body")[0])},n.addFragmentIcon=function(a){q[a.fragment].icon=a,a.item=q[a.fragment].item,n.log("Adding fragment icon for fragment id="+a.fragment)},n.addFragmentBit=function(a){var b=a.fragments;b=b.match(/,/)?b.split(","):[b];for(var c=b.length;c--;){var d=q[b[c]];d.bits.push(a)}n.log("Adding consolidated fragment bit",b)},n.getFragmentIdByUri=function(a){return"undefined"!=typeof p[a]?p[a]:void 0},n.getFragmentIconScopeById=function(a){return"undefined"!=typeof q[a]?q[a].icon:void 0},n.getBitsById=function(a){return"undefined"!=typeof q[a]?q[a].bits:void 0},n.highlightByUri=function(a){return"undefined"==typeof p[a]?void n.log("Not highlighting given URI: fragment id not found"):void n.highlightById(p[a][0])},n.highlightById=function(a){for(var b=q[a].bits.length;b--;)q[a].bits[b].high();n.log("Highlighting fragment id="+a+", # bits: "+q[a].bits.length)},n.clearHighlightByUri=function(a){return"undefined"==typeof p[a]?void n.log("Not clearing highlight on given URI: fragment id not found"):void n.clearHighlightById(p[a])},n.clearHighlightById=function(a){for(var b=q[a].bits.length;b--;)q[a].bits[b].clear();n.log("Clear highlight on fragment id="+a+", # bits: "+q[a].bits.length)},n.showByUri=function(a){if("undefined"==typeof p[a])return void n.log("Not showing fragment for given URI: fragment id not found");for(var b=p[a],c=q[b].bits.length;c--;)q[b].bits[c].show()},n.hideByUri=function(a){if("undefined"==typeof p[a])return void n.log("Not hiding fragment for given URI: fragment id not found");for(var b=p[a],c=q[b].bits.length;c--;)q[b].bits[c].hide()},n.hideAll=function(){for(var a in p)n.hideByUri(a)},n.showAll=function(){for(var a in p)n.showByUri(a)},n.log("Component up and running"),n}]),angular.module("Pundit2.Annotators").service("ImageFragmentAnnotator",["NameSpace","BaseComponent","Consolidation",function(a,b,c){var d=new b("ImageFragmentAnnotator");return d.label="image",d.type=a.fragments[d.label],c.addAnnotator(d),d.isConsolidable=function(a){return angular.isArray(a.type)?0===a.type.length?(d.log("Item not valid: types len 0"),!1):-1!==a.type.indexOf(d.type)?(d.log("Item is a fragment! "+d.label),!0):(d.log("Item not valid: not recognized as a consolidable "+d.label),!1):(d.log("Item not valid: malformed"),!1)},d.getAvailableTargets=function(){return[]},d.wipe=function(){},d.log("Component up and running"),d}]),angular.module("Pundit2.Annotators").directive("textFragmentBit",["TextFragmentAnnotator",function(a){return{restrict:"A",scope:{fragments:"@"},link:function(b,c){a.addFragmentBit(b),b.isHigh=!1,b.high=function(){c.addClass("pnd-textfragment-highlight")},b.clear=function(){c.removeClass("pnd-textfragment-highlight")},b.hide=function(){c.addClass("pnd-textfragment-hidden")},b.show=function(){c.removeClass("pnd-textfragment-hidden")}}}}]),angular.module("Pundit2.Annotators").directive("textFragmentIcon",["TextFragmentAnnotator","ContextualMenu","XpointersHelper","Config","ItemsExchange",function(a,b,c,d,e){return{restrict:"E",scope:{fragment:"@"},templateUrl:"src/Annotators/TextFragmentIcon.dir.tmpl.html",replace:!0,link:function(f,g){f.textFragmentIconClass=c.options.textFragmentIconClass,f.element=g,a.addFragmentIcon(f);var h=d.modules.PageItemsContainer.container,i=d.modules.MyItems.container;f.iconClass=e.isItemInContainer(f.item,i)&&!e.isItemInContainer(f.item,h)?a.options.myItemsIconClass:a.options.annotationIconClass,f.mouseoverHandler=function(){a.highlightById(f.fragment)},f.mouseoutHandler=function(){a.clearHighlightById(f.fragment)},f.clickHandler=function(c){b.show(c.pageX,c.pageY,f.item,a.options.cMenuType)}}}}]),angular.module("Pundit2.Core").service("ItemsExchange",["BaseComponent",function(a){var b=new a("ItemsExchange"),c={},d={},e=[],f={};return b.wipe=function(){c={},d={},e=[],f={},b.log("Wiped every loaded item and every container.")},b.isItemInContainer=function(a,b){var c=d[a.uri];return"undefined"==typeof c?!1:-1===c.indexOf(b)?!1:!0},b.wipeContainer=function(a){return"undefined"==typeof c[a]?void b.log("Cannot wipe undefined container "+a):(c[a].forEach(function(b){d[b.uri].splice(d[b.uri].indexOf(a),1),0===d[b.uri].length&&(delete d[b.uri],delete f[b.uri])}),delete c[a],void b.log("Wiped "+a+" container."))},b.getItems=function(){return e},b.getItemsHash=function(){return f},b.getItemByUri=function(a){return a in f?f[a]:void 0},b.getAll=function(){return{itemListByURI:f,itemListByContainer:c,itemContainers:d}},b.getItemsBy=function(a){if("function"==typeof a){var b=[];for(var c in f){var d=f[c];a(d)&&b.push(d)}return b}},b.getItemsFromContainerByFilter=function(a,b){if("function"==typeof b&&"undefined"!=typeof c[a]){var d=[],e=c[a];for(var f in e){var g=e[f];b(g)&&d.push(g)}return d}},b.getItemsByContainer=function(a){return"undefined"!=typeof c[a]?c[a]:[]},b.addItemToContainer=function(a,e){angular.isArray(e)||(e=[e]);for(var f=e.length;f--;){var g=e[f];if(a.uri in d&&-1!==d[a.uri].indexOf(g))return void b.log("Item "+a.label+" already belongs to container "+g);g in c?c[g].push(a):c[g]=[a],a.uri in d?d[a.uri].push(g):d[a.uri]=[g]}},b.removeItemFromContainer=function(a,e){var g=c[e];if("undefined"==typeof g)return void b.err("Cannot remove item "+a.label+" from container "+e+": container not found.");var h=g.indexOf(a);if(-1===h)return void b.err("Cannot remove item "+a.label+" from container "+e+": item not in container.");g.splice(h,1);var i=d[a.uri].indexOf(e);d[a.uri].splice(i,1),0===d[a.uri].length&&(delete d[a.uri],delete f[a.uri]),b.log("Item "+a.label+" removed from container "+e)},b.addItems=function(a){for(var c=a.length;c--;)b.addItem(a[c])},b.addItem=function(a,c){return"undefined"==typeof c&&(c="default"),"undefined"!=typeof a.uri&&angular.isArray(a.type)?a.uri in f?void b.log("Item already present: "+a.uri):(a.isProperty()&&(c="property"),f[a.uri]=a,e.push(a),b.addItemToContainer(a,c),void b.log("Added item: "+a.uri)):void b.err("Ouch, cannot add this item ... ",a)},b.log("Component up and running"),b}]),angular.module("Pundit2.Annotators").constant("TEXTFRAGMENTHANDLERDEFAULTS",{ignoreClasses:["pnd-ignore"],removeSelectionOnAbort:!0,container:"createdTextFragments",cMenuType:"textFragmentHandlerItem",labelMaxLength:40}).service("TextFragmentHandler",["TEXTFRAGMENTHANDLERDEFAULTS","NameSpace","BaseComponent","ContextualMenu","XpointersHelper","Item","ItemsExchange","$document",function(a,b,c,d,e,f,g,h){var i=new c("TextFragmentHandler",a);h.on("mousedown",function(a){var b=a.target;return m(b)?(i.log("ABORT: ignoring mouse DOWN event on document: ignore class spotted."),void(i.options.removeSelectionOnAbort&&h.on("mouseup",j))):(h.on("mouseup",k),void i.log("Selection started on document, waiting for mouse up."))});var j=function(){h.off("mouseup",j),null!==i.getSelectedRange()&&l()},k=function(a){h.off("mouseup",k);var b=a.target;if(m(b))return i.log("ABORT: ignoring mouse UP event on document: ignore class spotted."),void l();var c=i.getSelectedRange();if(null!==c){for(var e=c.cloneContents().querySelectorAll("*"),f=e.length;f--;)if(m(e[f]))return i.log("ABORT: ignoring range: ignore class spotted inside it, somewhere."),void l();var j=i.createItemFromRange(c);g.addItemToContainer(j,i.options.container),i.log("Valid selection ended on document. Text fragment Item produced: "+j.label),d.show(a.pageX,a.pageY,j,i.options.cMenuType)}};i.createItemFromRange=function(a){var c={};return c.uri=n(a),c.type=[b.fragments.text],c.description=a.toString(),c.label=c.description,c.label.length>i.options.labelMaxLength&&(c.label=c.label.substr(0,i.options.labelMaxLength)+" .."),c.pageContext=e.getSafePageContext(),c.isPartOf=c.uri.split("#")[0],new f(c.uri,c)},i.getSelectedRange=function(){var a,b=h[0];return 0===b.getSelection().rangeCount?(i.log("getSelection().rangeCount is 0: no selected range."),null):(a=b.getSelection().getRangeAt(0),null!==a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset?(i.log("Range is not null, but start/end containers and offsets match: no selected range."),null):(i.log("GetSelectedRange returning a DIRTY range: "+a.startContainer.nodeName+"["+a.startOffset+"] > "+a.endContainer.nodeName+"["+a.endOffset+"]"),a))};var l=function(){i.options.removeSelectionOnAbort&&h[0].getSelection().removeAllRanges()},m=function(a){for(var b=i.options.ignoreClasses,c=b.length;"body"!==a.nodeName.toLowerCase();){for(var d=c;d--;)if(angular.element(a).hasClass(b[d]))return!0;if(null===a.parentNode)return!1;a=a.parentNode}return!1},n=function(a){var b=p(a),c=v(w(b.startContainer),b.cleanStartNumber),d=v(w(b.endContainer),b.cleanEndNumber),e=x(c),f=o(e,c,b.startOffset,d,b.endOffset);return i.log("range2xpointer returning an xpointer: "+f),f},o=function(a,b,c,d,e){return a+"#xpointer(start-point(string-range("+b+",'',"+c+"))/range-to(string-range("+d+",'',"+e+")))"},p=function(a){var b={};i.log("dirty2cleanRange DIRTY: "+a.startContainer.nodeName+"["+a.startOffset+"] > "+a.endContainer.nodeName+"["+a.endOffset+"]");var c=q(a.startContainer,a.startOffset),d=q(a.endContainer,a.endOffset);return b.startContainer=c.cleanContainer,b.startOffset=c.cleanOffset,b.endContainer=d.cleanContainer,b.endOffset=d.cleanOffset,b.cleanStartNumber=t(b.startContainer),b.cleanEndNumber=t(b.endContainer),i.log("dirty2cleanRange CLEAN: "+b.startContainer.nodeName+"["+b.startOffset+"] > "+b.endContainer.nodeName+"["+b.endOffset+"]"),b},q=function(a,b){var c,d,f,g=e,h=a.parentNode;if(g.isElementNode(a)&&!g.isConsolidationNode(a))return{cleanContainer:a,cleanOffset:b};for(d=g.isTextNode(a)&&g.isWrapNode(h)?h:a,f=b;c=d.previousSibling;){if(!g.isConsolidationNode(c)&&g.isElementNode(c)&&!g.isWrapNode(c))return g.isTextNode(a)&&g.isWrapNode(h)?{cleanContainer:a,cleanOffset:f}:{cleanContainer:d,cleanOffset:f};g.isTextNode(c)?f+=c.length:g.isWrapNode(c)&&(f+=c.firstChild.length),d=c}return e.isTextNode(a)&&e.isWrapNode(h)?{cleanContainer:a,cleanOffset:f}:{cleanContainer:d,cleanOffset:f}},r=function(a){return e.isTextNode(a)||e.isWrappedTextNode(a)||e.isUIButton(a)},s=function(a){return e.isElementNode(a)&&!e.isUIButton(a)&&!e.isWrappedTextNode(a)},t=function(a){var b,c=1,d=e,f=u(a),g=a.parentNode,h=d.isWrapNode(g)?g:a;if(d.isTextNode(a))for(;b=h.previousSibling;)r(b)&&(s(h)||d.isWrappedElementNode(h))&&c++,h=b;else for(;b=h.previousSibling;)u(b)!==f||d.isConsolidationNode(b)||c++,h=b;return c},u=function(a){return e.isTextNode(a)?"text()":a.nodeName.toUpperCase()},v=function(a,b){return a.replace(/\[[0-9]+\]$/,"["+b+"]")},w=function(a,b){var c=a.parentNode;if(!a)return b;var d=e,f=u(a);if(d.isNamedContentNode(a))return"undefined"!=typeof b?"//DIV[@about='"+angular.element(a).attr("about")+"']/"+b:"//DIV[@about='"+angular.element(a).attr("about")+"']";if("BODY"===f||"HTML"===f)return"undefined"!=typeof b?"//BODY/"+b:"//BODY";if(d.isWrapNode(a))return w(a.parentNode,b);var g,h=1,i=a;if(!d.isTextNode(i))for(;g=i.previousSibling;)u(g)!==f||d.isConsolidationNode(g)||h++,i=g;return b="undefined"!=typeof b?f+"["+h+"]/"+b:f+"["+h+"]",w(c,b)},x=function(a){var b=e.getSafePageContext(),c=a.indexOf("DIV[@about='"),d="about";if(-1===c)return-1!==b.indexOf("#")?b.split("#")[0]:b;if(3>c){var f=c+7+d.length,g=a.indexOf("_text']"),h=a.indexOf(-1!==g?"_text']":"']")-f;return a.substr(f,h)}return i.log("ERROR: getContentURLFromXPath returning something weird? xpath = "+a),""};return i.log("Component up and running"),i}]),angular.module("Pundit2.Communication",[]),angular.module("Pundit2.Communication").constant("NOTEBOOKDEFAULTS",{iconDefault:"pnd-icon pnd-icon-book",classDefault:"pnd-item-default"}).factory("Notebook",["BaseComponent","NameSpace","MyPundit","Analytics","NotebookExchange","NOTEBOOKDEFAULTS","$http","$q",function(a,b,c,d,e,f,g,h){function i(a,b){this._q=h.defer(),"undefined"!=typeof a?(this.id=a,this.load()):this.create(),e.addNotebook(this,b)}function j(a,b){var c=new i(a,b);return c._q.promise}var k=new a("Notebook",f);i.prototype.addAnnotation=function(a){"undefined"==typeof this.includes&&(this.includes=[]),this.includes.push(a)},i.prototype.getIcon=function(){return k.options.iconDefault},i.prototype.getClass=function(){return k.options.classDefault},i.prototype.setPrivate=function(){this.visibility="private"},i.prototype.isPublic=function(){return"public"===this.visibility},i.prototype.setPublic=function(){this.visibility="public"},i.prototype.setLabel=function(a){this.label=a},i.prototype.isCurrent=function(){var a=e.getCurrentNotebooks();return"undefined"==typeof a?!1:this.id===a.id},i.prototype.create=function(){k.log("Creating a new Notebook on the server"),this._q.resolve("New notebook created: TODO, after LOGIN")},i.prototype.save=function(){},i.prototype.load=function(a){var e=this;"undefined"==typeof a&&(a=!0),k.log("Loading notebook "+e.id+" metadata with cache "+a);var f,h=c.isUserLogged()?"asNBMeta":"asOpenNBMeta";f=g({headers:{Accept:"application/json"},method:"GET",cache:a,url:b.get(h,{id:e.id}),withCredentials:!0}).success(function(a){l(e,a),e._q.resolve(e),d.track("api","get","notebook meta"),k.log("Retrieved notebook "+e.id+" metadata")}).error(function(a,b){e._q.reject("Error from server while retrieving notebook "+e.id+": "+b),d.track("api","error","get notebook meta",b),k.err("Error getting notebook "+e.id+" metadata. Server answered with status code "+b)})};var l=function(a,c){for(var d in c)a.uri=d;var e=b.notebook,f=c[a.uri];if("undefined"==typeof f)return k.err("Malformed notebook uri="+a.uri+", wrong metadata: ",c),!1;for(var g in e){var h=e[g];a[g]=h in f?"type"===g?[f[h][0].value]:f[h][0].value:""}var i=f[e.includes];a.includes=[];for(var j in i){var l=i[j].value.match(/[a-z0-9]*$/);null!==l&&a.includes.push(l[0])}};return k.log("Component up and running"),j}]),angular.module("Pundit2.Communication").service("NotebookExchange",["BaseComponent",function(a){var b,c=new a("NotebookExchange"),d=[],e={},f=[],g={};return c.wipe=function(){c.log("Wiping every loaded notebooks."),d=[],e={},f=[],g={}},c.addNotebook=function(a,b){a.id in e?c.log("Not adding notebook "+a.id+": already present."):a._q.promise.then(function(b){e[a.id]=b,d.push(b)}),"undefined"!=typeof b&&b&&(a.id in g?c.log("Not adding notebook "+a.id+" to my notebook, already present."):a._q.promise.then(function(b){g[a.id]=b,f.push(b)}))},c.removeNotebook=function(a){for(var b=-1,h=0;h<d.length;h++)if(d[h].id===a){b=h;break}if(-1===b)return void c.err("Cannot remove notebook "+a+" from notebook list: notebook is not in notebook list.");d.splice(b,1),delete e[a],b=-1;for(var h=0;h<f.length;h++)if(f[h].id===a){b=h;break}return-1===b?void c.err("Cannot remove notebook "+a+" from my notebook list: notebook is not in my notebook list."):(f.splice(b,1),void delete g[a])},c.getNotebookById=function(a){return a in e?e[a]:void 0},c.getNotebooks=function(){return d},c.getMyNotebooks=function(){return f},c.getCurrentNotebooks=function(){return e[b]},c.setCurrentNotebooks=function(a){c.log("set new current as: ",a),b=a},c.log("Component up and running"),c}]),angular.module("Pundit2.Communication").service("NotebookCommunication",["BaseComponent","NameSpace","Notebook","MyPundit","Analytics","Config","$http","$q","NotebookExchange","Toolbar",function(a,b,c,d,e,f,g,h,i,j){var k=new a("NotebookCommunication");return k.getMyNotebooks=function(){var a=h.defer();return k.log("Getting my notebooks from the server"),d.isUserLogged()?(j.setLoading(!0),g({headers:{Accept:"application/json"},method:"GET",url:b.get("asNBOwned"),withCredentials:!0}).success(function(b){if(j.setLoading(!1),e.track("api","get","notebook owned"),"undefined"==typeof b)return a.reject("some sort of error?"),void k.log("Error retrieving list of my notebooks - Server undefined response");if("NotebookIDs"in b){for(var d=[],f=b.NotebookIDs.length;f--;)d[f]=new c(b.NotebookIDs[f],!0);h.all(d).then(function(b){a.resolve(b),k.log("Retrieved all of my notebooks")},function(){console.log("My notebooks all error?! :("),a.reject("some other error?")})}else a.reject("some sort of error?"),k.log("Error retrieving list of my notebooks -- TODO")}).error(function(b,c){j.setLoading(!1),a.reject("Error from server while retrieving list of my notebooks: "+c),k.err("Error from server while retrieving list of my notebooks: "+c),e.track("api","error","get notebook owned",c)})):(k.log("Impossible to get my notebooks: you have to be logged in"),a.reject("User not logged in")),a.promise},k.getCurrent=function(){var a=h.defer();return k.log("Getting current notebook"),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"GET",url:b.get("asNBCurrent"),withCredentials:!0}).success(function(b){j.setLoading(!1),k.log(b.NotebookID+" is the current notebook"),i.setCurrentNotebooks(b.NotebookID),a.resolve(b.NotebookID)}).error(function(b){j.setLoading(!1),k.log("Impossible to get the current notebook "),a.reject(b)})):(k.log("Impossible to get current: you have to be logged in"),a.reject("User not logged in")),a.promise},k.setCurrent=function(a){var c=h.defer();return k.log("Setting as current "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBCurrent")+"/"+a,withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is now current"),i.setCurrentNotebooks(a),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to set as current: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setPublic=function(a){var c=h.defer();return k.log("Setting as public "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBPublic",{id:a}),withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is now public"),i.getNotebookById(a).setPublic(),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to set as public: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setPrivate=function(a){var c=h.defer();return k.log("Setting as private "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBPrivate",{id:a}),withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is now private"),i.getNotebookById(a).setPrivate(),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to set as private: "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.createNotebook=function(a){var f=h.defer();return k.log("Creating a new notebook"),d.login().then(function(d){return d===!1?void f.reject("Ouch!"):(j.setLoading(!0),void g({headers:{Accept:"application/json","Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:b.get("asNB"),withCredentials:!0,data:{NotebookName:a}}).success(function(a){j.setLoading(!1),"NotebookID"in a?new c(a.NotebookID,!0).then(function(){f.resolve(a.NotebookID),k.log("Created a new notebook: "+a.NotebookID),e.track("api","post","notebook create")}):(f.reject("some sort of error?"),k.log("Error creating a notebook -- TODO"))}).error(function(a,b){j.setLoading(!1),f.reject("Error from server while retrieving list of my notebooks: "+b),k.err("Error from server while retrieving list of my notebooks: "+b),e.track("api","error","get notebook owned",b)}))}),f.promise},k.deleteNotebook=function(a){var c=h.defer();return k.log("Deleting "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"DELETE",url:b.get("asNB")+"/"+a,withCredentials:!0}).success(function(){j.setLoading(!1),k.log(a+" is removed"),i.removeNotebook(a),c.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to remove "+a),c.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),c.reject("User not logged in")),c.promise},k.setName=function(a,c){var e=h.defer();return k.log("Edit name of notebook "+a),d.isUserLogged()?(j.setLoading(!0),g({headers:{"Content-Type":"application/json"},method:"PUT",url:b.get("asNBEditMeta",{id:a}),withCredentials:!0,data:{NotebookName:c}}).success(function(){j.setLoading(!1),k.log(a+" is now edited"),i.getNotebookById(a).setLabel(c),e.resolve()}).error(function(b){j.setLoading(!1),k.log("Impossible to edit name of notebook: "+a),e.reject(b)})):(k.log("Impossible to set as current: you have to be logged in"),e.reject("User not logged in")),e.promise},k}]),angular.module("Pundit2.Communication").factory("Annotation",["BaseComponent","NameSpace","Utils","Item","TypesHelper","Analytics","AnnotationsExchange","Consolidation","MyPundit","ItemsExchange","PageItemsContainer","$http","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(a){this._q=m.defer(),"undefined"!=typeof a?(this.id=a,this.load()):this.create(),g.addAnnotation(this)}function o(a){var b=new n(a);return b._q.promise}var p=new a("Annotation");n.prototype.create=function(){p.log("Creating a new Annotation on the server"),this._q.resolve("New annotation created: TODO, after LOGIN")},n.prototype.load=function(a){var c=this,d=i.isUserLogged()?"asAnn":"asOpenAnn";"undefined"==typeof a&&(a=!0),p.log("Loading annotation "+c.id+" with cache "+a);var e;e=l({headers:{Accept:"application/json"},method:"GET",cache:a,url:b.get(d,{id:c.id}),withCredentials:!0}).success(function(a){q(c,a);c._q.resolve(c),p.log("Retrieved annotation "+c.id+" metadata"),f.track("api","get","annotation")}).error(function(a,b){c._q.reject("Error from server while retrieving annotation "+c.id+": "+b),p.err("Error getting annotation "+c.id+". Server answered with status code "+b),f.track("api","error","get annotation",b)})},n.prototype.isBroken=function(){var a,b,c=this.graph,d=!1;for(var e in c){a=j.getItemByUri(e),(a.isTextFragment()||a.isImageFragment())&&(h.isConsolidated(a)||(d=!0));for(var f in c[e]){b=c[e][f];for(var g in b)objectValue=b[g].value,objectType=b[g].type,"uri"===objectType&&(a=j.getItemByUri(objectValue),(a.isTextFragment()||a.isImageFragment())&&(h.isConsolidated(a)||(d=!0)))}}return d};var q=function(a,f){if("undefined"==typeof f||"undefined"==typeof f.graph||"undefined"==typeof f.metadata||"undefined"==typeof f.items)return p.err("Malformed annotation id="+a.id+": ",f),!1;a.items={},a.graph=angular.copy(f.graph);for(var g in f.metadata)a.uri=g;if("undefined"==typeof a.uri)return p.err("Malformed annotation id="+a.id+", wrong metadata: ",f),!1;var h=b.annotation,i=f.metadata[a.uri];for(var l in h){var m=h[l];a[l]=m in i?i[m][0].value:""}if(h.isIncludedIn in i){a.isIncludedInUri=i[h.isIncludedIn][0].value;var n=a.isIncludedInUri.match(/[a-z0-9]*$/);null!==n&&(a.isIncludedIn=n[0])}if(h.target in i){a.target=[];for(var o=0;o<i[h.target].length;o++)a.target.push(i[h.target][o].value)}a.entities=[],a.predicates=[];for(var q in f.graph){-1===a.entities.indexOf(q)&&(a.entities.push(q),a.items[q]={});for(var r in f.graph[q]){-1===a.entities.indexOf(r)&&(a.items[r]={type:[b.rdf.property],label:c.getLabelFromURI(r)},-1===a.predicates.indexOf(r)&&a.predicates.push(r));for(var s in f.graph[q][r]){var t=f.graph[q][r][s];"uri"===t.type&&-1===a.entities.indexOf(t.value)&&(a.entities.push(t.value),a.items[t.value]={})}}}for(var u in a.items){var v=j.getItemByUri(u);"undefined"==typeof v&&(v=angular.equals(a.items[u],{})?new d(u):new d(u,a.items[u]),v.fromAnnotationRdf(f.items)),v.isProperty()||j.addItemToContainer(v,k.options.container);for(var o in v.type)e.addFromAnnotationRdf(v.type[o],f.items);a.items[u]=v}};return p.log("Component up and running"),o}]),angular.module("Pundit2.Communication").service("AnnotationsExchange",["BaseComponent","NameSpace","MyPundit","Analytics","$http","$q",function(a,b,c,d,e,f){var g=new a("AnnotationsExchange"),h=[],i={};return g.wipe=function(){g.log("Wiping every loaded annotation."),h=[],i={}},g.searchByUri=function(a){angular.isArray(a)||(a=[a]),g.log("Searching for annotations with "+a.length+" URIs from the server");var h,i=f.defer(),j=c.isUserLogged()?"asAnnMetaSearch":"asOpenAnnMetaSearch";return h=e({headers:{Accept:"application/json"},method:"GET",url:b.get(j),cache:!1,params:{scope:"all",query:{resources:a}},withCredentials:!0}).success(function(a){d.track("api","get","search");var b=[];for(var c in a){var e=c.match(/[a-z0-9]*$/);null!==e&&b.push(e[0])}i.resolve(b),g.log("Retrieved annotations IDs searching by URIs")}).error(function(a,b){var c="Error from server while searching for annotations by URIs: "+b;i.reject(c),g.err(c),d.track("api","error","get "+j,b)}),i.promise},g.addAnnotation=function(a){a.id in i?g.log("Not adding annotation "+a.id+": already present."):a._q.promise.then(function(b){i[a.id]=b,h.push(b)})},g.getAnnotations=function(){return h},g.getAnnotationById=function(a){return a in i?i[a]:void 0},g.getAnnotationsHash=function(){return i},g.removeAnnotationByNotebookId=function(a){g.log("Removing annotation of notebook: "+a);for(var b=0;b<h.length;b++){var c=h[b];c.isIncludedIn===a&&(g.log("Removed annotation "+c.uri),delete i[c.id],h.splice(b,1))}},g.log("Component up and running"),g}]),angular.module("Pundit2.Communication").service("AnnotationsCommunication",["BaseComponent","NameSpace","Toolbar","Consolidation","AnnotationsExchange","Annotation","NotebookExchange","Notebook","$http","$q",function(a,b,c,d,e,f,g,h){var i=new a("AnnotationCommunication");return i.getAnnotations=function(){c.setLoading(!0);var a=d.getAvailableTargets(),b=e.searchByUri(a);i.log("Getting annotations for available targets",a),b.then(function(a){if(i.log("Found "+a.length+" annotations on the current page."),0===a.length)return void c.setLoading(!1);for(var b=[],e=0,j=0;j<a.length;j++){var k=new f(a[j]);k.then(function(a){var b=a.isIncludedIn;"undefined"==typeof g.getNotebookById(b)&&new h(b)},function(a){i.log("Could not retrieve annotation: "+a)}).finally().then(function(){e++,i.log("Received annotation "+e+"/"+b.length),e===b.length&&(i.log("All promises settled, consolidating"),d.consolidateAll(),c.setLoading(!1))}),b.push(k)}},function(a){i.err("Could not search for annotations, error from the server: "+a)})},i}]),angular.module("Pundit2.Annomatic",[]),angular.module("Pundit2.Annomatic").directive("annomaticPanel",function(){return{restrict:"AE",scope:{first:"=",second:"&funName"},templateUrl:"src/Annomatic/AnnomaticPanel.dir.tmpl.html",link:function(){}}}),angular.module("Pundit2.Annomatic").controller("AnnomaticPanelCtrl",["$scope","Annomatic","Consolidation","ItemsExchange","TextFragmentAnnotator","XpointersHelper","$window","$q",function(a,b,c,d,e,f,g,h){a.targets=e.getAvailableTargets(!0);var i=!1;a.getSuggestions=function(){if(!i){i=!0;for(var e=[],g=f.options.namedContentClasses,j=[],k=a.targets.length;k--;)j.push("[about='"+a.targets[k]+"']");j.join(","),angular.forEach(angular.element(j.join(",")),function(a){for(var b=g.length;b--;)if(angular.element(a).hasClass(g[b])){e.push(a);break}}),b.log("Asking for annotations on "+e.length+" nodes: ",e);for(var l=[],m=e.length;m--;)l.push(b.getDataTXTAnnotations(e[m]));h.all(l).then(function(){c.consolidate(d.getItemsByContainer(b.options.container))})}},a.startReview=function(){b.reviewNext(0)},a.Annomatic=b,a.$watch("filteredTypes",function(a,c){("undefined"!=typeof a||"undefined"!=typeof c)&&b.setTypeFilter(a)},!0);var j,k=angular.element("div.panel-body"),l=function(){var a;return 0===g.getSelection().rangeCount?null:(a=g.getSelection().getRangeAt(0),null!==a&&a.startContainer===a.endContainer&&a.startOffset===a.endOffset?null:a)};angular.element("body").on("mousedown",function(){angular.element("body").on("mousemove",function(){var a=l();a&&a.commonAncestorContainer!==j&&(j&&angular.element(j).removeClass("selecting-ancestor"),j=a.commonAncestorContainer,j.nodeType===Node.TEXT_NODE&&(j=j.parentNode),angular.element(j).addClass("selecting-ancestor"))
})}),angular.element("body").on("mouseup",function(){angular.element("body").off("mousemove"),j&&(angular.element(j).removeClass("selecting-ancestor"),k=angular.element(j),a.getAnnotations())})}]),angular.module("Pundit2.Annomatic").constant("ANNOMATICDEFAULTS",{container:"annomatic",cMenuType:"annomatic"}).service("Annomatic",["ANNOMATICDEFAULTS","BaseComponent","DataTXTResource","XpointersHelper","ItemsExchange","TextFragmentHandler","TypesHelper","DBPediaSpotlightResource","Item","$rootScope","$timeout","$document","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=new b("Annomatic",a);n.ann={byUri:{},byNum:[],numToUriMap:{},uriToNumMap:{},byId:{},autoAnnScopes:[],byState:{},byType:{},typesOptions:[]},n.annotationNumber=0;var o=function(a,b){{var c=a[0];a.html()}n.log("##### Wrapping annotations ",b.length,b);for(var e,f,g,h,i,j,k=[c],m=0,o=0,r=b[o],t=[],u=!1;(i=k.pop())&&o<b.length;)if(n.log("Popped node ",i," current offset = "+m),h=0,d.isTextNode(i)){var v=p(i.textContent);if(0===v.length)0===m?n.log("Skipping FIRST empty text node."):u?n.log("Skipping Consecutive empty text node, without correcting again."):1===q(i.textContent).length?(n.log("Skipping intermediate empty text node, correcting offset by 1"),m+=1,u=!0):n.log("OUCH! trimDoubleSpaces fail?!!? --"+q(i.textContent)+"--");else{for(;r.end<=m+v.length+1;){j=!1;var w=s(i.textContent);w.push(0);for(var x=w.length;x--;)if(f=w[x]+r.start-m+h,g=w[x]+r.end-m+h,e=i.textContent.substring(f,g),n.log("Trying to add "+w[x]+" spaces: --"+e+"-- vs --"+r.spot+"-- ("+f+" to "+g+")"),r.spot===e){h+=w[x],j=!0,n.log("@@ Found annotation "+r.spot);var y=l[0].createRange();y.setStart(i,f),y.setEnd(i,g),y.toString()!==r.spot?n.err("Annotation and range content do not match!! :(("):t.push({range:y,annotation:r});break}if(j||n.log("Annotation NOT FOUND: ",r),o++,r=b[o],o>=b.length){n.log("Annotations are over!!! We are done!!");break}}var z=q(i.textContent);z.match(/^\s\s*/)&&(u||0===m)?(m+=z.length-1,n.log("Moving to next node (corrected by leading space) with current offset = "+m)):(m+=z.length,n.log("Moving to next node with current offset = "+m)),u=!1}}else if(i.hasChildNodes())for(var A=i.childNodes,B=A.length;B--;)k.push(A[B]),n.log("Pushing node ",A[B]);return n.log("Dance finished, found "+t.length+" annotations: ",t),t},p=function(a){return a.replace(/[\r\n]/g," ").replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},q=function(a){return a.replace(/[\r\n]/g," ").replace(/\s+/g," ")},r=function(a){var b=a.match(/(\s\s+)/g);if(null===b)return[];for(var c=b.length;c--;)b[c].match(/\n/)&&(b[c]=b[c].replace(/[\r\n]/g," "));return b},s=function(a){var b=r(a),c=b.length;if(0===c)return[];for(var d=[],e={},f=0;c>f;f++){var g=b[f].length-1;"undefined"==typeof e[g]&&(e[g]=!0,d.push(g))}return d.sort(function(a,b){return a-b})};n.stateClassMap={waiting:"ann-waiting",active:"ann-active",accepted:"ann-ok",removed:"ann-removed",hidden:"ann-hidden"},n.reset=function(){n.ann.typesOptions=[];for(var a in n.stateClassMap)n.ann.byState[a]=[]},n.reset();var t=function(a,b){var c=n.ann.byId,d=n.ann.byType;n.log("Analyzing from "+a+" to "+b);for(var e=a;b>e;e++){var f=n.ann.byNum[e],h=f.id,i=f.types||[];h in c?c[h].push(e):c[h]=[e];for(var j=i.length;j--;){var k=i[j];k in d?d[k].push(e):(n.ann.typesOptions.push({value:k}),d[k]=[e])}f.state="waiting",f.lastState="waiting",n.ann.byState[f.state].push(e)}for(e=n.ann.typesOptions.length;e--;){var l=n.ann.typesOptions[e],m=l.value;l.label=g.getLabel(m)+" ("+d[m].length+")"}n.ann.typesOptions=n.ann.typesOptions.sort(function(a,b){return d[b.value].length-d[a.value].length})},u=function(a,b,c){var d=n.ann.byState,e=d[b].indexOf(a);d[c].push(a),d[b].splice(e,1)};n.setState=function(a,b){var c=n.ann.byNum[a],d=n.ann.autoAnnScopes[a];u(a,c.state,b),c.lastState=c.state,c.state=b;var e=n.stateClassMap[b];c.hidden&&(e+=" "+n.stateClassMap.hidden),d.setStateClass(n.stateClassMap[c.lastState],e)},n.setLastState=function(a){var b=n.ann.byNum[a],c=n.ann.autoAnnScopes[a];u(a,b.state,b.lastState),b.state=b.lastState;var d=n.stateClassMap[b.state];b.hidden&&(d+=" "+n.stateClassMap.hidden),c.setStateClass(n.stateClassMap[b.lastState],d)},n.getDataTXTAnnotations=function(a){var b=m.defer(),d=angular.element(a),g=d.text();return g=p(g),n.log("Querying DataTXT for annotations on content: ",g),n.annotations=c.getAnnotations({$app_id:"cc85cdd8",$app_key:"668e4ac4f00f64c43ab4fefd5c8899fa",text:g},function(a){n.log("Received "+a.annotations.length+" annotations from DataTXT");var c,g=o(d,a.annotations),h=n.annotationNumber;n.annotationNumber+=g.length,n.currAnn=0;for(var i=g.length,j=0;i>j;j++){var k=h+j;c=f.createItemFromRange(g[j].range),n.ann.byNum[k]=g[j].annotation,n.ann.numToUriMap[k]=c.uri,n.ann.uriToNumMap[c.uri]=k,n.ann.byUri[c.uri]=g[j].annotation,e.addItemToContainer(c,n.options.container),c=v(g[j].annotation),e.addItemToContainer(c,n.options.container)}t(h,n.annotationNumber),b.resolve()},function(a){n.err("Error loading annotations from DataTXT"),b.reject(a)}),b.promise};var v=function(a){var b={};return b.uri=a.uri,b.type="undefined"==typeof a.types?["http://dbpedia.org/ontology/Thing"]:angular.copy(a.types),b.description=a.abstract,b.label=a.label,b.label.length>f.options.labelMaxLength&&(b.label=b.label.substr(0,tfh.options.labelMaxLength)+" .."),"thumbnail"in a.image&&(b.image=a.image.thumbnail),new i(b.uri,b)};return n.hideAnn=function(a){var b=n.ann.byNum[a],c=n.ann.autoAnnScopes[a];b.hidden=!0,c.setStateClass(n.stateClassMap[b.state],n.stateClassMap.hidden)},n.showAnn=function(a){var b=n.ann.byNum[a],c=n.ann.autoAnnScopes[a];b.hidden=!1,c.setStateClass(n.stateClassMap.hidden,n.stateClassMap[b.state])},n.setTypeFilter=function(a){var b=n.ann.byType,c=n.ann.byNum,d={};if(n.log("Setting type filter to ",a),0===a.length)for(var e=c.length;e--;)n.showAnn(e);else{for(var f in a)for(var g=a[f],h=b[g].length;h--;)d[b[g][h]]=!0;for(var i=c.length;i--;)i in d?n.showAnn(i):n.hideAnn(i)}var l=j.$$phase;"$apply"===l||"$digest"===l?k(function(){j.$apply()},1):j.$apply()},n.closeAll=function(){for(var a=n.ann.byState.active.length;a--;){var b=n.ann.byState.active[a];n.ann.autoAnnScopes[b].hide()}},n.currAnn=0,n.reviewNext=function(a){if(0===n.annotationNumber)return void n.log("No annotation to review....");if(0===n.ann.byState.waiting.length)return void n.log("All reviewed!");for(n.closeAll(),a="undefined"==typeof a?n.currAnn:parseInt(a,10),n.currAnn=a>=n.annotationNumber?0:a;(n.ann.byNum[n.currAnn].hidden===!0||"waiting"!==n.ann.byNum[n.currAnn].state)&&(n.currAnn++,n.currAnn!==n.annotationNumber););n.currAnn<n.annotationNumber&&n.ann.autoAnnScopes[n.currAnn].show()},n.log("Component up and running"),n}]),angular.module("Pundit2.Annomatic").service("DataTXTResource",["$resource",function(a){var b="https://api.dandelion.eu/datatxt/nex/v1";return a(b,{},{getAnnotations:{params:{lang:"it",min_confidence:0,min_length:3,include_types:!0,include_categories:!0,include_abstract:!0,include_lod:!0,include_image:!0},method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}}})}]),angular.module("Pundit2.Annomatic").service("DBPediaSpotlightResource",["$http","$q",function(a,b){var c,d=b.defer(),e="http://spotlight.dbpedia.org/rest/annotate";return c={getAnnotations:function(b){return a({data:"text="+encodeURIComponent(b),headers:{"content-type":"application/x-www-form-urlencoded",Accept:"application/json"},method:"POST",url:e}).success(function(a){d.resolve(a)}),d.promise}}}]),angular.module("Pundit2.Annomatic").controller("AnnomaticPopoverCtrl",["$scope","Annomatic",function(a,b){a.num=parseInt(a.content,10),a.ann=b.ann,a.showDetails=!0,a.instances=a.ann.byId[a.ann.byNum[a.num].id].length,a.hide=function(){a.$hide(),b.setLastState(a.num)},a.setOk=function(){a.$hide(),b.setState(a.num,"accepted"),b.reviewNext(a.num+1)},a.setKo=function(){a.$hide(),b.setState(a.num,"removed"),b.reviewNext(a.num+1)},a.goNext=function(){a.$hide(),b.setLastState(a.num),b.reviewNext(a.num+1)},a.acceptAll=function(){for(var c=a.ann.byNum[a.num].id,d=a.ann.byId[c],e=d.length;e--;)b.setState(d[e],"accepted");a.$hide(),b.reviewNext(a.num+1)},a.toggleSimilar=function(){for(var c=a.ann.byNum[a.num],d=c.id,e=a.ann.byId[d],f=e.length;f--;)if(e[f]!==a.num){var g=b.ann.byNum[e[f]];"active"!==g.state?b.setState(e[f],"active"):b.setLastState(e[f])}}}]),angular.module("Pundit2.Annomatic").directive("suggestionFragmentIcon",["TextFragmentAnnotator","XpointersHelper","Annomatic","$popover",function(a,b,c,d){return{restrict:"E",scope:{fragment:"@"},templateUrl:"src/Annomatic/SuggestionFragmentIcon.dir.tmpl.html",replace:!0,link:function(e,f){e.textFragmentIconClass=b.options.textFragmentIconClass,e.iconClass=a.options.suggestionIconClass,e.element=f,a.addFragmentIcon(e);var g=function(){e.uri=e.item.uri,e.num=c.ann.uriToNumMap[e.uri],c.ann.autoAnnScopes[e.num]=e,angular.element("."+e.fragment).addClass("ann-auto"),e.popover=d(e.element,{content:""+e.num,placement:"bottom",template:"src/Annomatic/AnnomaticPopover.tmpl.html",trigger:"manual",container:"[data-ng-app='Pundit2']"})};g(),e.mouseoverHandler=function(){a.highlightById(e.fragment)},e.mouseoutHandler=function(){a.clearHighlightById(e.fragment)},e.clickHandler=function(){c.ann.byNum[e.num].hidden||(e.popover.$isShown?e.hide():e.show())},e.show=function(){e.popover.$isShown!==!0&&(c.closeAll(),c.setState(e.num,"active"),e.popover.show())},e.hide=function(){e.popover.$isShown!==!1&&(c.setLastState(e.num),e.popover.hide())},e.setStateClass=function(a,b){angular.element("."+e.fragment).removeClass(a+" ann-active"),angular.element("."+e.fragment).addClass(b),a===c.stateClassMap.hidden?f.removeClass("ann-hidden"):b===c.stateClassMap.hidden&&f.addClass("ann-hidden")},e.setStateClass("",c.stateClassMap.waiting)}}}]),angular.module("Pundit2.AnnotationSidebar",[]),angular.module("Pundit2.AnnotationSidebar").directive("annotationSidebar",["AnnotationSidebar",function(a){return{restrict:"E",scope:{},templateUrl:"src/AnnotationSidebar/AnnotationSidebar.dir.tmpl.html",controller:"AnnotationSidebarCtrl",link:function(){angular.element("body").addClass(a.options.bodyClass)}}}]),angular.module("Pundit2.AnnotationSidebar").controller("AnnotationSidebarCtrl",["$scope","$filter","$window","AnnotationSidebar","Dashboard","Toolbar",function(a,b,c,d,e,f){var g=d.options.bodyExpandedClass+" "+d.options.bodyCollapsedClass,h=d.options.sidebarExpandedClass+" "+d.options.sidebarCollapsedClass,i=angular.element("body"),j=angular.element(".pnd-annotation-sidebar-container"),k=angular.element(".pnd-annotation-sidebar-content"),l={toolbarHeight:30,newMarginTopSidebar:0,sidebarCurrentHeight:0,sidebarNewHeight:0},m={icon:d.options.inputIconSearch,clean:d.options.inputIconClear};a.annotationSidebar=d,a.filters=d.getFilters(),j.css("height",i.innerHeight()+"px"),d.options.isAnnotationSidebarExpanded?(i.addClass(d.options.bodyExpandedClass),j.addClass(d.options.sidebarExpandedClass)):(i.addClass(d.options.bodyCollapsedClass),j.addClass(d.options.sidebarCollapsedClass)),a.isSuggestionsPanelActive=function(){return d.isSuggestionsPanelActive()},a.activateSuggestionsPanel=function(){d.activateSuggestionsPanel()},a.isAnnotationsPanelActive=function(){return d.isAnnotationsPanelActive()},a.activateAnnotationsPanel=function(){d.activateAnnotationsPanel()},a.$watch(function(){return f.isLoading()},function(b,c){b!==c&&(a.isLoading=b)}),a.$watch(function(){return d.isAnnotationSidebarExpanded()},function(b,c){a.isAnnotationSidebarExpanded=b,b!==c&&(i.toggleClass(g),j.toggleClass(h))}),a.$watch(function(){return d.isFiltersExpanded()},function(b){a.isFiltersShowed=b}),a.$watch(function(){return e.getContainerHeight()},function(a){l.newMarginTopSidebar=l.toolbarHeight+a,j.css("top",l.newMarginTopSidebar+"px")}),a.$watch(function(){return e.isDashboardVisible()},function(a){a?(l.newMarginTopSidebar=l.toolbarHeight+e.getContainerHeight(),j.css("top",l.newMarginTopSidebar+"px")):j.css("top",l.toolbarHeight+"px")});var n=function(a,b,c){l.sidebarNewHeight=Math.max(a,b-l.toolbarHeight,c),l.sidebarCurrentHeight=j.innerHeight(),l.sidebarNewHeight!==l.sidebarCurrentHeight&&j.css("height",l.sidebarNewHeight+"px")};a.$watch(function(){return i.innerHeight()},function(a){n(a,c.innerHeight,k.innerHeight())}),a.$watch(function(){return k.innerHeight()},function(a){n(i.innerHeight(),c.innerHeight,a)}),angular.element(c).bind("resize",function(){n(i.innerHeight(),c.innerHeight,k.innerHeight())}),a.fromMinDate=new Date,a.toMinDate=new Date,a.fromMaxDate=new Date,a.fromToDate=new Date;var o=function(a){var c=new Date(a&&!isNaN(Date.parse(a))?Date.parse(a):0);return c.setDate(c.getDate()-1),b("date")(c,"yyyy-MM-dd")};a.$watch(function(){return d.getAllAnnotations()},function(b){a.allAnnotations=b,a.annotations=d.needToFilter()?d.getAllAnnotationsFiltered(d.filters):b}),a.$watch(function(){return d.getMinDate()},function(c){if("undefined"!=typeof c){var e=b("date")(c,"yyyy-MM-dd");a.fromMinDate=o(e),""===d.filters.fromDate.expression&&(a.toMinDate=o(e))}}),a.$watch(function(){return d.getMaxDate()},function(c){if("undefined"!=typeof c){var e=b("date")(c,"yyyy-MM-dd");a.toMaxDate=e,""===d.filters.toDate.expression&&(a.fromMaxDate=e)}}),a.$watch("annotationSidebar.filters.fromDate.expression",function(b){a.toMinDate=o("undefined"!=typeof b?b:a.fromMinDate)}),a.$watch("annotationSidebar.filters.toDate.expression",function(b){a.fromMaxDate="undefined"!=typeof b?b:a.toMaxDate}),a.$watch("annotationSidebar.filters",function(b){a.annotations=d.getAllAnnotationsFiltered(b)},!0),a.isFilterLabelShowed=function(a){return"string"==typeof a?a.length>0:void 0},a.toggleFilterList=function(a){var b=angular.element(".pnd-annotation-sidebar-filter-show"),c=angular.element(a.target.parentElement);b.not(c).removeClass("pnd-annotation-sidebar-filter-show"),c.toggleClass("pnd-annotation-sidebar-filter-show")},a.toggleFilter=function(a,b){var c=d.filters[a].expression.indexOf(b);-1===c?(d.filters[a].expression.push(b),d.toggleActiveFilter(a,b)):(d.filters[a].expression.splice(c,1),d.toggleActiveFilter(a,b))},a.setSearchIcon=function(a){return"undefined"==typeof a||""===a?m.icon:m.clean},d.log("Controller Run")}]),angular.module("Pundit2.AnnotationSidebar").filter("orderObjectBy",function(){return function(a,b,c){var d=[];if(!angular.isObject(a))return a;for(var e in a)d.push(a[e]);return d.sort(function(a,d){return a=parseInt(a[b]),d=parseInt(d[b]),"asc"==c?a-d:d-a}),d}}).filter("freeText",function(){return function(a,b){var c=[];return b.length>0?angular.forEach(a,function(a){for(var d in a.items){var e=a.items[d].label,f=b.toLowerCase().replace(/\s+/g," "),g=f.split(" "),h=new RegExp(g.join(".*"));if(null!==e.toLowerCase().match(h))return void c.push(a)}}):c=a,c}}).filter("authors",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){c=a.creator,-1!==b.indexOf(c)&&d.push(a)}):d=a,d}}).filter("notebooks",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){c=a.isIncludedInUri,-1!==b.indexOf(c)&&d.push(a)}):d=a,d}}).filter("predicates",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.predicates)if(c=a.predicates[e],-1!==b.indexOf(c))return void d.push(a)}):d=a,d}}).filter("entities",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.entities)if(c=a.entities[e],-1!==b.indexOf(c))return void d.push(a)}):d=a,d}}).filter("types",function(){return function(a,b){var c,d=[];return b.length>0?angular.forEach(a,function(a){for(var e in a.items){var f=a.items[e];for(var g in f.type)if(c=f.type[g],-1!==b.indexOf(c))return void d.push(a)}}):d=a,d}}).filter("fromDate",function(){return function(a,b){var c,d=[];return b?(c=new Date(b&&!isNaN(Date.parse(b))?Date.parse(b):0),c.setHours(0,0,0),angular.forEach(a,function(a){var b=Date.parse(a.created);b>=c&&d.push(a)})):d=a,d}}).filter("toDate",function(){return function(a,b){var c,d=[];return b?(c=new Date(b&&!isNaN(Date.parse(b))?Date.parse(b):(new Date).getTime()),c.setHours(23,59,59),angular.forEach(a,function(a){var b=Date.parse(a.created);c>=b&&d.push(a)})):d=a,d}}),angular.module("Pundit2.AnnotationSidebar").constant("ANNOTATIONSIDEBARDEFAULTS",{isAnnotationSidebarExpanded:!1,isFiltersShowed:!1,annotationsRefresh:300,bodyClass:"pnd-annotation-sidebar-active",bodyExpandedClass:"pnd-annotation-sidebar-expanded",bodyCollapsedClass:"pnd-annotation-sidebar-collapsed",sidebarExpandedClass:"pnd-annotation-sidebar-expanded",sidebarCollapsedClass:"pnd-annotation-sidebar-collapsed",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",annotationsPanelActive:!0,suggestionsPanelActive:!1,clientDomTemplate:"src/AnnotationSidebar/ClientAnnotationSidebar.tmpl.html",annotationHeigth:25,debug:!1}).service("AnnotationSidebar",["$rootScope","$filter","$timeout","BaseComponent","AnnotationsExchange","Consolidation","ItemsExchange","NotebookExchange","TypesHelper","TextFragmentAnnotator","ANNOTATIONSIDEBARDEFAULTS",function(a,b,c,d,e,f,g,h,i,j,k){var l=new d("AnnotationSidebar",k),m={isSidebarExpanded:l.options.isAnnotationSidebarExpanded,isFiltersExpanded:l.options.isFiltersShowed,allAnnotations:[],filteredAnnotations:[],isAnnotationsPanelActive:l.options.annotationsPanelActive,isSuggestionsPanelActive:l.options.suggestionsPanelActive},n={annotationsDate:[],authors:{},notebooks:{},entities:{},predicates:{},types:{}},o=70,p=[];l.filters={freeText:{filterName:"freeText",filterLabel:"Free text",expression:""},authors:{filterName:"authors",filterLabel:"Author",expression:[]},notebooks:{filterName:"notebooks",filterLabel:"Notebooks",expression:[]},fromDate:{filterName:"fromDate",filterLabel:"From date",expression:""},toDate:{filterName:"toDate",filterLabel:"To date",expression:""},predicates:{filterName:"predicates",filterLabel:"Predicates",expression:[]},entities:{filterName:"entities",filterLabel:"Entities",expression:[]},types:{filterName:"types",filterLabel:"Types",expression:[]}},l.filtersCount={},l.annotationPositionReal={},l.toggle=function(){m.isSidebarExpanded=!m.isSidebarExpanded},l.toggleFiltersContent=function(){m.isFiltersExpanded=!m.isFiltersExpanded},l.isAnnotationSidebarExpanded=function(){return m.isSidebarExpanded},l.isFiltersExpanded=function(){return m.isFiltersExpanded},l.isAnnotationsPanelActive=function(){return m.isAnnotationsPanelActive},l.activateAnnotationsPanel=function(){m.isAnnotationsPanelActive=!0,m.isSuggestionsPanelActive=!1},l.isSuggestionsPanelActive=function(){return m.isSuggestionsPanelActive},l.activateSuggestionsPanel=function(){m.isSuggestionsPanelActive=!0,m.isAnnotationsPanelActive=!1};var q=function(a){return"undefined"==typeof l.filtersCount[a]?l.filtersCount[a]=1:l.filtersCount[a]++,l.filtersCount[a]},r=function(a){l.filtersCount={},angular.forEach(n,function(a){for(var b in a)a[b].count=0}),angular.forEach(a,function(a){var b={};n.authors[a.creator].count=q(a.creator),n.notebooks[a.isIncludedInUri].count=q(a.isIncludedIn),angular.forEach(a.predicates,function(a){"undefined"==typeof b[a]&&(b[a]={uri:a},n.predicates[a].count=q(a))}),angular.forEach(a.entities,function(a){"undefined"==typeof b[a]&&(b[a]={uri:a},n.entities[a].count=q(a))}),angular.forEach(a.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof b[a]&&(b[a]={uri:a},n.types[a].count=q(a))})})})},s=function(){var a,b;p.sort(function(a,b){return a.top-b.top}),a=p;for(var c in a)l.annotationPositionReal[a[c].id]={id:a[c].id,top:a[c].top,broken:a[c].broken};a=l.annotationPositionReal;for(var c in a)a[c].broken||(b=a[c].top,b>o?(l.annotationPositionReal[c].top=b,o=b+l.options.annotationHeigth):(l.annotationPositionReal[c].top=o,o+=l.options.annotationHeigth))},t=function(a){o=70,angular.forEach(a,function(a){var b,c,d,e=a.graph;if(a.isBroken())p.push({id:a.id,top:o,broken:!0}),o+=l.options.annotationHeigth;else{for(b in e)break;if(c=g.getItemByUri(b),d=f.isConsolidated(c)?j.getFragmentIdByUri(b):void 0,"undefined"!=typeof d){var h=angular.element("."+d).offset().top;p.push({id:a.id,top:h,broken:!1})}}}),s()},u=function(a){var b;j.hideAll(),angular.forEach(a,function(a){for(var c in a.items)-1===a.predicates.indexOf(c)&&(b=g.getItemByUri(c),f.isConsolidated(b)&&j.showByUri(b.uri))})},v=function(b){l.filtersCount={},angular.forEach(b,function(b){var c={};"undefined"==typeof n.authors[b.creator]&&(n.authors[b.creator]={uri:b.creator,label:b.creatorName,active:!1,count:0}),-1===n.annotationsDate.indexOf(b.created)&&n.annotationsDate.push(b.created);var d=b.isIncludedIn,e=b.isIncludedInUri;if("undefined"==typeof n.notebooks[e]){var f="Downloading in progress",g=a.$watch(function(){return h.getNotebookById(d)},function(a){"undefined"!=typeof a&&(f=a.label,n.notebooks[e].label=f,g())});n.notebooks[e]={uri:e,label:f,notebookId:d,active:!1,count:0}}angular.forEach(b.predicates,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},"undefined"==typeof n.predicates[a]&&(n.predicates[a]={uri:a,label:b.items[a].label,active:!1,count:0}))}),angular.forEach(b.entities,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},"undefined"==typeof n.entities[a]&&(n.entities[a]={uri:a,label:b.items[a].label,active:!1,count:0}))}),angular.forEach(b.items,function(a){angular.forEach(a.type,function(a){"undefined"==typeof c[a]&&(c[a]={uri:a},"undefined"==typeof n.types[a]&&(n.types[a]={uri:a,label:i.getLabel(a),active:!1,count:0}))})})}),r(b)};return l.getAllAnnotations=function(){return m.allAnnotations},l.getAllAnnotationsFiltered=function(a){var c,d;return m.filteredAnnotations=angular.copy(m.allAnnotations),angular.forEach(a,function(a){d=a.filterName,c=a.expression,"string"==typeof c&&""!==c?m.filteredAnnotations=b(d)(m.filteredAnnotations,c):angular.isArray(c)&&c.length>0&&(m.filteredAnnotations=b(d)(m.filteredAnnotations,c))}),u(m.filteredAnnotations),m.filteredAnnotations},l.getFilters=function(){return n},l.getMinDate=function(){return n.annotationsDate.length>0?n.annotationsDate.reduce(function(a,b){return b>a?a:b}):void 0},l.getMaxDate=function(){return n.annotationsDate.length>0?n.annotationsDate.reduce(function(a,b){return a>b?a:b}):void 0},l.needToFilter=function(){for(var a in l.filters){var b=l.filters[a].expression;if("string"==typeof b&&""!==b)return!0;if(angular.isArray(b)&&b.length>0)return!0}return!1},l.toggleActiveFilter=function(a,b){n[a][b].active=!n[a][b].active},l.setFilter=function(a,b){var c,d=l.filters[a].expression;"string"==typeof d?l.filters[a].expression=b:"object"==typeof d&&(c=l.filters[a].expression.indexOf(b),currentElementInList=n[a][b],-1===c&&"undefined"!=typeof currentElementInList&&(currentElementInList.active=!0,l.filters[a].expression.push(b)))},l.removeFilter=function(a,b){var c,d=l.filters[a].expression;"string"==typeof d?l.filters[a].expression="":"object"==typeof d&&(c=l.filters[a].expression.indexOf(b),-1!==c&&(n[a][b].active=!1,l.filters[a].expression.splice(c,1)))},l.resetFilters=function(){angular.forEach(l.filters,function(a){if("string"==typeof a.expression)a.expression="";else if("object"==typeof a.expression){for(var b in n[a.filterName])n[a.filterName][b].active=!1;a.expression=[]}})},a.$on("consolidation-completed",function(){l.log("Update annotations in sidebar");var a=e.getAnnotations();m.allAnnotations=angular.copy(a),v(m.allAnnotations),t(m.allAnnotations)}),l.log("Component running"),l}]),angular.module("Pundit2.AnnotationSidebar").directive("annotationDetails",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/AnnotationSidebar/AnnotationDetails.dir.tmpl.html",controller:"AnnotationDetailsCtrl"}}),angular.module("Pundit2.AnnotationSidebar").controller("AnnotationDetailsCtrl",["$scope","AnnotationSidebar","AnnotationDetails","AnnotationsExchange","NotebookExchange","ItemsExchange","TextFragmentAnnotator","Toolbar","TypesHelper",function(a,b,c,d,e,f,g,h){var i=a.id;c.addAnnotationReference(a),a.annotation=c.getAnnotationDetails(i),a.askLink=c.isUserToolShowed(a.annotation.creator)?h.options.askLinkDefault+"#/myNotebooks/":h.options.askLinkDefault+"#/notebooks/";var j=a.annotation.notebookId;a.notebookName="Downloading notebook in progress";var k=a.$watch(function(){return e.getNotebookById(j)},function(b){"undefined"!=typeof b&&(a.notebookName=b.label,k())});a.toggleAnnotation=function(){a.metaInfo=!1,c.toggleAnnotationView(i)},a.toggleObjectInfo=function(a,b){return"uri"!==a?b:!b},a.isUserToolShowed=function(){return c.isUserToolShowed(a.annotation.creator)},a.mouseoverHandler=function(){var b=a.annotation.fragments;if(b.length>0)for(var c in b)g.highlightById(b[c])},a.mouseoutHandler=function(){var b=a.annotation.fragments;if(b.length>0)for(var c in b)g.clearHighlightById(b[c])},c.log("Controller Details Run")}]),angular.module("Pundit2.AnnotationSidebar").constant("ANNOTATIONDETAILSDEFAULTS",{defaultExpanded:!1,debug:!1}).service("AnnotationDetails",["$rootScope","$filter","BaseComponent","Annotation","AnnotationsExchange","Consolidation","ItemsExchange","MyPundit","TextFragmentAnnotator","TypesHelper","ANNOTATIONDETAILSDEFAULTS",function(a,b,c,d,e,f,g,h,i,j,k){var l=new c("AnnotationDetails",k),m={annotations:[],defaultExpanded:l.options.defaultExpanded,isUserLogged:!1,userData:{}},n=function(a){var b=g.getItemByUri(a),c={uri:a,label:b.label,description:b.description,image:"undefined"!=typeof b.image?b.image:null,"class":b.getClass(),icon:b.getIcon(),typeLabel:"undefined"!=typeof b.type[0]?j.getLabel(b.type[0]):null,typeClass:"uri"};return c},o=function(a){var b,c=a,d={};for(b in c.graph)break;return d=n(b)},p=function(a){var b,c,d=[];for(var e in a)b=a[e].value,c=a[e].type,d.push("uri"===c?n(b):{uri:null,label:b,description:b,image:null,"class":null,icon:null,typeLabel:c,typeClass:c});return d},q=function(a){var b=a,c=b.graph,d=[];for(var e in c)for(var f in c[e])d.push({subject:n(e),predicate:n(f),objects:p(c[e][f],b)});return d},r=function(a){var b,c=a,d=c.graph,e=[];for(var h in d){b=g.getItemByUri(h),f.isConsolidated(b)&&e.push(i.getFragmentIdByUri(h));for(var j in d[h]){var k=d[h][j];for(var l in k)objectValue=k[l].value,objectType=k[l].type,"uri"===objectType&&(b=g.getItemByUri(objectValue),f.isConsolidated(b)&&e.push(i.getFragmentIdByUri(objectValue)))}}return e};return l.addAnnotationReference=function(a){var b=a.id,c=e.getAnnotationById(b);m.annotations[b]={id:b,creator:c.creator,creatorName:c.creatorName,created:c.created,notebookId:c.isIncludedIn,scopeReference:a,mainItem:o(c),itemsArray:q(c),broken:c.isBroken(),expanded:m.defaultExpanded,fragments:r(c)}},l.getAnnotationDetails=function(a){return a in m.annotations?m.annotations[a]:void 0},l.getAnnotationViewStatus=function(a){return m.annotations[a].expanded},l.closeAllAnnotationView=function(a){for(var b in m.annotations)b!==a&&(m.annotations[b].expanded=!1)},l.openAnnotationView=function(a){l.closeAllAnnotationView(a),m.annotations[a].expanded=!0},l.toggleAnnotationView=function(a){l.closeAllAnnotationView(a),m.annotations[a].expanded=!m.annotations[a].expanded},l.isAnnotationUser=function(a){return a===m.userData.uri},l.isUserToolShowed=function(a){return m.isUserLogged===!0&&a===m.userData.uri},a.$watch(function(){return h.isUserLogged()},function(a){m.isUserLogged=a,m.userData=h.getUserData()}),l.log("Component running"),l}]),angular.module("Pundit2.Dashboard",[]),angular.module("Pundit2.Dashboard").directive("dashboard",function(){return{restrict:"E",scope:{},templateUrl:"src/Dashboard/Dashboard.dir.tmpl.html",controller:"DashboardCtrl"}}),angular.module("Pundit2.Dashboard").controller("DashboardCtrl",["$document","$window","$rootScope","$scope","$compile","Dashboard",function(a,b,c,d,e,f){var g={container:angular.element(".pnd-dashboard-container"),footer:angular.element(".pnd-dashboard-footer"),body:angular.element("body")};g.footer.css({height:f.options.footerHeight}),d.isDashboardVisible=f.isDashboardVisible();var h=function(){var a=angular.element("body"),b=parseInt(a.innerWidth(),10),e=parseInt(a.css("margin-left"),10),g=parseInt(a.css("margin-right"),10),h=b+g+e;h!==f.getContainerWidth()&&(f.setContainerWidth(h),c.$$phase||d.$digest())};d.$watch(function(){return g.body.innerWidth()},h),angular.element(b).resize(h),d.$watch(function(){return f.getConfiguredPanels()},function(a){for(var b in a)f.log("Adding configured panel to Dashboard: "+b),g.container.append('<dashboard-panel paneltitle="'+b+'"></dashboard-panel>');var c=angular.element("dashboard-panel");e(c)(d)}),d.$watch(function(){return f.getContainerHeight()},function(a){g.container.css({height:a});var b=parseInt(g.container.css("top"),10);g.body.css({marginTop:b+a})}),d.$watch(function(){return f.getContainerWidth()},function(a){g.container.css({width:a})}),d.$watch(function(){return f.isDashboardVisible()},function(a,b){if(d.isDashboardVisible=a,"undefined"!=typeof a&&"undefined"!=typeof b){var c=parseInt(g.container.css("top"),10),e=a?c+f.getContainerHeight():c;g.body.css({marginTop:e})}});var i,j=function(){a.off("mousemove",k),a.off("mouseup",j)},k=function(a){var b=a.pageY-i;f.increaseContainerHeight(b)&&(i=a.pageY)};d.footerMouseDownHandler=function(b){1===b.which&&(b.preventDefault(),a.on("mouseup",j),a.on("mousemove",k),i=b.pageY)},f.log("Controller Run")}]),angular.module("Pundit2.Dashboard").constant("DASHBOARDDEFAULTS",{clientDomTemplate:"src/Dashboard/ClientDashboard.tmpl.html",debug:!1,isDashboardVisible:!1,containerMinHeight:200,containerMaxHeight:800,containerHeight:300,footerHeight:20,separatorWidth:8,panels:{lists:{minWidth:243},tools:{minWidth:478},details:{minWidth:239}},panelCollapsedWidth:28,panelTabsHeight:27,panelContentHeaderHeight:43,panelInnerTabsHeight:31,panelFooterHeight:40}).service("Dashboard",["BaseComponent","DASHBOARDDEFAULTS","$window","$rootScope",function(a,b,c,d){var e=new a("Dashboard",b),f=0;for(var g in e.options.panels)f+=e.options.panels[g].minWidth;var h={isDashboardVisible:e.options.isDashboardVisible,containerWidth:Math.max(angular.element("body").innerWidth(),f),containerHeight:e.options.containerHeight,panelsContent:{}};e.getConfiguredPanels=function(){return e.options.panels},e.canCollapsePanel=function(){var a=i.filter(function(a){return a.isCollapsed}).length;return a<i.length-1},e.toggle=function(){if(h.isDashboardVisible=!h.isDashboardVisible,h.isDashboardVisible)for(var a in i)i[a].setTabContentHeight()},e.isDashboardVisible=function(){return h.isDashboardVisible},e.getContainerHeight=function(){return h.containerHeight},e.increaseContainerHeight=function(a){if(h.containerHeight===e.options.containerMaxHeight&&a>0)return!1;if(h.containerHeight===e.options.containerMinHeight&&0>a)return!1;var b=h.containerHeight+a;return h.containerHeight=b<e.options.containerMinHeight?e.options.containerMinHeight:b>e.options.containerMaxHeight?e.options.containerMaxHeight:b,d.$$phase||d.$digest(),!0},e.getContainerWidth=function(){return h.containerWidth},e.setContainerWidth=function(a){return f>=a?(h.containerWidth=f,e.resizeAll(),void e.log("Dashboard is at min-width")):(h.containerWidth=a,void e.resizeAll())};var i=[];return e.addPanel=function(a){e.log("Adding panel",a.paneltitle);var b=i.length;if(b>0&&(i[b-1].isLast=!1,i[b-1].collapsedWidth=e.options.panelCollapsedWidth),a.isLast=!0,a.collapsedWidth=e.options.panelCollapsedWidth-e.options.separatorWidth,a.minWidth=e.options.panels[a.paneltitle].minWidth,a.index=b,i.push(a),a.paneltitle in h.panelsContent)for(var c=h.panelsContent[a.paneltitle],d=c.length;d--;)e.log("Adding tab "+c[d].tabName+" to existing panel "+a.paneltitle),a.addContent(c[d].tabName,c[d].tabTemplate);var f=0;for(var g in e.options.panels)f++;i.length===f&&e.resizeAll()},e.resizeAll=function(a){var b,c,f=e.getContainerWidth(),g=0;angular.isObject(a)||(a={});for(c in a)g++,f-=a[c];var h=i.filter(function(a){return a.isCollapsed}),j=i.filter(function(a){return!a.isCollapsed});f-=h.reduce(function(a,b){return a+b.collapsedWidth
},0);var k=j.reduce(function(b,c){return c.width<c.minWidth&&(c.width=c.minWidth),c.index in a?b:b+c.width},0);for(b=j.length;b--;)j[b].ratio=j[b].width/k;var l=0,m=[],n=0;for(b=i.length,c=0;b>c;c++){if(c in a)i[c].width=a[c];else if(i[c].isCollapsed)i[c].width=i[c].collapsedWidth;else{var o=i[c].ratio*f;o<i[c].minWidth?(n+=o-i[c].minWidth,i[c].width=i[c].minWidth):(i[c].width=o,m.push(i[c]))}i[c].left=l,l+=i[c].width}for(var p,q;0>n;){for(p=0,q=0,l=0,c=0;c<m.length;c++)q+=m[c].width;for(c=0;c<m.length;c++){m[c].ratio=m[c].width/q;var o=m[c].width+m[c].ratio*n;o<m[c].minWidth?(p+=o-m[c].minWidth,m[c].width=m[c].minWidth,m.splice(c,1)):m[c].width=o}for(c=0;c<i.length;c++)i[c].left=l,l+=i[c].width;n=p}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest()},e.tryToResizeCouples=function(a,b){var c,e=i[a];if(e.isCollapsed){if(!(a+1<i.length)||i[a+1].isCollapsed)return!1;for(c=a-1;c>=0;c--)if(!i[c].isCollapsed){e=i[c],a=c;break}if(0>c)return!1}var f=!0;if(a<i.length-1){for(c=a+1;c<i.length;c++)if(!i[c].isCollapsed){f=!1;break}if(f)return!1}if(0>b){var g=e.width-Math.max(e.minWidth,e.width+b);if(e.width=Math.max(e.minWidth,e.width+b),g>0){var h=e.left;for(c=a+1;c<i.length;c++){if(!i[c].isCollapsed){i[c].width=i[c].width+g,i[c].left=i[c-1].left+i[c-1].width;break}i[c].left=h+i[c-1].width}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!0}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!1}if(i.length>a+1){var j;for(c=a+1;c<i.length;c++)if(!i[c].isCollapsed){j=c;break}var k=i[j],g=k.width-Math.max(k.minWidth,k.width-b);if(k.width=Math.max(k.minWidth,k.width-b),g>0){e.width=e.width+g;var h=e.left+e.width;for(c=a+1;j>c;c++)i[c].left=h,h+=i[c].width;if(k.left=h,!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!0}if(!d.$$phase)for(c=0;c<i.length;c++)i[c].$digest();return!1}},e.addContent=function(a,b,c){for(var d in i)if(i[d].paneltitle===a)return e.log("Adding tab "+b+" to existing panel "+a),void i[d].addContent(b,c);var f={tabName:b,tabTemplate:c};a in h.panelsContent?h.panelsContent[a].push(f):h.panelsContent[a]=[f],e.log("Added tab "+b+" to non-existing panel "+a+": for later use.")},e.log("Service run"),e}]),angular.module("Pundit2.Dashboard").directive("dashboardPanel",function(){return{restrict:"E",transclude:!0,scope:{paneltitle:"@"},templateUrl:"src/Dashboard/DashboardPanel.dir.tmpl.html",controller:"DashboardPanelCtrl"}}),angular.module("Pundit2.Dashboard").controller("DashboardPanelCtrl",["$document","$window","$scope","$rootScope","$element","$timeout","Dashboard",function(a,b,c,d,e,f,g){c.collapsedWidth=g.options.panelCollapseWidth,c.bottom=g.options.footerHeight,c.minWidth=100,c.ratio=1,c.isCollapsed=!1,c.left=0,c.width=200,c.tabs=[],c.$watch(function(){return c.tabs.activeTab},function(){f(function(){c.setTabContentHeight()},30)}),c.toggleCollapse=function(){if(c.isCollapsed){c.isCollapsed=!c.isCollapsed;var a={};a[c.index]=c.minWidth,g.resizeAll(a)}else g.canCollapsePanel()&&(c.isCollapsed=!c.isCollapsed,g.resizeAll())},c.addContent=function(a,b){c.tabs.push({title:a,template:b}),g.log("Added content "+a+" to panel "+c.title)};var h,i=function(a){var b,d=a.pageX-h;0!==d&&(b=g.tryToResizeCouples(c.index,d),b&&(h=a.pageX))},j=function(){a.off("mousemove",i),a.off("mouseup",j)};c.mouseDownHandler=function(b){b.preventDefault(),h=b.pageX,a.on("mousemove",i),a.on("mouseup",j)},c.$watch(function(){return g.getContainerHeight()},function(){c.setTabContentHeight()}),c.setTabContentHeight=function(){var a=g.getContainerHeight(),b=angular.element(e).find(".pnd-inner .pnd-tab-content"),c=angular.element(e).find(".pnd-inner-scrollable");a-=g.options.panelTabsHeight,a-=g.options.panelContentHeaderHeight,a-=g.options.panelFooterHeight,a-=g.options.footerHeight,b.length>0?(a-=g.options.panelInnerTabsHeight,b.height(a-1)):c.length>0&&c.height(a-7)},g.addPanel(c),d.$$phase||c.$digest(),g.log("Panel "+c.title+" Controller Run")}]),angular.module("Pundit2.Dashboard").directive("pndTabs",function(){return{restrict:"EAC",scope:!0,templateUrl:"src/Dashboard/pndTabs.dir.tmpl.html",controller:"pndTabsCtrl"}}),angular.module("Pundit2.Dashboard").controller("pndTabsCtrl",["$document","$window","$rootScope","$scope","Dashboard","$element",function(a,b,c,d,e,f){var g={animation:"am-fade",offsetButton:40};d.hiddenTabsDropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",g.animation&&f.addClass(g.animation),d.panes=null,d.hiddenTabs=[],d.$watch("tabs",function(a){if(!angular.equals(a,d.panes)){d.panes=angular.copy(a);for(var b in d.panes)d.panes[b].isVisible=!0}},!0);var h=0,i=!1;d.$watch(function(){return angular.element(f).children("ul.pnd-tab-header").children("li:not(.pull-right)").length},function(a){a>0&&(h=a,i=!0,l())});var j=0,k=angular.element(f).children("ul.pnd-tab-header");d.$watch(function(){return k.width()},function(a){j=parseInt(a,10),l(),d.hiddenTabIsActive=-1===o()?!1:!0});var l=function(){h>0&&j>0&&(i&&(i=!1,m()),n(j))},m=function(){for(var a=angular.element(f).children("ul.pnd-tab-header").children("li:not(.pull-right)"),b=0;b<a.length;b++){var c=parseInt(angular.element(a[b]).css("width"),10);d.panes[b].width=c}},n=function(a){d.hiddenTabs=[];for(var b,c,e,f=a-g.offsetButton,h=0,i=0;i<d.panes.length;i++){if(b=d.panes[i],e=h+b.width,e>f){c=i;break}h=e}for(i=0;i<d.panes.length;i++)if(b=d.panes[i],c>i||"undefined"==typeof c)b.isVisible=!0;else{b.isVisible=!1;var j={text:b.title,click:"setActive("+i+", $event)"};j.isActive=i===d.tabs.activeTab?!0:!1,d.hiddenTabs.push(j)}},o=function(a){var b;if("undefined"==typeof d.hiddenTabs)return-1;if(0===d.hiddenTabs.length)return-1;if("undefined"==typeof d.tabs.activeTab)return-1;if(""===a||"undefined"==typeof a){var c=d.tabs.activeTab;b=d.panes[c]}else b=a;for(var e=0;e<d.hiddenTabs.length;e++)if(d.hiddenTabs[e].text===b.title)return e;return-1};f.addClass("tabs"),d.active=d.activePane=0,c.$on("pnd-dashboard-show-tab",function(a,b){for(var c=0;c<d.panes.length;c++)if(d.panes[c].title===b)return d.active!==c&&d.setActive(c),void(d.$parent.isCollapsed&&d.$parent.toggleCollapse())}),d.setActive=function(a){if(0!==d.hiddenTabs.length)for(var b=0;b<d.hiddenTabs.length;b++)d.hiddenTabs[b].isActive=!1;if(d.active=a,d.tabs.activeTab=a,d.panes[a].isVisible)d.hiddenTabIsActive=!1;else{d.hiddenTabIsActive=!0;var c=o(d.panes[a]);d.hiddenTabs[c].isActive=!0}};var p=!1;d.$watch(function(){return d.hiddenTabs},function(){p=d.hiddenTabs.length>0}),d.hiddenTabsToShow=function(){return p}}]),angular.module("Pundit2.ContextualMenu",[]),angular.module("Pundit2.ContextualMenu").constant("CONTEXTUALMENUDEFAULTS",{position:"bottom-left",debug:!1}).service("ContextualMenu",["$rootScope","BaseComponent","CONTEXTUALMENUDEFAULTS","$dropdown","$window",function(a,b,c,d,e){var f=new b("ContextualMenu",c),g={menu:null,menuElements:[],menuResource:null,menuType:null,lastX:0,lastY:0,anchor:null,content:null,mockMenu:null};angular.element("[data-ng-app='Pundit2']").prepend("<div class='pnd-dropdown-contextual-menu-anchor' style='position: absolute; left: -500px; top: -500px;'><div>"),g.anchor=angular.element(".pnd-dropdown-contextual-menu-anchor");var h={scope:a.$new()},i={scope:a.$new()},j=function(a,b){return a.scope.content=g.content,a.placement="undefined"!=typeof b?b:f.options.position,a.template="src/ContextualMenu/dropdown.tmpl.html",d(g.anchor,a)};return f.getState=function(){return g},f.buildContent=function(){var a=[],b=g.menuElements.filter(function(a){return a.type.indexOf(g.menuType)>-1});b.sort(function(a,b){return b.priority-a.priority});for(var c in b)b[c].showIf(g.menuResource)&&a.push(b[c].submenu?{text:b[c].label,submenu:!0,hover:b[c].hover,leave:b[c].leave}:b[c].divider?{divider:!0}:{text:b[c].label,click:function(a){return function(){b[a].action(g.menuResource)}}(c)});var d;for(d=a.length-1;d>=0&&"undefined"!=typeof a[d].divider;d--)a.splice(d,1);for(d=0;d<a.length&&"undefined"!=typeof a[d].divider;d++)a.splice(d,1);return f.log("buildContent built "+a.length+" elements for type="+g.menuType),a},f.position=function(a,b,c){var d,f=a.outerWidth(),g=a.outerHeight();return d=c+g>angular.element(e).innerHeight()?"top":"bottom",d+=b+f>angular.element(e).innerWidth()?"-right":"-left"},f.show=function(a,b,c,d){return null!==g.menu&&(g.menu.hide(),g.menu.destroy(),g.menu=null),0===g.menuElements.length?void f.err("Cannot show a contextual menu without any element!!"):"undefined"==typeof c?void f.err("Try to show menu without resource for type "+d):(g.menuResource=c,g.menuType=d,g.content=f.buildContent(),0===g.content.length?void f.err("Tried to show menu for type "+d+" without any content (buildContent fail)"):(f.log("Showing menu for type="+d+" at "+a+","+b),g.lastX=a,g.lastY=b,g.mockMenu=j(i),void g.mockMenu.$promise.then(g.mockMenu.show)))},i.scope.$on("tooltip.show",function(){var a=f.position(angular.element(g.mockMenu.$element),g.lastX,g.lastY);g.anchor.css({left:g.lastX,top:g.lastY}),angular.element(g.mockMenu.$element).remove(),g.menu=j(h,a),g.menu.$promise.then(g.menu.show)}),f.hide=function(){null!==g.menu&&(g.menu.hide(),g.menu.destroy(),g.menu=null)},f.addAction=function(a){var b=g.menuElements.some(function(b){return a.name===b.name});return b?(f.err("Not adding duplicated action "+a.name),!1):(g.menuElements.push(angular.copy(a)),f.log("Added action "+a.name+" for types "+a.type),!0)},f.addSubMenu=function(a){var b=g.menuElements.some(function(b){return angular.equals(a.name,b.name)});if(b)return f.err("Try to add duplicated submenu element"),!1;var c=angular.copy(a);return c.submenu=!0,g.menuElements.push(c),!0},f.addDivider=function(a){var b=angular.copy(a);b.divider=!0,b.showIf=function(){return!0},g.menuElements.push(b)},f.getSubMenuPlacement=function(){var a=h.placement.indexOf("-"),b=h.placement.substring(a+1);return"right"===b?"left":"right"},f.log("service run"),f}]),angular.module("Pundit2.PageItemsContainer",[]),angular.module("Pundit2.PageItemsContainer").directive("pageItemsContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/PageItemsContainer/PageItemsContainer.dir.tmpl.html",controller:"PageItemsContainerCtrl"}}),angular.module("Pundit2.PageItemsContainer").controller("PageItemsContainerCtrl",["$scope","$element","PageItemsContainer","ItemsExchange","Preview","TypesHelper",function(a,b,c,d,e,f){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.itemMenuType=c.options.cMenuType;var g=angular.element(b).find(".page-items-btn-order");a.message={flag:!0,text:"I'm a welcome message"};var h=c.options.order;a.reverse=c.options.reverse,a.tabs=[{title:"All Items",template:"src/Lists/itemList.tmpl.html",filterFunction:function(){return!0}},{title:"Text",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isTextFragment()}},{title:"Images",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isImage()||a.isImageFragment()}},{title:"Entities",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isEntity()}},{title:"Pages",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isWebPage()}}],a.tabs.activeTab=c.options.initialActiveTab,a.dropdownOrdering=[{text:"Label Asc",click:function(){h="label",a.reverse=!1}},{text:"Label Desc",click:function(){h="label",a.reverse=!0}},{text:"Type Asc",click:function(){a.dropdownOrdering[2].disable||(h="type",a.reverse=!1)}},{text:"Type Desc",click:function(){a.dropdownOrdering[3].disable||(h="type",a.reverse=!0)}}];var i=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===h?i(a.label):"type"===h?i(f.getLabel(a.type[0])):void 0};var j=function(b){b=b.toLowerCase().replace(/\s+/g," ");var d=b.split(" "),e=new RegExp(d.join(".*"));a.displayedItems=c.getItemsArrays()[a.tabs.activeTab].filter(function(a){return null!==a.label.toLowerCase().match(e)}),a.message.text=""===b?"I'm a welcome message":"No item found to: "+b};a.$watch(function(){return a.tabs.activeTab},function(b){a.displayedItems=c.getItemsArrays()[b],a.tabs[b].title!==a.tabs[0].title&&a.tabs[b].title!==a.tabs[3].title?(a.dropdownOrdering[2].disable=!0,a.dropdownOrdering[3].disable=!0):(a.dropdownOrdering[2].disable=!1,a.dropdownOrdering[3].disable=!1),"undefined"!=typeof a.displayedItems&&"undefined"!=typeof a.search.term&&j(a.search.term)}),a.search={icon:c.options.inputIconSearch,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedItems&&("undefined"==typeof b||""===b?(b="",a.search.icon=c.options.inputIconSearch):a.search.icon=c.options.inputIconClear,j(b))}),a.$watch(function(){return d.getItemsByContainer(c.options.container)},function(b){a.displayedItems=c.buildItemsArray(a.tabs.activeTab,a.tabs,b)},!0),a.$watch(function(){return a.displayedItems.length},function(b){0===b?(a.message.flag=!0,g.addClass("disabled")):(a.message.flag=!1,g.removeClass("disabled"))})}]),angular.module("Pundit2.PageItemsContainer").constant("PAGEITEMSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/PageItemsContainer/ClientPageItemsContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"Page Items",initialActiveTab:0,cMenuType:"pageItems",order:"label",reverse:!1,container:"pageItems",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("PageItemsContainer",["PAGEITEMSCONTAINERDEFAULTS","BaseComponent",function(a,b){var c=new b("PageItemsContainer",a),d=[];return c.buildItemsArray=function(a,b,c){for(var e=0;e<b.length;e++)angular.isObject(b[e])&&"undefined"!=typeof b[e].filterFunction&&(d[e]=c.filter(function(a){return b[e].filterFunction(a)}));return d[a]},c.getItemsArrays=function(){return d},c}]),angular.module("Pundit2.MyNotebooksContainer",[]),angular.module("Pundit2.MyNotebooksContainer").directive("myNotebooksContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/MyNotebooksContainer/MyNotebooksContainer.dir.tmpl.html",controller:"MyNotebooksContainerCtrl"}}),angular.module("Pundit2.MyNotebooksContainer").controller("MyNotebooksContainerCtrl",["$scope","$element","MyNotebooksContainer","NotebookExchange",function(a,b,c,d){var e="pnd-icon-search",f="pnd-icon-times",g=[];a.displayedNotebook=g,a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html";var h=angular.element(b).find(".my-notebooks-btn-order");a.notebookMenuType=c.options.cMenuType,a.message={flag:!0,text:"I'm a welcome message"};var i="label";a.reverse=!1,a.dropdownOrdering=[{text:"Label Asc",click:function(){i="label",a.reverse=!1}},{text:"Label Desc",click:function(){i="label",a.reverse=!0}}];var j=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return j(a.label)};var k=function(b){b=b.toLowerCase().replace(/\s+/g," ");var c=b.split(" "),d=new RegExp(c.join(".*"));a.displayedNotebook=g.filter(function(a){return null!==a.label.toLowerCase().match(d)}),a.message.text=""===b?"I'm a welcome message":"No item found to: "+b};a.search={icon:e,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedNotebook&&("undefined"==typeof b||""===b?(b="",a.search.icon=e):a.search.icon=f,k(b))}),a.$watch(function(){return d.getMyNotebooks()},function(b){g=b,k(a.search.term)},!0),a.$watch(function(){return a.displayedNotebook.length},function(b){0===b?(a.message.flag=!0,h.addClass("disabled")):(a.message.flag=!1,h.removeClass("disabled"))})}]),angular.module("Pundit2.MyNotebooksContainer").constant("MYNOTEBOOKSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/MyNotebooksContainer/ClientMyNotebooksContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"My Notebooks",cMenuType:"myNotebooks",container:"myNotebooks",inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times"}).service("MyNotebooksContainer",["$rootScope","MYNOTEBOOKSCONTAINERDEFAULTS","BaseComponent","NotebookExchange","ItemsExchange","PageItemsContainer","AnnotationsExchange","NotebookCommunication","Consolidation","ContextualMenu","Dashboard","NotebookComposer","AnnotationsCommunication","$modal","$timeout",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=new c("MyNotebooksContainer",b),q=function(){var b=[p.options.cMenuType];j.addAction({name:"setAsPrivate",type:b,label:"Set Notebook as Private",priority:100,showIf:function(a){return"public"===a.visibility},action:function(a){h.setPrivate(a.id)}}),j.addAction({name:"setAsPublic",type:b,label:"Set Notebook as Public",priority:100,showIf:function(a){return"private"===a.visibility},action:function(a){h.setPublic(a.id)}}),j.addAction({name:"setAsCurrent",type:b,label:"Set Notebook as Current",priority:100,showIf:function(a){return!a.isCurrent()},action:function(a){h.setCurrent(a.id)}}),j.addAction({name:"deleteNotebook",type:b,label:"Delete Notebook",priority:100,showIf:function(a){return!a.isCurrent()},action:function(a){t(a)}}),j.addAction({name:"editNotebook",type:b,label:"Edit Notebook",priority:101,showIf:function(){return!0},action:function(b){k.isDashboardVisible()||k.toggle(),a.$emit("pnd-dashboard-show-tab",l.options.clientDashboardTabTitle),l.setNotebookToEdit(b)}})};a.$on("pundit-boot-done",function(){q()});var r=a.$new();r.titleMessage="Delete Notebook",r.confirm=function(){h.deleteNotebook(r.notebook.id).then(function(){r.notifyMessage="Notebook "+r.notebook.label+" correctly deleted.",g.removeAnnotationByNotebookId(r.notebook.id),e.wipeContainer(f.options.container),m.getAnnotations(),o(function(){s.hide()},1e3)},function(){r.notifyMessage="Error impossible to delete this notebook, please retry.",o(function(){s.hide()},1e3)})},r.cancel=function(){s.hide()};var s=n({container:"[data-ng-app='Pundit2']",template:"src/Core/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:r}),t=function(a){r.notifyMessage="Are you sure you want to delete this notebook? will also remove all the annotation contained in it.",r.notebook=a,s.$promise.then(s.show)};return p}]),angular.module("Pundit2.Item",[]),angular.module("Pundit2.Item").directive("item",function(){return{restrict:"E",scope:{uri:"@",menuType:"@"},templateUrl:"src/Item/Item.dir.tmpl.html",controller:"ItemCtrl"}}),angular.module("Pundit2.Item").controller("ItemCtrl",["$scope","ItemsExchange","TypesHelper","Preview","ContextualMenu",function(a,b,c,d,e){a.item=b.getItemByUri(a.uri),a.item.type.length>0&&(a.itemTypeLabel=c.getLabel(a.item.type[0])),a.onItemMouseOver=function(){d.showDashboardPreview(a.item)},a.onItemMouseLeave=function(){d.hideDashboardPreview()},a.isSticky=function(){return d.isStickyItem(a.item)},a.onClickSticky=function(b){return d.isStickyItem(a.item)?d.clearItemDashboardSticky():d.setItemDashboardSticky(a.item),b.preventDefault(),b.stopPropagation(),!1},a.onClickMenu=function(b){return e.show(b.pageX,b.pageY,a.item,a.menuType),b.preventDefault(),b.stopPropagation(),!1}}]),angular.module("Pundit2.Notebook",[]),angular.module("Pundit2.Notebook").directive("notebook",function(){return{restrict:"E",scope:{nid:"@",menuType:"@"},templateUrl:"src/Notebook/Notebook.dir.tmpl.html",controller:"NotebookCtrl"}}),angular.module("Pundit2.Notebook").controller("NotebookCtrl",["$scope","NotebookExchange","Preview","ContextualMenu",function(a,b,c,d){a.notebook=b.getNotebookById(a.nid),a.onItemMouseOver=function(){c.showDashboardPreview(a.notebook)},a.onItemMouseLeave=function(){c.hideDashboardPreview()},a.isSticky=function(){return c.isStickyItem(a.notebook)},a.onClickSticky=function(b){return c.isStickyItem(a.notebook)?c.clearItemDashboardSticky():c.setItemDashboardSticky(a.notebook),b.preventDefault(),b.stopPropagation(),!1},a.onClickMenu=function(b){return d.show(b.pageX,b.pageY,a.notebook,a.menuType),b.preventDefault(),b.stopPropagation(),!1}}]),angular.module("Pundit2.MyItemsContainer",[]),angular.module("Pundit2.MyItemsContainer").directive("myItemsContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/MyItemsContainer/MyItemsContainer.dir.tmpl.html",controller:"MyItemsContainerCtrl"}}),angular.module("Pundit2.MyItemsContainer").controller("MyItemsContainerCtrl",["$scope","$rootScope","$modal","$timeout","$element","MyItemsContainer","ItemsExchange","MyItems","MyPundit","Preview","TypesHelper",function(a,b,c,d,e,f,g,h,i,j,k){a.itemMenuType=f.options.cMenuType,a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html";var l=angular.element(e).find(".my-items-btn-delete"),m=angular.element(e).find(".my-items-btn-order");a.message={flag:!0,text:"I'm a welcome message"};var n=f.options.order;a.reverse=f.options.reverse,a.tabs=[{title:"All Items",template:"src/Lists/itemList.tmpl.html",filterFunction:function(){return!0}},{title:"Text",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isTextFragment()}},{title:"Images",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isImage()||a.isImageFragment()}},{title:"Entities",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isEntity()}},{title:"Pages",template:"src/Lists/itemList.tmpl.html",filterFunction:function(a){return a.isWebPage()}}],a.tabs.activeTab=f.options.initialActiveTab,a.dropdownOrdering=[{text:"Label Asc",click:function(){n="label",a.reverse=!1}},{text:"Label Desc",click:function(){n="label",a.reverse=!0}},{text:"Type Asc",click:function(){a.dropdownOrdering[2].disable||(n="type",a.reverse=!1)}},{text:"Type Desc",click:function(){a.dropdownOrdering[3].disable||(n="type",a.reverse=!0)}}];var o=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===n?o(a.label):"type"===n?o(k.getLabel(a.type[0])):void 0},a.onClickDeleteAllMyItems=function(){s()},a.$watch(function(){return a.tabs.activeTab},function(b){a.displayedItems=f.getItemsArrays()[b],a.tabs[b].title!==a.tabs[0].title&&a.tabs[b].title!==a.tabs[3].title?(a.dropdownOrdering[2].disable=!0,a.dropdownOrdering[3].disable=!0):(a.dropdownOrdering[2].disable=!1,a.dropdownOrdering[3].disable=!1),"undefined"!=typeof a.displayedItems&&"undefined"!=typeof a.search.term&&p(a.search.term)});var p=function(b){b=b.toLowerCase().replace(/\s+/g," ");var c=b.split(" "),d=new RegExp(c.join(".*"));a.displayedItems=f.getItemsArrays()[a.tabs.activeTab].filter(function(a){return null!==a.label.toLowerCase().match(d)}),a.message.text=""===b?"I'm a welcome message":"No item found to: "+b};a.search={icon:f.options.inputIconSearch,term:""},a.$watch(function(){return a.search.term},function(b){"undefined"!=typeof a.displayedItems&&("undefined"==typeof b||""===b?(b="",a.search.icon=f.options.inputIconSearch):a.search.icon=f.options.inputIconClear,p(b))}),a.$watch(function(){return g.getItemsByContainer(h.options.container)},function(b){a.displayedItems=f.buildItemsArray(a.tabs.activeTab,a.tabs,b)},!0),a.$watch(function(){return a.displayedItems.length},function(b){0===b?(a.message.flag=!0,l.addClass("disabled"),m.addClass("disabled")):(a.message.flag=!1,l.removeClass("disabled"),m.removeClass("disabled"))});var q=b.$new();q.titleMessage="Delete All My Items",q.confirm=function(){i.isUserLogged()&&h.deleteAllItems().then(function(){q.notifyMessage="Success, my items correctly deleted."},function(){q.notifyMessage="Error impossible to delete my items, please retry."}),d(function(){r.hide()},1e3)},q.cancel=function(){r.hide()};var r=c({container:"[data-ng-app='Pundit2']",template:"src/Core/confirm.modal.tmpl.html",show:!1,backdrop:"static",scope:q}),s=function(){q.notifyMessage="Are you sure you want to delete all my items? After you can no longer recover.",r.$promise.then(r.show)}}]),angular.module("Pundit2.MyItemsContainer").constant("MYITEMSCONTAINERDEFAULTS",{clientDashboardTemplate:"src/Lists/MyItemsContainer/ClientMyItemsContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"My Items",initialActiveTab:0,cMenuType:"myItems",order:"label",reverse:!1,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("MyItemsContainer",["MYITEMSCONTAINERDEFAULTS","BaseComponent",function(a,b){var c=new b("MyItemsContainer",a),d=[];return c.buildItemsArray=function(a,b,c){for(var e=0;e<b.length;e++)angular.isObject(b[e])&&"undefined"!=typeof b[e].filterFunction&&(d[e]=c.filter(function(a){return b[e].filterFunction(a)}));return d[a]},c.getItemsArrays=function(){return d},c}]),angular.module("Pundit2.MyItemsContainer").constant("MYITEMSDEFAULTS",{apiPreferencesKey:"favorites",container:"myItems",debug:!1}).service("MyItems",["MYITEMSDEFAULTS","BaseComponent","NameSpace","Item","ItemsExchange","ContextualMenu","MyPundit","Config","Consolidation","Toolbar","$http","$rootScope","$q",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=new b("MyItems",a),o=function(){var a=[h.modules.TextFragmentHandler.cMenuType,h.modules.PageItemsContainer.cMenuType,h.modules.MyItemsContainer.cMenuType,h.modules.TextFragmentAnnotator.cMenuType,h.modules.SelectorsManager.cMenuType];f.addDivider({priority:99,type:a}),f.addAction({name:"addToMyItems",type:a,label:"Add to My Items",priority:100,showIf:function(a){return g.isUserLogged()&&!e.isItemInContainer(a,n.options.container)},action:function(a){return n.addItem(a).then(function(){i.consolidateAll()}),!0}}),f.addAction({name:"removeFromMyItems",type:a,label:"Remove from My Items",priority:100,showIf:function(a){return g.isUserLogged()&&e.isItemInContainer(a,n.options.container)},action:function(a){return n.deleteItem(a).then(function(){i.consolidateAll()}),!0}})};return l.$on("pundit-boot-done",function(){o()}),n.getAllItems=function(){var a;k({headers:{Accept:"application/json"},method:"GET",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0}).success(function(b){var c=0;if("undefined"==typeof b)return void n.log("Undefined Server response");if("undefined"!=typeof b.redirectTo)return void n.log("Get all my items on server produce a redirect response to: ",b);for(var f in b.value)c++,b.value[f].rdftype&&(delete b.value[f].type,delete b.value[f].rdfData,delete b.value[f].favorite,b.value[f].type=b.value[f].rdftype,delete b.value[f].rdftype,b.value[f].uri=b.value[f].value,delete b.value[f].value),a=new d(b.value[f].uri,b.value[f]),e.addItemToContainer(a,n.options.container);n.log("Retrieved my items from the server: "+c+" items")}).error(function(a){n.log("Http error while retrieving my items from the server: ",a)})},n.deleteAllItems=function(){var a=new Date,b=m.defer();return j.setLoading(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:[],created:a.getTime()})}).success(function(a){return j.setLoading(!1),"undefined"!=typeof a.redirectTo?void n.log("Deleted all my items on server produce a redirect response to: ",a):(e.wipeContainer(n.options.container),b.resolve(),i.consolidateAll(),void n.log("Deleted all my items on server",a))}).error(function(a){j.setLoading(!1),n.err("Cant delete my items on server: ",a),b.reject()}),b.promise},n.deleteItem=function(a){var b=new Date,d=e.getItemsByContainer(n.options.container),f=d.indexOf(a),g=angular.copy(d),h=m.defer();return g.splice(f,1),j.setLoading(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:g,created:b.getTime()})}).success(function(b){return"undefined"!=typeof b.redirectTo?void n.log("Deleted single my item on server produce a redirect response to: ",b):(e.removeItemFromContainer(a,n.options.container),h.resolve(),j.setLoading(!1),void n.log("Deleted from my item: "+a.label))}).error(function(a){h.reject(),j.setLoading(!1),n.err("Cant delete a my item on the server: ",a)}),h.promise},n.addItem=function(a){var b=new Date,d=angular.copy(e.getItemsByContainer(n.options.container)),f=m.defer();return d.push(a),j.setLoading(!0),k({headers:{"Content-Type":"application/json;charset=UTF-8;"},method:"POST",url:c.get("asPref",{key:n.options.apiPreferencesKey}),withCredentials:!0,data:angular.toJson({value:d,created:b.getTime()})}).success(function(b){return"undefined"!=typeof b.redirectTo?void n.log("Add single item to my items on server produce a redirect response to: ",b):(e.addItemToContainer(a,n.options.container),f.resolve(),j.setLoading(!1),void n.log("Added item to my items: "+a.label))}).error(function(a){f.reject(),j.setLoading(!1),n.err("Cant add item to my items on the server: ",a)}),f.promise},n}]),angular.module("Pundit2.Vocabularies",[]),angular.module("Pundit2.Vocabularies").constant("FREEBASESELECTORDEFAULTS",{freebaseSearchURL:"https://www.googleapis.com/freebase/v1/search",freebaseSchemaBaseURL:"http://www.freebase.com/schema",freebaseImagesBaseURL:"https://usercontent.googleapis.com/freebase/v1/image",freebaseTopicURL:"https://www.googleapis.com/freebase/v1/topic",freebaseMQLReadURL:"https://www.googleapis.com/freebase/v1/mqlread",freebaseItemsBaseURL:"http://www.freebase.com",freebaseAPIKey:"AIzaSyCJjAj7Nd2wKsZ8d7XQ9ZvUwN5SF0tZBsE",active:!0,limit:15,instances:[{container:"freebase",label:"Freebase",active:!0}],debug:!1}).factory("FreebaseSelector",["BaseComponent","FREEBASESELECTORDEFAULTS","TypesHelper","SelectorsManager","Item","ItemsExchange","$http","$q",function(a,b,c,d,e,f,g,h){var i=new a("FreebaseSelector",b);i.name="FreebaseSelector",i.options.active&&d.addSelector(i);var j=function(a){this.config=a};return j.prototype.getItems=function(a){var b=this,c=h.defer();return g({method:"GET",url:i.options.freebaseSearchURL,params:{key:i.options.freebaseAPIKey,query:a,limit:i.options.limit}}).success(function(a){if(i.log("Http success, get items from freebase",a),0===a.result.length)return i.log("Http success, but get empty result"),f.wipeContainer(b.config.container),void c.resolve();var d=[],g=[],j=[];for(var k in a.result){var l={label:a.result[k].name,mid:a.result[k].mid,image:i.options.freebaseImagesBaseURL+a.result[k].mid,description:-1,uri:-1};j.push(l);var m=h.defer();d.push(m.promise),g.push(m)}for(h.all(d).then(function(){for(i.log("Completed all items http request (topic and mql)"),f.wipeContainer(b.config.container),k=0;k<j.length;k++)f.addItemToContainer(new e(j[k].uri,j[k]),b.config.container);c.resolve()}),k=0;k<j.length;k++)b.getItemDetails(j[k],g[k])}).error(function(a){i.err("Cant get items from freebase: ",a),c.resolve()}),c.promise},j.prototype.getItemDetails=function(a,b){var d=0;g({method:"GET",url:i.options.freebaseMQLReadURL,params:{key:i.options.freebaseAPIKey,query:{id:null,mid:a.mid,type:[{}]}}}).success(function(d){a.uri=i.options.freebaseItemsBaseURL+d.result.mid,a.type=[],i.log("Http success, get MQL from freebase"+a.uri);for(var e=d.result.type.length;e--;){var f=d.result.type[e],g=i.options.freebaseSchemaBaseURL+f.id;a.type.push(g),c.add(g,f.name)}-1!==a.description&&(i.log("MQL was last, complete for item "+a.uri),delete a.mid,b.resolve())}).error(function(c){i.err("Cant get MQL from freebase: ",c),(-1!==a.description||d>0)&&b.resolve(),d++}),g({method:"GET",url:i.options.freebaseTopicURL+a.mid,params:{key:i.options.freebaseAPIKey,filter:"/common/topic/description"}}).success(function(c){i.log("Http success, get TOPIC from freebase"+a.uri),a.description="undefined"!=typeof c.property&&c.property["/common/topic/description"].values.length>0?c.property["/common/topic/description"].values[0].value:a.label,-1!==a.uri&&(i.log("TOPIC was last, complete http for item "+a.uri),delete a.mid,b.resolve())}).error(function(c){i.err("Cant get TOPIC from freebase: ",c),(-1!==a.uri||d>0)&&b.resolve(),d++})},i.log("Factory init"),j}]),angular.module("Pundit2.Vocabularies").constant("MURUCASELECTORDEFAULTS",{murucaReconURL:"http://demo2.galassiaariosto.netseven.it/backend.php/reconcile",queryProperties:{},active:!0,limit:5,instances:[{queryType:"http://purl.org/galassiariosto/types/Azione",container:"muruca",label:"Muruca",active:!0}],debug:!1}).factory("MurucaSelector",["BaseComponent","MURUCASELECTORDEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("MurucaSelector",b);h.name="MurucaSelector",h.options.active&&e.addSelector(h);
var i=function(a){this.config=a};return i.prototype.getItems=function(a){var b=this,c=g.defer(),e={params:{query:{query:a,type:b.config.queryType,properties:h.options.queryProperties,limit:h.options.limit}}};return f.jsonp(h.options.murucaReconURL+"?jsonp=JSON_CALLBACK",e).success(function(a){h.log("Http success, get items from muruca "+b.config.label,a),d.wipeContainer(b.config.container),0===a.result.length?(h.log("Empty Response"),c.resolve()):b.getItemsDetails(a.result,c)}),c.promise},i.prototype.getItemsDetails=function(a,b){for(var e=this,f=0;f<a.length;f++){var g=a[f],i={label:g.name,uri:g.resource_url,type:[]};if(h.log("Loading metadata for item "+i.uri),"description"in g&&(i.description=g.description),"type"in g&&"length"in g.type)for(var j=g.type.length;j--;)"string"==typeof g.type[j]?i.type.push(g.type[j]):h.log("ERROR: Weird type is weird? "+typeof g.type[j]+": "+g.type[j]);var k=new c(i.uri,i);d.addItemToContainer(k,e.config.container)}b.resolve(),h.log("Complete items parsing")},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("KORBOBASKETSELECTORDEFAULTS",{korboBasketReconURL:"http://manager.korbo.org/api.php/basket/reconcile/",korboBasketMetadataURL:"http://manager.korbo.org/",korboItemsBaseURL:"http://purl.org/net7/korbo",korboSchemaBaseURL:"http://purl.org/net7/korbo/type/",baskets:[16],active:!0,limit:15,instances:[{container:"korboBasket",label:"KorboBasket",active:!0}],debug:!1}).factory("KorboBasketSelector",["BaseComponent","KORBOBASKETSELECTORDEFAULTS","Item","ItemsExchange","SelectorsManager","$http","$q",function(a,b,c,d,e,f,g){var h=new a("KorboBasketSelector",b);h.name="KorboBasketSelector",h.options.active&&e.addSelector(h);var i=function(a){this.config=a};return i.prototype.getItems=function(a){var b=this,e=g.defer(),i={params:{query:{query:a,limit:h.options.limit}},withCredentials:!0};return f.jsonp(h.options.korboBasketReconURL+h.options.baskets[0]+"?jsonp=JSON_CALLBACK",i).success(function(a){if(h.log("Http success, get items "+b.config.label,a),0===a.result.length)return h.log("Http success, but empty response"),d.wipeContainer(b.config.container),void e.resolve();for(var f=[],i=[],j=[],k=0;k<a.result.length;k++){var l=a.result[k],m={label:l.name,uri:l.resource_url,type:[]};j.push(m);var n=g.defer();f.push(n.promise),i.push(n)}for(g.all(f).then(function(){for(h.log("Completed all items http request"),d.wipeContainer(b.config.container),k=0;k<j.length;k++)d.addItemToContainer(new c(j[k].uri,j[k]),b.config.container);e.resolve()}),k=0;k<a.result.length;k++)b.getItemDetails(j[k],i[k])}),e.promise},i.prototype.getItemDetails=function(a,b){h.log("Loading metadata for item "+a.uri);var c={params:{url:a.uri},withCredentials:!0};f.jsonp(h.options.korboBasketMetadataURL+h.options.baskets[0]+"?jsonp=JSON_CALLBACK",c).success(function(c){h.log("Http item details success, get item",c);var d=c.result;if("image"in d&&(a.image=d.image),"description"in d&&(a.description=d.description),"rdftype"in d&&"length"in d.rdftype)for(var e=d.rdftype.length;e--;)"string"==typeof d.rdftype[e]?a.type.push(d.rdftype[e]):h.log("ERROR: Weird type is weird? "+typeof d.rdftype[e]+": "+d.rdftype[e]);b.resolve()})},h.log("Factory init"),i}]),angular.module("Pundit2.Vocabularies").constant("SELECTORMANAGERDEFAULTS",{clientDashboardTemplate:"src/Lists/Vocabularies/VocabulariesContainer/ClientVocabulariesContainer.tmpl.html",clientDashboardPanel:"lists",clientDashboardTabTitle:"Vocab",cMenuType:"vocabItems",debug:!1,order:"label",reverse:!1,initialActiveTab:0,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times"}).service("SelectorsManager",["BaseComponent","SELECTORMANAGERDEFAULTS","$injector","$q",function(a,b,c,d){var e=new a("SelectorsManager",b),f={},g=[];return e.getItems=function(a){var b=d.defer(),c=g.length;for(var e in g)g[e].getItems(a).then(function(){c--,0>=c&&null!==b&&(b.resolve(),b=null)});return b.promise},e.init=function(){g=[];for(var a in f){var b=c.get(f[a].name);for(var d in f[a].options.instances){var h=new b(f[a].options.instances[d]);g.push(h)}}e.log("Init, add selectors instances",g)},e.addSelector=function(a){f[a.name]=a,e.log("Add selector ",a.name)},e.getActiveSelectors=function(){return g},e}]),angular.module("Pundit2.Vocabularies").directive("vocabulariesContainer",function(){return{restrict:"E",scope:{},templateUrl:"src/Lists/Vocabularies/VocabulariesContainer/VocabulariesContainer.dir.tmpl.html",controller:"VocabulariesContainerCtrl"}}),angular.module("Pundit2.Vocabularies").controller("VocabulariesContainerCtrl",["$scope","$timeout","$injector","$element","BaseComponent","SelectorsManager","ItemsExchange","TypesHelper",function(a,b,c,d,e,f,g,h){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html";var i=angular.element(d).find(".vocab-items-btn-order");a.message={flag:!0,text:"I'm a welcome message"},a.itemMenuType=f.options.cMenuType;var j=f.options.order;a.reverse=f.options.reverse,a.tabs=[];var k=f.getActiveSelectors();for(var l in k)a.tabs.push({title:k[l].config.label,template:"src/Lists/itemList.tmpl.html",itemsContainer:k[l].config.container});a.tabs.activeTab=f.options.initialActiveTab,a.dropdownOrdering=[{text:"Label Asc",click:function(){j="label",a.reverse=!1}},{text:"Label Desc",click:function(){j="label",a.reverse=!0}},{text:"Type Asc",click:function(){j="type",a.reverse=!1}},{text:"Type Desc",click:function(){j="type",a.reverse=!0}}];var m=function(a){return a.replace(/ /g,"")};a.getOrderProperty=function(a){return"label"===j?m(a.label):"type"===j?m(h.getLabel(a.type[0])):void 0},a.search={icon:f.options.inputIconSearch,term:""};var n;a.$watch(function(){return a.search.term},function(c){return"undefined"==typeof c||""===c?(c="",a.search.icon=f.options.inputIconSearch,void b.cancel(n)):(a.search.icon=f.options.inputIconClear,b.cancel(n),void(n=b(function(){p()},500)))});var o=function(){0===a.displayedItems.length&&""!==a.search.term&&"undefined"!=typeof a.search.term&&(a.message.text="No item found to: "+a.search.term)},p=function(){f.getItems(a.search.term).then(function(){o()},function(){o()})};a.$watch(function(){return g.getItemsByContainer(a.tabs[a.tabs.activeTab].itemsContainer)},function(b){a.displayedItems=b,0===a.displayedItems.length?(a.message.flag=!0,i.addClass("disabled")):(a.message.flag=!1,i.removeClass("disabled"))},!0),a.$watch(function(){return a.tabs.activeTab},function(a,b){a!==b&&o()})}]),angular.module("Pundit2.TripleComposer",[]),angular.module("Pundit2.TripleComposer").directive("tripleComposer",function(){return{restrict:"E",scope:{},templateUrl:"src/Tools/TripleComposer/TripleComposer.dir.tmpl.html",controller:"TripleComposerCtrl"}}),angular.module("Pundit2.TripleComposer").controller("TripleComposerCtrl",["$scope","$http","$timeout","NameSpace","TypesHelper","XpointersHelper","MyPundit","Toolbar","Annotation","Consolidation","TripleComposer","NotebookExchange",function(a,b,c,d,e,f,g,h,i,j,k,l){a.statements=k.getStatements(),a.saving=!1,a.textMessage=k.options.savingMsg;var m="Loading",n="Saved",o="Warning!",p="pnd-icon-refresh pnd-icon-spin",q="pnd-icon-check-circle",r="pnd-icon-exclamation-circle",s="pnd-message",t="pnd-message-success",u="pnd-message-warning";a.shortMessagge=m,a.savingIcon=p,a.shortMessageClass=s,this.removeStatement=function(a){a=parseInt(a,10),k.removeStatement(a),k.isAnnotationComplete()&&angular.element(".pnd-triplecomposer-save").removeClass("disabled")},this.addStatementScope=function(a,b){a=parseInt(a,10),k.addStatementScope(a,b)},this.duplicateStatement=function(a){a=parseInt(a,10),k.duplicateStatement(a)},this.isAnnotationComplete=function(){k.isAnnotationComplete()&&angular.element(".pnd-triplecomposer-save").removeClass("disabled")},a.onClickAddStatement=function(){angular.element(".pnd-triplecomposer-save").addClass("disabled"),k.addStatement()};var v,w,x=function(b,d,e){a.textMessage=b,e?(a.shortMessagge=o,a.savingIcon=r,a.shortMessageClass=u):(a.shortMessagge=n,a.savingIcon=q,a.shortMessageClass=t),c(function(){a.saving=!1,h.setLoading(!1)},d)};a.saveAnnotation=function(){g.login().then(function(e){if(e){var g=a.statements.some(function(a){var b=a.scope.get();return null===b.subject||null===b.predicate||null===b.object?!0:void 0});if(g)return void console.log("Try to save incomplete statement");angular.element(".pnd-triplecomposer-save").addClass("disabled"),a.textMessage=k.options.savingMsg,a.shortMessagge=m,a.savingIcon=p,a.shortMessageClass=s,w=!1,v=c(function(){w=!0},k.options.savingMsgTime),a.saving=!0,h.setLoading(!0),b({headers:{"Content-Type":"application/json"},method:"POST",url:d.get("asNBCurrent"),params:{context:angular.toJson({targets:k.buildTargets(),pageContext:f.getSafePageContext()})},withCredentials:!0,data:{graph:k.buildGraph(),items:k.buildItems()}}).success(function(b){a.statements=k.reset(),w?x(k.options.notificationSuccessMsg,k.options.notificationMsgTime,!1):v.then(function(){x(k.options.notificationSuccessMsg,k.options.notificationMsgTime,!1)}),new i(b.AnnotationID).then(function(){l.getCurrentNotebooks().addAnnotation(b.AnnotationID),j.consolidateAll()})}).error(function(a){console.log(a),w?x(k.options.notificationErrorMsg,k.options.notificationMsgTime,!0):v.then(function(){x(k.options.notificationErrorMsg,k.options.notificationMsgTime,!0)})})}})}}]),angular.module("Pundit2.TripleComposer").constant("TRIPLECOMPOSERDEFAULTS",{clientDashboardTemplate:"src/Tools/TripleComposer/ClientTripleComposer.tmpl.html",clientDashboardPanel:"tools",clientDashboardTabTitle:"Statements Composer",savingMsg:"We are saving your annotation",savingMsgTime:1250,notificationSuccessMsg:"Your annotation has been saved successfully",notificationErrorMsg:"We were unable to save your annotation",notificationMsgTime:1500,inputIconSearch:"pnd-icon-search",inputIconClear:"pnd-icon-times",debug:!1}).service("TripleComposer",["BaseComponent","TRIPLECOMPOSERDEFAULTS","TypesHelper","NameSpace",function(a,b,c,d){var e=new a("TripleComposer",b),f=1,g=[{id:f}];return e.getStatements=function(){return g},e.addStatement=function(){f+=1,g.push({id:f})},e.removeStatement=function(a){if(1===g.length)return void g[0].scope.wipe();var b=-1;g.some(function(c,d){return c.id===a?(b=d,!0):void 0}),b>-1&&g.splice(b,1)},e.reset=function(){return f=1,g=[{id:f}]},e.addStatementScope=function(a,b){var c=-1;g.some(function(b,d){return b.id===a?(c=d,!0):void 0}),c>-1&&(g[c].scope=b)},e.duplicateStatement=function(a){var b=-1;g.some(function(c,d){return c.id===a?(b=d,!0):void 0}),b>-1&&(f+=1,g.push({id:f,scope:{duplicated:g[b].scope.copy()}}))},e.addToSubject=function(a){1===g.length&&g[0].scope.setSubject(a)},e.isAnnotationComplete=function(){var a=!0;return g.some(function(b){return b.scope.isStatementComplete()?void 0:(a=!1,!0)}),a},e.buildItems=function(){var a={};return g.forEach(function(b){var e=b.scope.get();a[e.subject.uri]=e.subject.toRdf(),a[e.predicate.uri]=e.predicate.toRdf(),"undefined"!=typeof e.object.uri&&(a[e.object.uri]=e.object.toRdf(),e.object.type.forEach(function(b,f){var g=e.object.type[f];a[g]={},a[g][d.rdfs.label]=[{type:"literal",value:c.getLabel(b)}]})),e.subject.type.forEach(function(b,f){var g=e.subject.type[f];a[g]={},a[g][d.rdfs.label]=[{type:"literal",value:c.getLabel(b)}]}),e.predicate.type.forEach(function(b,f){var g=e.predicate.type[f];a[g]={},a[g][d.rdfs.label]=[{type:"literal",value:c.getLabel(b)}]})}),a},e.buildObject=function(a){return"string"==typeof a?{type:"literal",value:a}:{type:"uri",value:a.uri}},e.buildTargets=function(){var a=[];return g.forEach(function(b){var c=b.scope.get();(c.subject.isTextFragment()||c.subject.isImage()||c.subject.isImageFragment())&&-1===a.indexOf(c.subject.uri)&&a.push(c.subject.uri),(c.predicate.isTextFragment()||c.predicate.isImage()||c.predicate.isImageFragment())&&-1===a.indexOf(c.predicate.uri)&&a.push(c.predicate.uri),"string"!=typeof c.object&&(c.object.isTextFragment()||c.object.isImage()||c.object.isImageFragment())&&-1===a.indexOf(c.object.uri)&&a.push(c.object.uri)}),a},e.buildGraph=function(){var a={};return g.forEach(function(b){var c=b.scope.get();if("undefined"==typeof a[c.subject.uri])a[c.subject.uri]={},a[c.subject.uri][c.predicate.uri]=[e.buildObject(c.object)];else if("undefined"==typeof a[c.subject.uri][c.predicate.uri])a[c.subject.uri][c.predicate.uri]=[e.buildObject(c.object)];else{var d=c.object.uri,f=a[c.subject.uri][c.predicate.uri],g=f.some(function(a){return angular.equals(a.value,d)});g||f.push(e.buildObject(c.object))}}),a},e}]),angular.module("Pundit2.TripleComposer").directive("statement",function(){return{restrict:"E",scope:{id:"@",duplicated:"="},templateUrl:"src/Tools/TripleComposer/Statement.dir.tmpl.html",controller:"StatementCtrl",require:"^tripleComposer",link:function(a,b,c,d){a.tripleComposerCtrl=d,a.$watch("duplicated",function(b){"undefined"!=typeof b&&a.init()}),d.addStatementScope(a.id,a)}}}),angular.module("Pundit2.TripleComposer").controller("StatementCtrl",["$scope","$element","TypesHelper","ResourcePanel","NameSpace","TripleComposer",function(a,b,c,d,e,f){a.subjectLabel="",a.subjectTypeLabel="",a.subjectFound=!1,a.subjectSearch="",a.subjectIcon=f.options.inputIconSearch,a.predicateLabel="",a.predicateFound=!1,a.predicateSearch="",a.predicateIcon=f.options.inputIconSearch,a.objectLabel="",a.objectTypeLabel="",a.objectFound=!1,a.objectSearch="",a.objectIcon=f.options.inputIconSearch,a.objectLiteral=!1,a.canBeObjectDate=!0,a.canBeObjectLiteral=!0;var g={subject:null,predicate:null,object:null},h=function(){var a=[];return a.push(null!==g.subject?g.subject.uri:""),a.push(null!==g.predicate?g.predicate.uri:""),a.push(null!==g.object?g.object.uri:""),a};a.isStatementComplete=function(){return null!==g.subject&&null!==g.predicate&&null!==g.object?!0:!1},a.remove=function(){d.hide(),a.tripleComposerCtrl.removeStatement(a.id)},a.duplicate=function(){d.hide(),a.tripleComposerCtrl.duplicateStatement(a.id)},a.copy=function(){var b=angular.copy(g);return a.objectDate&&(b.isDate=!0),a.objectLiteral&&(b.isLiteral=!0),b},a.get=function(){return g},a.init=function(){g=a.duplicated,delete a.duplicated,null!==g.subject&&(a.subjectLabel=g.subject.label,a.subjectTypeLabel=c.getLabel(g.subject.type[0]),a.subjectFound=!0),null!==g.predicate&&(a.predicateLabel=g.predicate.label,a.predicateFound=!0),null!==g.object&&("string"==typeof g.object?(a.objectLabel=g.object,g.isDate&&(a.objectTypeLabel=c.getLabel(e.dateTime)),g.isLiteral&&(a.objectTypeLabel=c.getLabel(e.rdfs.literal))):(a.objectLabel=g.object.label,a.objectTypeLabel=c.getLabel(g.object.type[0])),a.objectFound=!0)},a.wipe=function(){a.wipeSubject(),a.wipePredicate(),a.wipeObject()},a.wipeSubject=function(){a.subjectLabel="",a.subjectTypeLabel="",a.subjectFound=!1,a.subjectSearch="",a.subjectIcon=f.options.inputIconSearch,g.subject=null,d.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled")},a.clearSubjectSearch=function(){""!==a.subjectSearch&&"undefined"!=typeof a.subjectSearch&&(a.subjectSearch="",d.showItemsForSubject(h(),void 0,a.subjectSearch).then(setSubject))},a.wipePredicate=function(){a.predicateLabel="",a.predicateFound=!1,a.predicateSearch="",a.predicateIcon=f.options.inputIconSearch,a.canBeObjectDate=!0,a.canBeObjectLiteral=!0,g.predicate=null,d.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled")},a.clearPredicateSearch=function(){""!==a.predicateSearch&&"undefined"!=typeof a.predicateSearch&&(a.predicateSearch="",d.showProperties(h(),void 0,a.predicateSearch).then(i))},a.wipeObject=function(){a.objectLabel="",a.objectTypeLabel="",a.objectFound=!1,a.objectSearch="",a.objectIcon=f.options.inputIconSearch,a.objectLiteral=!1,a.objectDate=!1,g.object=null,d.hide(),angular.element(".pnd-triplecomposer-save").addClass("disabled")},a.clearObjectSearch=function(){""!==a.objectSearch&&"undefined"!=typeof a.objectSearch&&(a.objectSearch="",d.showItemsForObject(h(),void 0,a.objectSearch).then(j))},a.$watch(function(){return a.subjectSearch},function(b){a.subjectIcon="undefined"==typeof b||""===b?f.options.inputIconSearch:f.options.inputIconClear}),a.$watch(function(){return a.predicateSearch},function(b){a.predicateIcon="undefined"==typeof b||""===b?f.options.inputIconSearch:f.options.inputIconClear}),a.$watch(function(){return a.objectSearch},function(b){a.objectIcon="undefined"==typeof b||""===b?f.options.inputIconSearch:f.options.inputIconClear}),a.setSubject=function(b){a.subjectLabel=b.label,a.subjectTypeLabel=c.getLabel(b.type[0]),a.subjectFound=!0,g.subject=b,a.tripleComposerCtrl.isAnnotationComplete()},a.onClickSubject=function(b){d.showItemsForSubject(h(),b.target,a.subjectSearch).then(a.setSubject)},a.onKeyUpSubject=function(b){d.showItemsForSubject(h(),b.target,a.subjectSearch).then(a.setSubject)};var i=function(b){a.predicateLabel=b.label,a.predicateFound=!0,g.predicate=b,-1===b.range.indexOf(e.rdfs.literal)&&(a.canBeObjectLiteral=!1),-1===b.range.indexOf(e.dateTime)&&(a.canBeObjectDate=!1),a.tripleComposerCtrl.isAnnotationComplete()};a.onClickPredicate=function(b){d.showProperties(h(),b.target,a.predicateSearch).then(i)},a.onKeyUpPredicate=function(b){d.showProperties(h(),b.target,a.predicateSearch).then(i)};var j=function(b){a.objectFound=!0,g.object=b,"string"==typeof b?(a.objectLabel=b,a.objectTypeLabel=c.getLabel(e.rdfs.literal),a.objectLiteral=!0):b instanceof Date?(g.object=b.toString(),a.objectLabel=g.object,a.objectTypeLabel=c.getLabel(e.dateTime),a.objectDate=!0):(a.objectLabel=b.label,a.objectTypeLabel=c.getLabel(b.type[0])),a.tripleComposerCtrl.isAnnotationComplete()};a.onClickObject=function(b){d.showItemsForObject(h(),b.target,a.objectSearch).then(j)},a.onKeyUpObject=function(b){d.showItemsForObject(h(),b.target,a.objectSearch).then(j)},a.onClickObjectCalendar=function(b){d.showPopoverCalendar(void 0,b.target).then(function(b){g.object=b.toString(),a.objectLabel=g.object,a.objectTypeLabel=c.getLabel(e.dateTime),a.objectDate=!0,a.objectFound=!0,a.tripleComposerCtrl.isAnnotationComplete()})},a.onClickObjectLiteral=function(b){d.showPopoverLiteral("",b.target).then(function(b){a.objectFound=!0,a.objectLabel=b,a.objectTypeLabel=c.getLabel(e.rdfs.literal),a.objectLiteral=!0,g.object=b,a.tripleComposerCtrl.isAnnotationComplete()})}}]),angular.module("Pundit2.Toolbar",[]),angular.module("Pundit2.Toolbar").config(["$dropdownProvider",function(a){angular.extend(a.defaults,{trigger:"click",html:!0})}]).directive("toolbar",["Toolbar",function(a){return{restrict:"E",scope:{},templateUrl:"src/Toolbar/Toolbar.dir.tmpl.html",link:function(){angular.element("body").addClass(a.options.bodyClass),a.log("Adding "+a.options.bodyClass+" to body element")}}}]),angular.module("Pundit2.Toolbar").controller("ToolbarCtrl",["$scope","Toolbar","MyPundit","Dashboard","AnnotationSidebar","ResourcePanel","ItemsExchange","MyNotebooksContainer","NotebookExchange",function(a,b,c,d,e,f,g,h,i){a.dropdownTemplate="src/ContextualMenu/dropdown.tmpl.html",a.dropdownTemplateMyNotebook="src/Toolbar/myNotebooksDropdown.tmpl.html";var j=function(){f.hide(),c.login()},k=function(){f.hide(),c.logout()};a.errorMessageDropdown=b.getErrorMessageDropdown(),a.userNotLoggedDropdown=[{text:"Please sign in to use Pundit",header:!0},{text:"Sign in",click:j}],a.userLoggedInDropdown=[{text:"Log out",click:k}],a.userTemplateDropdown=[{text:"My template 1",href:"#"},{text:"My template 2",href:"#"},{text:"My template 3",href:"#"}];var l,m;a.$watch(function(){return i.getMyNotebooks()},function(a){l=a},!0),a.$watch(function(){return i.getCurrentNotebooks()},function(a){m=a},!0),a.userData={},a.userNotebooksDropdown=[{text:"Please select notebook you want to use",header:!0}],a.showMyNotebooks=function(){for(var b=l,c=1,d=0;d<b.length;d++)a.userNotebooksDropdown[c]={text:b[d].label,currentNotebook:b[d].id===m.id,visibility:b[d].visibility,click:function(a){return function(){i.setCurrentNotebooks(b[a].id)}}(d)},c++},a.$watch(function(){return c.isUserLogged()},function(b){a.isUserLogged=b,a.userData=c.getUserData()}),a.showStatusButtonOk=function(){return!b.getErrorShown()&&!b.isLoading()},a.showStatusButtonError=function(){return b.getErrorShown()},a.showStatusButtonLoading=function(){return b.isLoading()&&!b.getErrorShown()},a.showLogin=function(){return a.isUserLogged===!1},a.showUserButton=function(){return a.isUserLogged===!0},a.isDashboardActive=function(){return a.isUserLogged===!0},a.isAskActive=function(){return a.isUserLogged===!0},a.isTemplateModeActive=function(){return!1},a.isTemplateMenuActive=function(){return!1},a.isNotebookMenuActive=function(){return a.isUserLogged===!0},a.getAskLink=function(){return b.getAskLink()},a.dashboardClickHandler=function(){f.hide(),d.toggle()},a.annotationsClickHandler=function(){f.hide(),e.toggle()}}]),angular.module("Pundit2.Toolbar").constant("TOOLBARDEFAULTS",{askLinkDefault:"http://demo-cloud.ask.thepund.it/",askLinkUser:"http://demo-cloud.ask.thepund.it/#/myAsk/",bodyClass:"pnd-toolbar-active",clientDomTemplate:"src/Toolbar/ClientToolbar.tmpl.html",debug:!1}).service("Toolbar",["BaseComponent","TOOLBARDEFAULTS","MyPundit",function(a,b,c){var d=new a("Toolbar",b),e=0,f=0,g=!1,h=!1,i=[];return d.getErrorShown=function(){return h},d.isLoading=function(){return g},d.setLoading=function(a){d.log("Setting loading to "+a),a?(f++,g=!0):(f--,0>=f&&(g=!1,f=0))},d.addError=function(a,b){var c=e,f=function(){d.removeError(c),"function"==typeof b&&""!==b&&b()},g={text:a,click:f,id:c};if(e++,i.push(g),h=!0,0===angular.element(".pnd-toolbar-error-button ul").length){var j=angular.element(".pnd-toolbar-error-button a");j.trigger("click")}return c},d.removeError=function(a){for(var b=0;b<i.length;b++)if(i[b].id===a){i.splice(b,1);break}0===i.length&&(h=!1)},d.getErrorMessageDropdown=function(){return i},d.setNotebooks=function(){},d.setTemplates=function(){},d.getAskLink=function(){return c.isUserLogged()?d.options.askLinkUser:d.options.askLinkDefault},d}]),angular.module("Pundit2.Core").controller("LoginModalCtrl",["$scope","MyPundit",function(a,b){var c={};c.loggedOff="To continue with this operation you must log in.",c.waitingForLogIn="Please complete the process in the login window.",c.loggedIn="You are logged in as: ",a.$watch(function(){return b.getLoginStatus()},function(d){if(a.notifyMessage=c[d],b.isUserLogged()){var e=b.getUserData();a.notifyMessage=c[d]+" "+e.fullName}}),a.loginPopUp=function(){b.openLoginPopUp()},a.logout=function(){b.logout()},a.closeModal=function(){b.closeLoginModal()},a.cancelModal=function(){b.cancelLoginModal()},a.isUserLogged=function(){return b.isUserLogged()}}]),angular.module("Pundit2.Preview",[]),angular.module("Pundit2.Preview").directive("preview",function(){return{restrict:"E",scope:{},templateUrl:"src/Preview/DashboardPreview.dir.tmpl.html",controller:"PreviewCtrl"}}),angular.module("Pundit2.Preview").controller("PreviewCtrl",["$scope","Preview","TypesHelper","$window","Toolbar","Notebook",function(a,b,c,d,e){a.itemDashboardPreview=null,a.$watch(function(){return b.getItemDashboardPreview()},function(b){a.itemDashboardPreview=b,null===b?(a.hasImage=!1,a.itemIsAnImage=!1):"Notebook"===c.getLabel(b.type[0])?(a.hasImage=!1,a.itemIsAnImage=!1):(a.hasImage="undefined"!=typeof b.image,a.itemIsAnImage=a.itemDashboardPreview.isImage()||a.itemDashboardPreview.isImageFragment())}),a.getWelcomeHeaderMessage=function(){return b.getWelcomeHeaderMessage()},a.getWelcomeBodyMessage=function(){return b.getWelcomeBodyMessage()},a.isItemEmpty=function(){return null===a.itemDashboardPreview},a.isNotebook=function(){return null!==a.itemDashboardPreview&&"http://purl.org/pundit/ont/ao#Notebook"===a.itemDashboardPreview.type[0]?!0:!1},a.isStickyItemEmpty=function(){return null===b.getItemDashboardSticky()},a.isStickyItem=function(){return b.isStickyItem()},a.clearSticky=function(){b.clearItemDashboardSticky()},a.getLabelType=function(a){return c.getLabel(a)},a.openUrl=function(a){d.open(a)},a.openNotebookUrl=function(a){var b=e.options.askLinkDefault+"#/myNotebooks/"+a;d.open(b)},a.getItemIcon=function(){return a.isItemEmpty()?void 0:a.itemDashboardPreview.getIcon()},a.getItemClass=function(){return a.isItemEmpty()?void 0:a.itemDashboardPreview.getClass()}}]),angular.module("Pundit2.Preview").constant("PREVIEWDEFAULTS",{welcomeHeaderMessage:"Welcome in Pundit 2",welcomeBodyMessage:"Enjoy it",clientDashboardTemplate:"src/Preview/ClientDashboardPreview.tmpl.html",clientDashboardPanel:"details",clientDashboardTabTitle:"Preview"}).service("Preview",["BaseComponent","PREVIEWDEFAULTS",function(a,b){var c,d=new a("Preview",b);return c={itemDashboardPreview:null,itemDashboardSticky:null,heigthTypesDiv:null,typesHidden:null},d.getWelcomeHeaderMessage=function(){return d.options.welcomeHeaderMessage},d.getWelcomeBodyMessage=function(){return d.options.welcomeBodyMessage},d.showDashboardPreview=function(a){c.itemDashboardPreview=a},d.getItemDashboardPreview=function(){return c.itemDashboardPreview},d.setItemDashboardSticky=function(a){c.itemDashboardSticky=a},d.getItemDashboardSticky=function(){return c.itemDashboardSticky},d.clearItemDashboardSticky=function(){c.itemDashboardSticky=null,c.itemDashboardPreview=null},d.hideDashboardPreview=function(){c.itemDashboardPreview=null===c.itemDashboardSticky?null:c.itemDashboardSticky},d.isStickyItem=function(a){var b;return b="undefined"!=typeof a?a:c.itemDashboardPreview,null!==c.itemDashboardSticky&&null!==b?c.itemDashboardSticky.uri===b.uri:!1},d}]),angular.module("Pundit2.Preview").directive("itemPreview",function(){return{restrict:"E",scope:{uri:"@"},templateUrl:"src/Preview/ItemPreview.dir.tmpl.html",controller:"ItemPreviewCtrl"}}),angular.module("Pundit2.Preview").controller("ItemPreviewCtrl",["$scope","TypesHelper","ItemsExchange","$element","Preview",function(a,b,c,d,e){a.typeHidden=!0,a.getTypeLabel=function(a){return b.getLabel(a)},a.$watch("uri",function(){a.item=c.getItemByUri(a.uri),a.isSticky=null!==e.getItemDashboardSticky()&&e.getItemDashboardSticky().uri===a.uri?!0:!1}),a.$watch(function(){return angular.element(d).find("li.pnd-preview-single-type").css("width")},function(){a.typeHidden=!0;var b;if(a.isSticky)a.typeHiddenPresent=a.prev;else{b=angular.element(d).find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").children("li:not(.pnd-is-sticky)");var c=parseInt(angular.element(d).find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").css("width"),10),e=angular.element(b[0]).outerHeight(!0),g=angular.element("div.pnd-preview-item-types"),h=0;angular.element(".pnd-preview-item-image").length>0?h=parseInt(angular.element(".pnd-preview-item-image").css("padding-top"),10):angular.element(".pnd-preview-item-description").length>0&&(h=parseInt(angular.element(".pnd-preview-item-description").css("padding-top"),10));var i=e+h;g.css({height:i}),a.heigthTypesDiv=i,f(b,c)}}),a.$watch(function(){return angular.element("div.pnd-preview").width()},function(){var a=angular.element(d).find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").children("li"),b=angular.element(d).find("div.pnd-preview-item-types").children("ul.pnd-preview-item-types-ul").width();f(a,b)});var f=function(b,c){a.prev=a.typeHiddenPresent;for(var d,e=0,f=30,g=c-f,h=0;h<b.length;h++){if(d=parseInt(angular.element(b[h]).css("width"),10)+e,d>g)return a.typeHiddenPresent=!0,!0;e=d}return a.typeHiddenPresent=!1,!1};a.showAlltypes=function(){var b=angular.element("div.pnd-preview-item-types"),c=angular.element("div.pnd-preview-item-types").height();c===a.heigthTypesDiv?(a.typeHidden=!1,b.css({height:"auto"})):(a.typeHidden=!0,b.css({height:a.heigthTypesDiv}))}}]),angular.module("Pundit2.Preview").directive("notebookPreview",function(){return{restrict:"E",scope:{id:"@"},templateUrl:"src/Preview/NotebookPreview.dir.tmpl.html",controller:"NotebookPreviewCtrl"}}),angular.module("Pundit2.Preview").controller("NotebookPreviewCtrl",["$scope","NotebookExchange","AnnotationsExchange",function(a,b){a.$watch("id",function(){a.notebook=b.getNotebookById(a.id),a.isCurrent=b.getCurrentNotebooks().id===a.notebook.id?!0:!1})}]),angular.module("Pundit2.ResourcePanel",[]),angular.module("Pundit2.ResourcePanel").constant("RESOURCEPANELDEFAULTS",{vocabSearchTimer:1e3,initialCalendarDate:"1900-1-01"}).service("ResourcePanel",["BaseComponent","RESOURCEPANELDEFAULTS","ItemsExchange","MyItems","PageItemsContainer","Client","NameSpace","SelectorsManager","$filter","$rootScope","$popover","$q","$timeout","Preview",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=new a("ResourcePanel",b),p={};p.popover=null,p.defaultPlacement="bottom",p.resourcePromise=null,o.hide=function(){null!==p.popover&&(p.popoverOptions.scope.vocabObjRes=[],p.popoverOptions.scope.vocabSubRes=[],p.popoverOptions.scope.label="",p.popover.hide(),p.popover.destroy(),p.popover=null)},p.popoverOptions={scope:j.$new()},p.popoverOptions.trigger="manual";var q=function(a,b,c,d){"calendar"===d?(p.popoverOptions.template="src/ResourcePanel/popoverCalendar.tmpl.html",p.popoverOptions.scope.selectedDate="undefined"==typeof a.date||""===a.date?"undefined"==typeof o.options.initialCalendarDate||""===o.options.initialCalendarDate?"":o.options.initialCalendarDate:a.date,p.popoverOptions.scope.save=function(){p.resourcePromise.resolve(new Date(this.selectedDate)),n.hideDashboardPreview(),o.hide()},p.popoverOptions.scope.cancel=function(){n.hideDashboardPreview(),o.hide()}):"literal"===d?(p.popoverOptions.template="src/ResourcePanel/popoverLiteralText.tmpl.html",p.popoverOptions.scope.literalText="undefined"==typeof a.literalText?"":a.literalText,p.popoverOptions.scope.save=function(){p.resourcePromise.resolve(this.literalText),n.hideDashboardPreview(),o.hide()},p.popoverOptions.scope.cancel=function(){n.hideDashboardPreview(),o.hide()}):"resourcePanel"===d&&(p.popoverOptions.template="src/ResourcePanel/popoverResourcePanel.tmpl.html",p.popoverOptions.scope.originalContent=angular.copy(a),p.popoverOptions.scope.type=a.type,p.popoverOptions.scope.pageItems=a.pageItems,p.popoverOptions.scope.myItems=a.myItems,p.popoverOptions.scope.properties=a.properties,""!==a.label&&"undefined"!=typeof a.label?r(a.label):p.popoverOptions.scope.label=a.label,p.popoverOptions.scope.save=function(a){o.hide(),n.hideDashboardPreview(),p.resourcePromise.resolve(a)},p.popoverOptions.scope.cancel=function(){n.hideDashboardPreview(),o.hide()}),p.popoverOptions.placement="undefined"==typeof c||""===c?p.defaultPlacement:c,p.popoverOptions.container="[data-ng-app='Pundit2']";var e=b.getBoundingClientRect().left,f=b.getBoundingClientRect().top,g=angular.element(b).outerHeight(),h=angular.element(b).outerWidth();return angular.element("[data-ng-app='Pundit2']").prepend("<div class='pnd-popover-anchor' style='position: absolute; left: -500px; top: -500px;'><div>"),p.anchor=angular.element(".pnd-popover-anchor"),p.anchor.css({left:e+h/2,top:f+g}),p.popover=k(p.anchor,p.popoverOptions),"calendar"===d&&m(function(){angular.element(p.popover.$element).find(".pnd-input-calendar").triggerHandler("click")},1),p.popover.clickTarget=b,p.popover},r=function(a){p.popoverOptions.scope.label=a,("obj"===p.popoverOptions.scope.type||"sub"===p.popoverOptions.scope.type)&&(p.popoverOptions.scope.myItems=i("filterByLabel")(p.popoverOptions.scope.originalContent.myItems,a),p.popoverOptions.scope.pageItems=i("filterByLabel")(p.popoverOptions.scope.originalContent.pageItems,a)),"pr"===p.popoverOptions.scope.type&&(p.popoverOptions.scope.properties=i("filterByLabel")(p.popoverOptions.scope.originalContent.properties,a))};o.showPopoverLiteral=function(a,b){var c={};return c.literalText=a,null!==p.popover&&p.popover.clickTarget!==b?(o.hide(),p.popover=q(c,b,"","literal"),p.popover.$promise.then(function(){p.popover.show(),angular.element("textarea.pnd-popover-literal-textarea")[0].focus()})):null===p.popover&&(p.popover=q(c,b,"","literal"),p.popover.$promise.then(function(){p.popover.show(),angular.element("textarea.pnd-popover-literal-textarea")[0].focus()})),p.resourcePromise=l.defer(),p.resourcePromise.promise},o.showPopoverCalendar=function(a,b){var c={};
return c.date=a,null===p.popover?(p.popover=q(c,b,"","calendar"),p.popover.$promise.then(function(){p.popover.show(),angular.element("input.pnd-input-calendar")[0].focus()})):null!==p.popover&&p.popover.clickTarget!==b&&(o.hide(),p.popover=q("",b,"","calendar"),p.popover.$promise.then(function(){p.popover.show(),angular.element("input.pnd-input-calendar")[0].focus()})),p.resourcePromise=l.defer(),p.resourcePromise.promise};var s,t=function(a,b,c,d,e,f){var g={};g.type=f,("sub"===f||"obj"===f)&&(g.pageItems=b,g.myItems=c,g.properties=null),"pr"===f&&(g.properties=d,g.pageItems=null,g.myItems=null),g.label=e,null===p.popover?(p.popover=q(g,a,"","resourcePanel"),p.popover.$promise.then(p.popover.show)):null!==p.popover&&p.popover.clickTarget!==a&&(o.hide(),p.popover=q(g,a,"","resourcePanel"),p.popover.$promise.then(p.popover.show))};o.showItemsForSubject=function(a,b,f){"undefined"==typeof b&&(b=p.popover.clickTarget);var g=h.getActiveSelectors();if(p.popoverOptions.scope.selectors=[],angular.forEach(g,function(a){p.popoverOptions.scope.selectors.push(a.config.container)}),null!==p.popover&&p.popover.clickTarget===b&&p.popoverOptions.scope.label!==f)p.popoverOptions.scope.vocabSubStatus="loading",m.cancel(s),r(f),s=m(function(){u(f,g)},o.options.vocabSearchTimer);else{"undefined"!=typeof f&&""!==f&&p.popoverOptions.scope.label!==f&&(p.popoverOptions.scope.vocabSubStatus="loading",m.cancel(s),s=m(function(){u(f,g)},o.options.vocabSearchTimer));var i,j,k=d.options.container,n=e.options.container;if("undefined"!=typeof a){var q=a[1];if("undefined"==typeof q||""===q)i=c.getItemsByContainer(k),j=c.getItemsByContainer(n);else{var v=c.getItemByUri(q);if("undefined"==typeof v||"undefined"==typeof v.domain||0===v.domain.length||""===v.domain[0])i=c.getItemsByContainer(k),j=c.getItemsByContainer(n);else{var w=v.domain,x=function(a){for(var b=0;b<w.length;b++)for(var c=0;c<a.type.length;c++)if(w[b]===a.type[c])return!0;return!1};i=c.getItemsFromContainerByFilter(k,x),j=c.getItemsFromContainerByFilter(n,x)}}}t(b,j,i,"",f,"sub")}return p.resourcePromise=l.defer(),p.resourcePromise.promise};var u=function(a,b){var d=!0;if(""===a)"sub"===p.popoverOptions.scope.type&&(p.popoverOptions.scope.vocabSubStatus="done",p.popoverOptions.scope.vocabSubRes=[]),"obj"===p.popoverOptions.scope.type&&(p.popoverOptions.scope.vocabObjStatus="done",p.popoverOptions.scope.vocabObjRes=[]);else{var e=[];h.getItems(a).then(function(){angular.forEach(b,function(a){e[a.config.container]=c.getItemsByContainer(a.config.container),e[a.config.container].length>0&&(d=!1)}),"sub"===p.popoverOptions.scope.type&&(p.popoverOptions.scope.vocabSubStatus="done",p.popoverOptions.scope.vocabSubRes=e,p.popoverOptions.scope.vocabSubResEmpty=d),"obj"===p.popoverOptions.scope.type&&(p.popoverOptions.scope.vocabObjStatus="done",p.popoverOptions.scope.vocabObjRes=e,p.popoverOptions.scope.vocabObjResEmpty=d)})}};o.showItemsForObject=function(a,b,f){"undefined"==typeof b&&(b=p.popover.clickTarget);var i=h.getActiveSelectors();if(p.popoverOptions.scope.selectors=[],angular.forEach(i,function(a){p.popoverOptions.scope.selectors.push(a.config.container)}),null!==p.popover&&p.popover.clickTarget===b&&p.popoverOptions.scope.label!==f)p.popoverOptions.scope.vocabObjStatus="loading",m.cancel(s),r(f),s=m(function(){u(f,i)},o.options.vocabSearchTimer);else{m.cancel(s),"undefined"!=typeof f&&""!==f&&p.popoverOptions.scope.label!==f&&(p.popoverOptions.scope.vocabObjStatus="loading",m.cancel(s),s=m(function(){u(f,i)},o.options.vocabSearchTimer));var j,k,n=d.options.container,q=e.options.container;if("undefined"!=typeof a){var v=a[1];if("undefined"==typeof v||""===v)j=c.getItemsByContainer(n),k=c.getItemsByContainer(q),t(b,k,j,"",f,"obj");else{var w=c.getItemByUri(v);if("undefined"==typeof w||"undefined"==typeof w.range||0===w.range.length||""===w.range[0])j=c.getItemsByContainer(n),k=c.getItemsByContainer(q),t(b,k,j,"",f,"obj");else if(1===w.range.length&&w.range[0]===g.rdfs.literal)o.showPopoverLiteral("",b);else if(1===w.range.length&&w.range[0]===g.dateTime)o.showPopoverCalendar("",b);else{var x=w.range,y=function(a){for(var b=0;b<x.length;b++)for(var c=0;c<a.type.length;c++)if(x[b]===a.type[c])return!0;return!1};j=c.getItemsFromContainerByFilter(n,y),k=c.getItemsFromContainerByFilter(q,y),t(b,k,j,"",f,"obj")}}}}return p.resourcePromise=l.defer(),p.resourcePromise.promise};var v,w;o.showProperties=function(a,b,d){if("undefined"==typeof b&&(b=p.popover.clickTarget),m.cancel(s),p.popoverOptions.scope.vocabStatus="",p.popoverOptions.scope.vocab=[],null!==p.popover&&p.popover.clickTarget===b&&p.popoverOptions.scope.label!==d)r(d);else{o.hide();var e,g=f.options.relationsContainer;if("undefined"!=typeof a){var h=a[0],i=a[2];if("undefined"!=typeof h&&""!==h||"undefined"!=typeof i&&""!==i)if("undefined"==typeof h||""===h||"undefined"!=typeof i&&""!==i)if("undefined"==typeof i||""===i||"undefined"!=typeof h&&""!==h){if("undefined"!=typeof i&&""!==i&&"undefined"!=typeof h&&""!==h){var j=c.getItemByUri(i),k=c.getItemByUri(h);"undefined"!=typeof k.type&&0!==k.type.length&&""!==k.type[0]||"undefined"!=typeof j.type&&0!==j.type.length&&""!==j.type[0]?"undefined"!=typeof k.type&&0!==k.type.length&&""!==k.type[0]||"undefined"==typeof j.type||""===j.type[0]?"undefined"==typeof k.type||""===k.type[0]||"undefined"!=typeof j.type&&0!==j.type.length&&""!==j.type[0]?"undefined"!=typeof k.type&&""!==k.type[0]&&"undefined"!=typeof j.type&&""!==j.type[0]&&(w=k.type,v=j.type,e=c.getItemsFromContainerByFilter(g,z),t(b,"","",e,d,"pr")):(w=k.type,e=c.getItemsFromContainerByFilter(g,x),t(b,"","",e,d,"pr")):(v=j.type,e=c.getItemsFromContainerByFilter(g,y),t(b,"","",e,d,"pr")):(e=c.getItemsByContainer(g),t(b,"","",e,d,"pr"))}}else{var j=c.getItemByUri(i);"undefined"==typeof j||"undefined"==typeof j.type||0===j.type.length||""===j.type[0]?(e=c.getItemsByContainer(g),t(b,"","",e,d,"pr")):(v=j.type,e=c.getItemsFromContainerByFilter(g,y),t(b,"","",e,d,"pr"))}else{var k=c.getItemByUri(h);"undefined"==typeof k||"undefined"==typeof k.type||0===k.type.length||""===k.type[0]?(e=c.getItemsByContainer(g),t(b,"","",e,d,"pr")):(w=k.type,e=c.getItemsFromContainerByFilter(g,x),t(b,"","",e,d,"pr"))}else e=c.getItemsByContainer(g),t(b,"","",e,d,"pr")}}return p.resourcePromise=l.defer(),p.resourcePromise.promise};var x=function(a){if("undefined"!=typeof a.domain){for(var b=0;b<w.length;b++)for(var c=0;c<a.domain.length;c++)if(w[b]===a.domain[c])return!0;return!1}return!1},y=function(a){if("undefined"!=typeof a.range){for(var b=0;b<v.length;b++)for(var c=0;c<a.range.length;c++)if(v[b]===a.range[c])return!0;return!1}return!1},z=function(a){var b=y(a)&&x(a);return b};return o}]).filter("filterByLabel",function(){return function(a,b){var c=[];return"undefined"!=typeof b&&""!==b?angular.forEach(a,function(a){var d=a.label,e=b.toLowerCase().replace(/\s+/g," "),f=e.split(" "),g=new RegExp(f.join(".*"));return null!==d.toLowerCase().match(g)?void c.push(a):void 0}):c=a,c}}),angular.module("Pundit2.ResourcePanel").controller("ResourcePanelCtrl",["$rootScope","$scope","MyItems","PageItemsContainer","ItemsExchange","MyPundit",function(a,b,c,d,e,f){c.options.container,d.options.container;b.caretMyItems=!0,b.caretPageItems=!1,b.caretProperties=!1,b.toggleMyItems=function(){b.caretMyItems=!b.caretMyItems,$("#collapseMyItems").toggle()},b.togglePageItems=function(){b.caretProperties=!b.caretProperties,$("#collapsePageItems").toggle()},b.toggleObjVocab=function(a){var b=angular.element("span.pnd-vocab-"+a+" i");b.hasClass("pnd-icon-caret-right")?b.addClass("pnd-icon-caret-down").removeClass("pnd-icon-caret-right"):b.addClass("pnd-icon-caret-right").removeClass("pnd-icon-caret-down"),$("#obj-"+a).toggle()},b.toggleSubVocab=function(a){var b=angular.element("span.pnd-sub-vocab-"+a+" i");b.hasClass("pnd-icon-caret-right")?b.addClass("pnd-icon-caret-down").removeClass("pnd-icon-caret-right"):b.addClass("pnd-icon-caret-right").removeClass("pnd-icon-caret-down"),$("#sub-"+a).toggle()},a.$watch(function(){return f.isUserLogged()},function(a){b.userLoggedIn=a});var g=function(a){return a.replace(/ /g,"")};b.getOrderProperty=function(a){return g(a.label)}}]),angular.module("Pundit2.NotebookComposer",[]),angular.module("Pundit2.NotebookComposer").directive("notebookComposer",function(){return{restrict:"E",scope:{},templateUrl:"src/Tools/NotebookComposer/NotebookComposer.dir.tmpl.html",controller:"NotebookComposerCtrl"}}),angular.module("Pundit2.NotebookComposer").controller("NotebookComposerCtrl",["$scope","NotebookComposer","Toolbar","$timeout","NotebookExchange","NotebookCommunication","$q",function(a,b,c,d,e,f,g){a.notebook={},a.notebook.visibility="public",a.notebook.name="",a.notebook.current=!1,a.editMode=!1,a.notebookComposerHeader="Create your notebook",a.$watch(function(){return b.getNotebookToEdit()},function(b){null!==b&&(a.notebookToEdit=b,a.notebook.name=b.label,a.notebook.visibility=b.visibility,a.editMode=!0,e.getCurrentNotebooks().id===b.id?(a.isCurrentNotebook=!0,a.notebook.current=!0):(a.isCurrentNotebook=!1,a.notebook.current=!1),a.notebookComposerHeader="Edit your notebook")}),a.saving=!1,a.textMessage=b.options.savingMsg;var h="Editing",i="Loading",j="Saved",k="Warning!",l="pnd-icon-refresh pnd-icon-spin",m="pnd-icon-check-circle",n="pnd-icon-exclamation-circle",o="pnd-message",p="pnd-message-success",q="pnd-message-warning";a.shortMessagge=i,a.savingIcon=l,a.shortMessageClass=o;var r,s,t=function(e,f,g){a.textMessage=e,g?(a.shortMessagge=k,a.savingIcon=n,a.shortMessageClass=q):(a.shortMessagge=j,a.savingIcon=m,a.shortMessageClass=p),d(function(){a.saving=!1,c.setLoading(!1),a.notebookComposerHeader="Create your notebook",b.setNotebookToEdit(null)},f)};a.save=function(){c.setLoading(!0),a.textMessage=b.options.savingMsg,a.shortMessagge=i,a.savingIcon=l,a.shortMessageClass=o,s=!1,r=d(function(){s=!0},b.options.savingMsgTime),a.saving=!0,b.createNotebook(a.notebook).then(function(){s?(t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()):r.then(function(){t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()})},function(){s?t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0):r.then(function(){t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0)})})},a.edit=function(){var e=[];if(c.setLoading(!0),a.textMessage=b.options.editingMsg,a.shortMessagge=h,a.savingIcon=l,a.shortMessageClass=o,s=!1,r=d(function(){s=!0},b.options.savingMsgTime),a.saving=!0,a.notebookToEdit.label!==a.notebook.name){var i=b.editNotebook(a.notebookToEdit.id,a.notebook.name);e.push(i)}if(a.notebook.current===!0){var j=f.setCurrent(a.notebookToEdit.id);e.push(j)}if(a.notebookToEdit.visibility!==a.notebook.visibility)if("public"===a.notebook.visibility){var k=f.setPublic(a.notebookToEdit.id);e.push(k)}else if("private"===a.notebook.visibility){var m=f.setPrivate(a.notebookToEdit.id);e.push(m)}g.all(e).then(function(){s?(t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()):r.then(function(){t(b.options.notificationSuccessMsg,b.options.notificationMsgTime,!1),a.clear()})},function(){s?(t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0),a.clear()):r.then(function(){t(b.options.notificationErrorMsg,b.options.notificationMsgTime,!0),a.clear()})})},a.clear=function(){a.notebook.name="",a.notebook.visibility="public",a.notebook.current="",a.editMode=!1,a.notebookComposerHeader="Create your notebook"}}]),angular.module("Pundit2.NotebookComposer").constant("NOTEBOOKCOMPOSERDEFAULTS",{clientDashboardTemplate:"src/Tools/NotebookComposer/ClientNotebookComposer.tmpl.html",clientDashboardPanel:"tools",clientDashboardTabTitle:"Notebooks Composer",savingMsg:"We are saving your notebook",editingMsg:"We are editing your notebook",savingMsgTime:1250,notificationMsgTime:1500,notificationSuccessMsg:"Your notebook has been saved successfully",notificationErrorMsg:"We were unable to save your notebook"}).service("NotebookComposer",["BaseComponent","NotebookExchange","NOTEBOOKCOMPOSERDEFAULTS","$q","NotebookCommunication",function(a,b,c,d,e){var f=new a("NotebookComposer",c);f.createNotebook=function(a){var b=d.defer(),c=[];return e.createNotebook(a.name).then(function(f){if("private"===a.visibility){var g=e.setPrivate(f);c.push(g)}if(a.current===!0){var h=e.setCurrent(f);c.push(h)}d.all(c).then(function(){b.resolve()})},function(){b.reject("created failed")}),b.promise};var g=null;return f.editNotebook=function(a,b){var c=d.defer();return e.setName(a,b).then(function(){c.resolve()},function(){c.reject("edited failed")}),c.promise},f.getNotebookToEdit=function(){return g},f.setNotebookToEdit=function(a){g=a},f}]);