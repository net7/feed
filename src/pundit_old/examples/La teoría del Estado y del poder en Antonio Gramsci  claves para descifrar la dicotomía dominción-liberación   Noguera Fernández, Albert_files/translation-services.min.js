js.utils.registerNamespace("eu.europeana.translation_services");eu.europeana.translation_services={links:{$show_services:jQuery("#translate-item"),$return_to_original:jQuery('<a href="" style="display:none;">'+eu.europeana.vars.msg.return_to_language+"</a>")},containers:{$translation_services:jQuery('<div id="translation-services"></div>')},translators:{microsoft:{callbacks:[],translations:{}}},text_nodes:[],source_text:[],to_locale:undefined,init:function(){this.links.$show_services.bind("click",{self:this},this.toggleShowServices);this.links.$show_services.after(this.containers.$translation_services);this.captureOriginalTextNodes();this.setUpCallbacks("microsoft");this.addTranslatorMicrosoft();},captureOriginalTextNodes:function(){var a=this;jQuery("#item-details .translate, #additional-info .translate").each(function(b,c){a.text_nodes.push(jQuery(c));});},setUpCallbacks:function(b){var a=this,c,d=this.text_nodes.length;for(c=0;c<d;c+=1){(function(){var e=c;a.source_text[e]=jQuery.trim(a.text_nodes[e].html());a.translators[b].callbacks[e]=function(f){a.translators[b].translations[a.to_locale][e]=f;a.applyTranslation(a.text_nodes[e],f);};})();}},toggleShowServices:function(b){var a=b.data.self;b.preventDefault();if(a.containers.$translation_services.is(":hidden")){a.links.$show_services.addClass("active");a.containers.$translation_services.slideDown();}else{a.links.$show_services.removeClass("active");a.containers.$translation_services.slideUp();}},addTranslatorMicrosoft:function(){var a=this;eu.europeana.translation_services.microsoft=new com.microsoft.translator({BING_API_KEY:eu.europeana.vars.bing_translate_key,callback:"eu.europeana.translation_services.microsoft.callback",browser_locale:eu.europeana.vars.locale,$container_for_selector:this.containers.$translation_services,translator_selector_html:'<div id="microsoft-translate-element"><select><option value="">'+eu.europeana.vars.msg.select_language+'</option></select><span class="small">Powered by <span class="bold">Microsoft<sup>??</sup></span> Translator</span></div>'});eu.europeana.translation_services.microsoft.init(function(){jQuery("#microsoft-translate-element select").bind("change",{self:a,translator:"microsoft"},a.handleTranslateRequest);a.links.$show_services.trigger("click");});},handleTranslateRequest:function(f){var a=f.data.self,b=f.data.translator,c,d=a.text_nodes.length;a.to_locale=jQuery(this).val();if(a.to_locale.length<1){return;}eu.europeana.translation_services[b].options.to_locale=a.to_locale;a.addReturnToOriginal();for(c=0;c<d;c=c+1){a.setTranslatorTranslationLocale(b);a.setTranslatorTranslationDefault(b,c);if(a.translators[b].translations[a.to_locale]&&a.translators[b].translations[a.to_locale][c]){a.applyTranslation(a.text_nodes[c],a.translators[b].translations[a.to_locale][c]);}else{eu.europeana.translation_services[b].options.text_to_translate=a.source_text[c];eu.europeana.translation_services[b].options.callback="eu.europeana.translation_services.translators."+b+".callbacks["+c+"]";eu.europeana.translation_services.microsoft.translate();}}},setTranslatorTranslationLocale:function(a){if(this.translators[a].translations[this.to_locale]){return;}this.translators[a].translations[this.to_locale]=[];},setTranslatorTranslationDefault:function(a,b){if(this.translators[a].translations[this.to_locale][b]){return;}this.translators[a].translations[this.to_locale][b]=null;},applyTranslation:function(b,a){b.html(a);js.utils.flashHighlight(b,"#ffff00","#ffffff",1500);},addReturnToOriginal:function(){if(this.links.$return_to_original.is(":hidden")){this.containers.$translation_services.append(this.links.$return_to_original.bind("click",{self:this},this.handleReturnToOriginal).fadeIn());}},handleReturnToOriginal:function(d){var a=d.data.self,b,c=a.text_nodes.length;d.preventDefault();for(b=0;b<c;b=b+1){a.applyTranslation(a.text_nodes[b],a.source_text[b]);}jQuery("#microsoft-translate-element select").val("");a.links.$return_to_original.fadeOut();}};