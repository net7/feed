js.utils.registerNamespace("com.gmtplusone.carousel");com.gmtplusone.carousel=function(b,a){var c={animation:{duration:("ontouchstart" in document)?100:700,marginLeft:0,arrow_keys_active:true,hover_title:true},properties:{item_widths:[],item_count:0,current_item:0,container_width:0,nr_in_container:0,carousel:"#carousel",carousel_container:".carousel-container",$previous:null,$next:null},controls:{previous:'<a href="" class="carousel-control previous nofollow" title="previous"></a>',next:'<a href="" class="carousel-control next nofollow" title="next"></a>'},touch:{x_start:null,x_end:null,move_registered:false}};this.options=jQuery.extend(true,{},c,a);this.options.properties.carousel=("string"===typeof b)?b:this.options.properties.carousel;this.options.properties.$carousel_container=jQuery(this.options.properties.carousel+" "+this.options.properties.carousel_container);this.init=function(){jQuery(this.options.properties.carousel_container).stop().animate({opacity:1},1700);this.setupCarousel();if(this.options.properties.item_count>this.options.properties.nr_in_container){this.placeControls();this.randomLocation();}if(this.options.animation.arrow_keys_active){this.addKeyUpHandler();}};com.gmtplusone.carousel.prototype.setupCarousel=function(){var e=this,f=0,d;jQuery(this.options.properties.carousel+" li").each(function(g,h){d=jQuery(h);e.options.properties.item_widths.push(d.outerWidth(true));e.options.properties.container_width+=d.outerWidth(true);if(e.options.properties.container_width>f){f=d.outerWidth(true);}e.options.properties.item_count+=1;if(e.options.animation.hover_title){e.addHoverBox(d);}});this.options.properties.nr_in_container=Math.round(this.options.properties.$carousel_container.width()/f);jQuery(this.options.properties.carousel+" li a").each(function(g,h){d=jQuery(h);e.addTouchHandler(d);e.addItemClickHandler(d);});jQuery(this.options.properties.carousel+" ul").css("width",this.options.properties.container_width);};com.gmtplusone.carousel.prototype.placeControls=function(){this.options.properties.$carousel_container.before(this.options.controls.previous);this.options.properties.$previous=jQuery(this.options.properties.carousel+" .previous");this.addControlClickHandler(this.options.properties.$previous);this.options.properties.$carousel_container.after(this.options.controls.next);this.options.properties.$next=jQuery(this.options.properties.carousel+" .next");this.addControlClickHandler(this.options.properties.$next);};com.gmtplusone.carousel.prototype.addControlClickHandler=function(e){var d=this;e.bind("click",function(f){f.preventDefault();d.handleControlClick(jQuery(this));});};com.gmtplusone.carousel.prototype.handleControlClick=function(d){var e=this.options.animation.marginLeft;if(d.hasClass("previous")){this.handleClickPrevious();}else{if(d.hasClass("next")){this.handleClickNext();}}if(e!==this.options.animation.marginLeft){this.animateCarousel();}};com.gmtplusone.carousel.prototype.handleClickPrevious=function(){if(0===this.options.properties.current_item){return;}this.options.properties.current_item-=1;this.options.animation.marginLeft+=jQuery(this.options.properties.carousel+" li").eq(this.options.properties.current_item).outerWidth(true);};com.gmtplusone.carousel.prototype.handleClickNext=function(){if(this.options.properties.item_count-this.options.properties.nr_in_container===this.options.properties.current_item){return;}this.options.properties.current_item+=1;this.options.animation.marginLeft+=-1*jQuery(this.options.properties.carousel+" li").eq(this.options.properties.current_item).outerWidth(true);};com.gmtplusone.carousel.prototype.addItemClickHandler=function(d){d.bind("click",{carousel:this},this.handleItemClick);};com.gmtplusone.carousel.prototype.handleItemClick=function(f){var d=f.data.carousel;if(d.options.touch.move_registered){f.stopPropagation();f.preventDefault();d.options.touch.move_registered=false;}};com.gmtplusone.carousel.prototype.addKeyUpHandler=function(){jQuery(document).bind("keyup",{carousel:this},this.handleKeyUp);};com.gmtplusone.carousel.prototype.handleKeyUp=function(g){if(!g||!g.keyCode){return;}var d=g.data.carousel,f=d.options.animation.marginLeft;switch(g.keyCode){case 37:d.handleClickPrevious();break;case 39:d.handleClickNext();break;}if(f!==d.options.animation.marginLeft){d.animateCarousel();}};com.gmtplusone.carousel.prototype.toggleControls=function(){this.togglePrevious();this.toggleNext();};com.gmtplusone.carousel.prototype.togglePrevious=function(){var d=this;if(0===this.options.properties.current_item){this.options.properties.$previous.fadeOut(function(){d.options.properties.$carousel_container.removeClass("previous-added");});}else{if("block"!==this.options.properties.$previous.css("display")){this.options.properties.$carousel_container.addClass("previous-added");this.options.properties.$previous.fadeIn();}}};com.gmtplusone.carousel.prototype.toggleNext=function(){if(this.options.properties.current_item===this.options.properties.item_count-this.options.properties.nr_in_container){this.options.properties.$next.fadeOut();}else{if("block"!==this.options.properties.$next.css("display")){this.options.properties.$next.fadeIn();}}};com.gmtplusone.carousel.prototype.addHoverBox=function(d){var e='<div class="hover-box">'+d.children("a").attr("title")+"</div>";d.append(e);d.children(".hover-box").css("margin-left",0);};com.gmtplusone.carousel.prototype.addHoverHandler=function(d){var e=d.children(".hover-box"),f=parseInt(d.children(".hover-box").outerWidth(true),10)+20;d.hover(function(){e.stop().animate({marginLeft:0},500);},function(){e.stop().animate({marginLeft:-1*f},500);});};com.gmtplusone.carousel.prototype.randomLocation=function(){var e,d=this,f=Math.floor(Math.random()*(this.options.properties.item_count-this.options.properties.nr_in_container)+1);if(0===f){return;}this.options.properties.current_item=f;for(e=0;e<f;e+=1){this.options.animation.marginLeft+=-1*d.options.properties.item_widths[e];}this.animateCarousel();};com.gmtplusone.carousel.prototype.animateCarousel=function(){var d=this;jQuery(this.options.properties.carousel+" ul").animate(this.options.animation,this.options.animation.duration,function(){d.toggleControls();});};com.gmtplusone.carousel.prototype.addTouchHandler=function(d){d.bind("touchstart",{self:this},this.handleTouchEvent,false);d.bind("touchend",{self:this},this.handleTouchEvent,false);d.bind("touchmove",{self:this},this.handleTouchEvent,false);d.bind("touchcancel",{self:this},this.handleTouchEvent,false);};com.gmtplusone.carousel.prototype.handleTouchEvent=function(h){var f=h.data.self;switch(h.originalEvent.type){case"touchstart":f.options.touch.x_start=h.originalEvent.touches[0].screenX;break;case"touchmove":h.preventDefault();break;case"touchend":f.options.touch.x_end=h.originalEvent.changedTouches[0].screenX;if(f.options.touch.x_start!==null&&f.options.touch.x_end!==null){var d=parseInt(f.options.touch.x_start,10),g=parseInt(f.options.touch.x_end,10);if(d!==g){f.options.touch.move_registered=true;if(g>d){f.handleClickPrevious();}else{f.handleClickNext();}f.options.touch.x_start=null;f.options.touch.x_end=null;f.animateCarousel();}}break;case"click":if(f.options.touch.move_registered){h.stopPropagation();h.preventDefault();f.options.touch.move_registered=false;}break;}};};